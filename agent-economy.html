<!DOCTYPE html>
<html class="staticrypt-html">
    <head>
        <meta charset="utf-8" />
        <title>Protected Page</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- do not cache this page -->
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />

        <style>
            .staticrypt-hr {
                margin-top: 20px;
                margin-bottom: 20px;
                border: 0;
                border-top: 1px solid #eee;
            }

            .staticrypt-page {
                width: 360px;
                padding: 8% 0 0;
                margin: auto;
                box-sizing: border-box;
            }

            .staticrypt-form {
                position: relative;
                z-index: 1;
                background: #ffffff;
                max-width: 360px;
                margin: 0 auto 100px;
                padding: 45px;
                text-align: center;
                box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
            }

            .staticrypt-form input[type="password"],
            input[type="text"] {
                background: inherit;
                border: 0;
                box-sizing: border-box; /* This ensures padding is included in the total width */
                font-size: 14px;
                outline: 0;
                padding: 15px 30px 15px 15px; /* Adjust the padding to ensure there is space for the icon */
                width: 100%;
            }

            .staticrypt-password-container {
                position: relative;
                outline: 0;
                background: #f2f2f2;
                width: 100%;
                border: 0;
                margin: 0 0 15px;
                box-sizing: border-box;
            }

            .staticrypt-toggle-password-visibility {
                cursor: pointer;
                height: 20px;
                opacity: 60%;
                padding: 13px;
                position: absolute;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                width: 20px;
            }

            .staticrypt-form .staticrypt-decrypt-button {
                text-transform: uppercase;
                outline: 0;
                background: #4CAF50;
                width: 100%;
                border: 0;
                padding: 15px;
                color: #ffffff;
                font-size: 14px;
                cursor: pointer;
            }

            .staticrypt-form .staticrypt-decrypt-button:hover,
            .staticrypt-form .staticrypt-decrypt-button:active,
            .staticrypt-form .staticrypt-decrypt-button:focus {
                background: #4CAF50;
                filter: brightness(92%);
            }

            .staticrypt-html {
                height: 100%;
            }

            .staticrypt-body {
                height: 100%;
                margin: 0;
            }

            .staticrypt-content {
                height: 100%;
                margin-bottom: 1em;
                background: #76B852;
                font-family: "Arial", sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            .staticrypt-instructions {
                margin-top: -1em;
                margin-bottom: 1em;
            }

            .staticrypt-title {
                font-size: 1.5em;
            }

            label.staticrypt-remember {
                display: flex;
                align-items: center;
                margin-bottom: 1em;
            }

            .staticrypt-remember input[type="checkbox"] {
                transform: scale(1.5);
                margin-right: 1em;
            }

            .hidden {
                display: none !important;
            }

            .staticrypt-spinner-container {
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .staticrypt-spinner {
                display: inline-block;
                width: 2rem;
                height: 2rem;
                vertical-align: text-bottom;
                border: 0.25em solid gray;
                border-right-color: transparent;
                border-radius: 50%;
                -webkit-animation: spinner-border 0.75s linear infinite;
                animation: spinner-border 0.75s linear infinite;
                animation-duration: 0.75s;
                animation-timing-function: linear;
                animation-delay: 0s;
                animation-iteration-count: infinite;
                animation-direction: normal;
                animation-fill-mode: none;
                animation-play-state: running;
                animation-name: spinner-border;
            }

            @keyframes spinner-border {
                100% {
                    transform: rotate(360deg);
                }
            }

            @media screen and (-webkit-min-device-pixel-ratio: 0) {
                .staticrypt-form input[type="password"],
                input[type="text"] {
                    font-size: 16px;
                }
            }
        </style>
    </head>

    <body class="staticrypt-body">
        <div id="staticrypt_loading" class="staticrypt-spinner-container">
            <div class="staticrypt-spinner"></div>
        </div>

        <div id="staticrypt_content" class="staticrypt-content hidden">
            <div class="staticrypt-page">
                <div class="staticrypt-form">
                    <div class="staticrypt-instructions">
                        <p class="staticrypt-title">Protected Page</p>
                        <p></p>
                    </div>

                    <hr class="staticrypt-hr" />

                    <form id="staticrypt-form" action="#" method="post">
                        <div class="staticrypt-password-container">
                            <input
                                id="staticrypt-password"
                                type="password"
                                name="password"
                                placeholder="Password"
                                autofocus
                            />

                            <img
                                class="staticrypt-toggle-password-visibility"
                                alt="Show password"
                                title="Show password"
                                src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg=="
                            />
                        </div>

                        <label id="staticrypt-remember-label" class="staticrypt-remember hidden">
                            <input id="staticrypt-remember" type="checkbox" name="remember" />
                            Remember me
                        </label>

                        <input type="submit" class="staticrypt-decrypt-button" value="DECRYPT" />
                    </form>
                </div>
            </div>
        </div>

        <script>
            // these variables will be filled when generating the file - the template format is 'variable_name'
            const staticryptInitiator = ((function(){
  const exports = {};
  const cryptoEngine = ((function(){
  const exports = {};
  const { subtle } = crypto;

const IV_BITS = 16 * 8;
const HEX_BITS = 4;
const ENCRYPTION_ALGO = "AES-CBC";

/**
 * Translates between utf8 encoded hexadecimal strings
 * and Uint8Array bytes.
 */
const HexEncoder = {
    /**
     * hex string -> bytes
     * @param {string} hexString
     * @returns {Uint8Array}
     */
    parse: function (hexString) {
        if (hexString.length % 2 !== 0) throw "Invalid hexString";
        const arrayBuffer = new Uint8Array(hexString.length / 2);

        for (let i = 0; i < hexString.length; i += 2) {
            const byteValue = parseInt(hexString.substring(i, i + 2), 16);
            if (isNaN(byteValue)) {
                throw "Invalid hexString";
            }
            arrayBuffer[i / 2] = byteValue;
        }
        return arrayBuffer;
    },

    /**
     * bytes -> hex string
     * @param {Uint8Array} bytes
     * @returns {string}
     */
    stringify: function (bytes) {
        const hexBytes = [];

        for (let i = 0; i < bytes.length; ++i) {
            let byteString = bytes[i].toString(16);
            if (byteString.length < 2) {
                byteString = "0" + byteString;
            }
            hexBytes.push(byteString);
        }
        return hexBytes.join("");
    },
};

/**
 * Translates between utf8 strings and Uint8Array bytes.
 */
const UTF8Encoder = {
    parse: function (str) {
        return new TextEncoder().encode(str);
    },

    stringify: function (bytes) {
        return new TextDecoder().decode(bytes);
    },
};

/**
 * Salt and encrypt a msg with a password.
 */
async function encrypt(msg, hashedPassword) {
    // Must be 16 bytes, unpredictable, and preferably cryptographically random. However, it need not be secret.
    // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/encrypt#parameters
    const iv = crypto.getRandomValues(new Uint8Array(IV_BITS / 8));

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["encrypt"]);

    const encrypted = await subtle.encrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        UTF8Encoder.parse(msg)
    );

    // iv will be 32 hex characters, we prepend it to the ciphertext for use in decryption
    return HexEncoder.stringify(iv) + HexEncoder.stringify(new Uint8Array(encrypted));
}
exports.encrypt = encrypt;

/**
 * Decrypt a salted msg using a password.
 *
 * @param {string} encryptedMsg
 * @param {string} hashedPassword
 * @returns {Promise<string>}
 */
async function decrypt(encryptedMsg, hashedPassword) {
    const ivLength = IV_BITS / HEX_BITS;
    const iv = HexEncoder.parse(encryptedMsg.substring(0, ivLength));
    const encrypted = encryptedMsg.substring(ivLength);

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["decrypt"]);

    const outBuffer = await subtle.decrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        HexEncoder.parse(encrypted)
    );

    return UTF8Encoder.stringify(new Uint8Array(outBuffer));
}
exports.decrypt = decrypt;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
async function hashPassword(password, salt) {
    // we hash the password in multiple steps, each adding more iterations. This is because we used to allow less
    // iterations, so for backward compatibility reasons, we need to support going from that to more iterations.
    let hashedPassword = await hashLegacyRound(password, salt);

    hashedPassword = await hashSecondRound(hashedPassword, salt);

    return hashThirdRound(hashedPassword, salt);
}
exports.hashPassword = hashPassword;

/**
 * This hashes the password with 1k iterations. This is a low number, we need this function to support backwards
 * compatibility.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
function hashLegacyRound(password, salt) {
    return pbkdf2(password, salt, 1000, "SHA-1");
}
exports.hashLegacyRound = hashLegacyRound;

/**
 * Add a second round of iterations. This is because we used to use 1k, so for backwards compatibility with
 * remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashSecondRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 14000, "SHA-256");
}
exports.hashSecondRound = hashSecondRound;

/**
 * Add a third round of iterations to bring total number to 600k. This is because we used to use 1k, then 15k, so for
 * backwards compatibility with remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashThirdRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 585000, "SHA-256");
}
exports.hashThirdRound = hashThirdRound;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @param {int} iterations
 * @param {string} hashAlgorithm
 * @returns {Promise<string>}
 */
async function pbkdf2(password, salt, iterations, hashAlgorithm) {
    const key = await subtle.importKey("raw", UTF8Encoder.parse(password), "PBKDF2", false, ["deriveBits"]);

    const keyBytes = await subtle.deriveBits(
        {
            name: "PBKDF2",
            hash: hashAlgorithm,
            iterations,
            salt: UTF8Encoder.parse(salt),
        },
        key,
        256
    );

    return HexEncoder.stringify(new Uint8Array(keyBytes));
}

function generateRandomSalt() {
    const bytes = crypto.getRandomValues(new Uint8Array(128 / 8));

    return HexEncoder.stringify(new Uint8Array(bytes));
}
exports.generateRandomSalt = generateRandomSalt;

async function signMessage(hashedPassword, message) {
    const key = await subtle.importKey(
        "raw",
        HexEncoder.parse(hashedPassword),
        {
            name: "HMAC",
            hash: "SHA-256",
        },
        false,
        ["sign"]
    );
    const signature = await subtle.sign("HMAC", key, UTF8Encoder.parse(message));

    return HexEncoder.stringify(new Uint8Array(signature));
}
exports.signMessage = signMessage;

function getRandomAlphanum() {
    const possibleCharacters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

    let byteArray;
    let parsedInt;

    // Keep generating new random bytes until we get a value that falls
    // within a range that can be evenly divided by possibleCharacters.length
    do {
        byteArray = crypto.getRandomValues(new Uint8Array(1));
        // extract the lowest byte to get an int from 0 to 255 (probably unnecessary, since we're only generating 1 byte)
        parsedInt = byteArray[0] & 0xff;
    } while (parsedInt >= 256 - (256 % possibleCharacters.length));

    // Take the modulo of the parsed integer to get a random number between 0 and totalLength - 1
    const randomIndex = parsedInt % possibleCharacters.length;

    return possibleCharacters[randomIndex];
}

/**
 * Generate a random string of a given length.
 *
 * @param {int} length
 * @returns {string}
 */
function generateRandomString(length) {
    let randomString = "";

    for (let i = 0; i < length; i++) {
        randomString += getRandomAlphanum();
    }

    return randomString;
}
exports.generateRandomString = generateRandomString;

  return exports;
})());
const codec = ((function(){
  const exports = {};
  /**
 * Initialize the codec with the provided cryptoEngine - this return functions to encode and decode messages.
 *
 * @param cryptoEngine - the engine to use for encryption / decryption
 */
function init(cryptoEngine) {
    const exports = {};

    /**
     * Top-level function for encoding a message.
     * Includes password hashing, encryption, and signing.
     *
     * @param {string} msg
     * @param {string} password
     * @param {string} salt
     *
     * @returns {string} The encoded text
     */
    async function encode(msg, password, salt) {
        const hashedPassword = await cryptoEngine.hashPassword(password, salt);

        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encode = encode;

    /**
     * Encode using a password that has already been hashed. This is useful to encode multiple messages in a row, that way
     * we don't need to hash the password multiple times.
     *
     * @param {string} msg
     * @param {string} hashedPassword
     *
     * @returns {string} The encoded text
     */
    async function encodeWithHashedPassword(msg, hashedPassword) {
        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encodeWithHashedPassword = encodeWithHashedPassword;

    /**
     * Top-level function for decoding a message.
     * Includes signature check and decryption.
     *
     * @param {string} signedMsg
     * @param {string} hashedPassword
     * @param {string} salt
     * @param {int} backwardCompatibleAttempt
     * @param {string} originalPassword
     *
     * @returns {Object} {success: true, decoded: string} | {success: false, message: string}
     */
    async function decode(signedMsg, hashedPassword, salt, backwardCompatibleAttempt = 0, originalPassword = "") {
        const encryptedHMAC = signedMsg.substring(0, 64);
        const encryptedMsg = signedMsg.substring(64);
        const decryptedHMAC = await cryptoEngine.signMessage(hashedPassword, encryptedMsg);

        if (decryptedHMAC !== encryptedHMAC) {
            // we have been raising the number of iterations in the hashing algorithm multiple times, so to support the old
            // remember-me/autodecrypt links we need to try bringing the old hashes up to speed.
            originalPassword = originalPassword || hashedPassword;
            if (backwardCompatibleAttempt === 0) {
                const updatedHashedPassword = await cryptoEngine.hashThirdRound(originalPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }
            if (backwardCompatibleAttempt === 1) {
                let updatedHashedPassword = await cryptoEngine.hashSecondRound(originalPassword, salt);
                updatedHashedPassword = await cryptoEngine.hashThirdRound(updatedHashedPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }

            return { success: false, message: "Signature mismatch" };
        }

        return {
            success: true,
            decoded: await cryptoEngine.decrypt(encryptedMsg, hashedPassword),
        };
    }
    exports.decode = decode;

    return exports;
}
exports.init = init;

  return exports;
})());
const decode = codec.init(cryptoEngine).decode;

/**
 * Initialize the staticrypt module, that exposes functions callbable by the password_template.
 *
 * @param {{
 *  staticryptEncryptedMsgUniqueVariableName: string,
 *  isRememberEnabled: boolean,
 *  rememberDurationInDays: number,
 *  staticryptSaltUniqueVariableName: string,
 * }} staticryptConfig - object of data that is stored on the password_template at encryption time.
 *
 * @param {{
 *  rememberExpirationKey: string,
 *  rememberPassphraseKey: string,
 *  replaceHtmlCallback: function,
 *  clearLocalStorageCallback: function,
 * }} templateConfig - object of data that can be configured by a custom password_template.
 */
function init(staticryptConfig, templateConfig) {
    const exports = {};

    /**
     * Decrypt our encrypted page, replace the whole HTML.
     *
     * @param {string} hashedPassword
     * @returns {Promise<boolean>}
     */
    async function decryptAndReplaceHtml(hashedPassword) {
        const { staticryptEncryptedMsgUniqueVariableName, staticryptSaltUniqueVariableName } = staticryptConfig;
        const { replaceHtmlCallback } = templateConfig;

        const result = await decode(
            staticryptEncryptedMsgUniqueVariableName,
            hashedPassword,
            staticryptSaltUniqueVariableName
        );
        if (!result.success) {
            return false;
        }
        const plainHTML = result.decoded;

        // if the user configured a callback call it, otherwise just replace the whole HTML
        if (typeof replaceHtmlCallback === "function") {
            replaceHtmlCallback(plainHTML);
        } else {
            document.write(plainHTML);
            document.close();
        }

        return true;
    }

    /**
     * Attempt to decrypt the page and replace the whole HTML.
     *
     * @param {string} password
     * @param {boolean} isRememberChecked
     *
     * @returns {Promise<{isSuccessful: boolean, hashedPassword?: string}>} - we return an object, so that if we want to
     *   expose more information in the future we can do it without breaking the password_template
     */
    async function handleDecryptionOfPage(password, isRememberChecked) {
        const { staticryptSaltUniqueVariableName } = staticryptConfig;

        // decrypt and replace the whole page
        const hashedPassword = await cryptoEngine.hashPassword(password, staticryptSaltUniqueVariableName);
        return handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked);
    }
    exports.handleDecryptionOfPage = handleDecryptionOfPage;

    async function handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked) {
        const { isRememberEnabled, rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

        if (!isDecryptionSuccessful) {
            return {
                isSuccessful: false,
                hashedPassword,
            };
        }

        // remember the hashedPassword and set its expiration if necessary
        if (isRememberEnabled && isRememberChecked) {
            window.localStorage.setItem(rememberPassphraseKey, hashedPassword);

            // set the expiration if the duration isn't 0 (meaning no expiration)
            if (rememberDurationInDays > 0) {
                window.localStorage.setItem(
                    rememberExpirationKey,
                    (new Date().getTime() + rememberDurationInDays * 24 * 60 * 60 * 1000).toString()
                );
            }
        }

        return {
            isSuccessful: true,
            hashedPassword,
        };
    }
    exports.handleDecryptionOfPageFromHash = handleDecryptionOfPageFromHash;

    /**
     * Clear localstorage from staticrypt related values
     */
    function clearLocalStorage() {
        const { clearLocalStorageCallback, rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        if (typeof clearLocalStorageCallback === "function") {
            clearLocalStorageCallback();
        } else {
            localStorage.removeItem(rememberPassphraseKey);
            localStorage.removeItem(rememberExpirationKey);
        }
    }

    async function handleDecryptOnLoad() {
        let isSuccessful = await decryptOnLoadFromUrl();

        if (!isSuccessful) {
            isSuccessful = await decryptOnLoadFromRememberMe();
        }

        return { isSuccessful };
    }
    exports.handleDecryptOnLoad = handleDecryptOnLoad;

    /**
     * Clear storage if we are logging out
     *
     * @returns {boolean} - whether we logged out
     */
    function logoutIfNeeded() {
        const logoutKey = "staticrypt_logout";

        // handle logout through query param
        const queryParams = new URLSearchParams(window.location.search);
        if (queryParams.has(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        // handle logout through URL fragment
        const hash = window.location.hash.substring(1);
        if (hash.includes(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        return false;
    }

    /**
     * To be called on load: check if we want to try to decrypt and replace the HTML with the decrypted content, and
     * try to do it if needed.
     *
     * @returns {Promise<boolean>} true if we derypted and replaced the whole page, false otherwise
     */
    async function decryptOnLoadFromRememberMe() {
        const { rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        // if we are login out, terminate
        if (logoutIfNeeded()) {
            return false;
        }

        // if there is expiration configured, check if we're not beyond the expiration
        if (rememberDurationInDays && rememberDurationInDays > 0) {
            const expiration = localStorage.getItem(rememberExpirationKey),
                isExpired = expiration && new Date().getTime() > parseInt(expiration);

            if (isExpired) {
                clearLocalStorage();
                return false;
            }
        }

        const hashedPassword = localStorage.getItem(rememberPassphraseKey);

        if (hashedPassword) {
            // try to decrypt
            const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

            // if the decryption is unsuccessful the password might be wrong - silently clear the saved data and let
            // the user fill the password form again
            if (!isDecryptionSuccessful) {
                clearLocalStorage();
                return false;
            }

            return true;
        }

        return false;
    }

    async function decryptOnLoadFromUrl() {
        const passwordKey = "staticrypt_pwd";
        const rememberMeKey = "remember_me";

        // try to get the password from the query param (for backward compatibility - we now want to avoid this method,
        // since it sends the hashed password to the server which isn't needed)
        const queryParams = new URLSearchParams(window.location.search);
        const hashedPasswordQuery = queryParams.get(passwordKey);
        const rememberMeQuery = queryParams.get(rememberMeKey);

        const urlFragment = window.location.hash.substring(1);
        // get the password from the url fragment
        const hashedPasswordRegexMatch = urlFragment.match(new RegExp(passwordKey + "=([^&]*)"));
        const hashedPasswordFragment = hashedPasswordRegexMatch ? hashedPasswordRegexMatch[1] : null;
        const rememberMeFragment = urlFragment.includes(rememberMeKey);

        const hashedPassword = hashedPasswordFragment || hashedPasswordQuery;
        const rememberMe = rememberMeFragment || rememberMeQuery;

        if (hashedPassword) {
            return handleDecryptionOfPageFromHash(hashedPassword, rememberMe);
        }

        return false;
    }

    return exports;
}
exports.init = init;

  return exports;
})());
            const templateError = "Bad password!",
                templateToggleAltShow = "Show password",
                templateToggleAltHide = "Hide password",
                isRememberEnabled = true,
                staticryptConfig = {"staticryptEncryptedMsgUniqueVariableName":"021e9a1796b525aa3a45b4b14e2f40a76add72218ca1f880d38e548311c57f11ce33c385a1f653f7f3bf45953e89f1baf8796382e6be02c0b94f0c7b86a0e8af2636ab7a4b28528f096876f097e7b60e4c5b4a4df477536046423c5f0adda4fd35564e674e52b82070cecaf612315c2013474d56bd1e7493d2f00918fc62c828d2abf1bc0100467cdbb1ff5756816b0ceea3bb820c901cf039e805b3ffc633dec91d382ae8c1be03609d66379b555b7e5db3013dfb5783432a22cf1882db69e9fd4201a81bc7b8d9cc0bb5a5cd1d087cffe40a7cf601a98e009d554b1389767533dec1e209e6bac69de5cd948f603d275c76d86e7c0b26924c57cea4fe9e13dd35b7b950713cb27f60651fc623c9cb949571a0bcf2c3b3f101beefb0d876e9f1e51161efd8c5400c9436dbc8a09f1cd52ae5305eaf91448ff84269d8e3b80c3cfe940eebda32308c432ed54cbc368555f3f40bff3e5a884237e41c562fc6c02bab5a558f0e9a223752a96bf4f1dcdd9af7f2562397dafaff4f5426292fced25c7afb7d2a1759f313b6c0cc989676fc13ee0ac72fcfc61bd8b8b3c53fbbdbb30a38bbbdf83b84019a5daf2c72573e96c83965638ecca3fdb34e6afd4c63aa03019cf0beae78a4763b2722d02de9d83a6f5eeb933bf0235e248f48239afa1b9730c2d72d482026c1bddc8d513c24d97de911ce3b59c0c3f15fa94d85f65a8174625664f55bc4db7185d824e33839cef7ac017379fba02f515151bcf697f3db40669852c1c9c2371a2ed759ccb237dd20a24211b4bf51acc07b075d54bbcd801d494ed2a243d490591171c17189f3fc4b88da745dccd995315c5f379c4502a48c9b195df01a942954be4b921d95cc79945a609e7def58b665677cd22381b0966a51a39f7231b97b3f050f63e0ccf4aa090e8187e0f4559262f66eeb1066c173229d2aca6339f9721abced991f194f6428b105637a6cb804be7811247461b1253614926dcc7e6e9cca3ed94193474dba46fe571b51841fd9efad994f543e66fc4ad3340d2c20e66c85314de0ee38482786c543857eee83396c8de1b0f58a021633a27dcdbbb004b688168663d288c6b4bcea51761b02da2b28edfd7690d68b2b2b9ae0eca5dc4ea0674ecb4fab852bdc6793e5d00ec8e1fbdbbdb85f8eca7f78ac315fff92efd5fb7f1e3a133bfb8a746a7ee380c06ae70d08dedc038a3499c01cbe11a9ade5ecb7bcbc103a77290fd384db61b5deb268b15c2a55694eef7b7dd0a667476a60b2fbe4681f81b5cdadb5045116906f44e3012ac14b0725d63274d3eb6adba0907493ad2434200f07696d60246f469ba1e71e3d728fdc077fdff02f6ad6dfd7f444c87cdb2ae00688e67180aaf88fc1acc4f0df7db3cf9fdc826a76e96dcbe25ebf3ff2e6ca1792252658342fd72f7aacc4e8b49efb804f2367476aeac417a8153c1dd4164c7fa3a6a01a35e4786bd9516f8927f6cc0bf8ddb23bfe4d8f2234592acc6b6bc556e4e0be9e5ae079009be9aae470be21f6cc06f01dc9beb4c94a9761d71470f3a411d460d2e3cd515e3c994229030b579653acb0c278d683282485c299f3736b018fe70bd11a234a71cb74672ce5ee9d7d3d7ddbdfd833c1cf05ec4e120f81581488bcb65e3afcb310b00ef214236e2ce5f49c96bb9bbe67753d5361d870f19c2917d277245785683b1a58885942a39c23635aae53e117c2b9e8223ab0b256ea494affa24a7980d0f79425a1675e77fe0f8775f73e6623a7e1be98862984521866f8f41ec49b916e451894328fd1af43b4c066bde48c6436ce69d6dfde3b6f3d87456cfb97f891c27b176db33b49fead585abc4f18552e91a0406c8664ff0b84b9b53a0cfa40ced16f4a5589c20abf8c95de0ba1fb6c62d4d0a912881b383e1c0ce74a057f296086d0920735faeef43315aa417c9025ea6fcc3b0edbe994fdf2cfce87d4a2438a49edc5c33a78adebc10e1dd485c5004239355c56d4f3a0ccb1e90e8dc0b24d56c6a6b382b58b6af5e690c8dad5cfb133bcc84b6ae4fb5652d28d0302232e8e663528ceac7f1d957037f81e94cc9b4cfbb02d49eaeac230fdc1e5d53c5982cffe745cc6018d9d72abf315c05b8edc50d046cf02a2980f80ae91a97ef170f11fb7a34cf2b013448db063234dba6fe421e22745052f20b9695df9ff84bc1824f2c114e4c4ff1828b524e853374ee61e9ba97dc3e9a629a4f31beb83c621b348a1e528736d46d6bdb844467d87893b1688a8fbb59e3b2ba23806eebb839b18078da8ae70d273a05d899484f48d388d95c57c1fde29d56947f05d1db87357c46f1db882261c8428b4fb7f03147e105db1c079c31baff284d72f11173168edda7a597391a862b1af29fd973ddd3874a7841cd1a717027c029202296e5b489ff6179035e6556d02439e37f1dab07431b2947ad771061cca2440d73df3fea6cbf4115cb57f64eda6d9297f125a2f68fe974b08149b70baf7b86db0aa7d9dd687dba028058eee9e1c915f2f5c1829d57e7eb2c43a9fe9f6e65b45f9e8d49ec50013c2d3f69e85c0c441c1f97d7d5076535ba7f368c3633d6e0f7e2e19696d96e19dbd66d7c995555978bfd8f5c1ddbc647fbe27ef2664792e9b6305dfbe25709b0e68942a7c31c14c3f195ed73b043d7da4b53bd27b353552618b0582e1bed5a20356806efec480493fef5198a213f8f3780b8e0ee8025e5b3ea0f69b0aa561764082c5714e20124ece50a0392ebc118993af8ebf47a3a68b09ddf10d6efdeba5952d07b8efd942989cba69f446788a88f34df6d108a0d5ae919b09d738df50bac799d384ada0e1d5ef53832637208fe40679a68dcf134095c0b26ccd1d0f296b0d36b64de4f0c4011e4c09772bdd57c071adff1d99e99fa96bc5a19b245137598c242e018295c65c34142482436d6f9354f8ec742e4b56e128e45b83f0566d9e9a9bead1235b0885995f1d71ba5415cc84cd0dd45e66e59ebc8603fc6f0d755b78b47774b23568a29a22ca0d8dc78991b04953d7eef27b2b2bcf4f35ddf8f99d48ca0f6d796d80a437aebc65998173f9e1cc0cab3f5068757310bb54cf79175106e894493ed36af3777e5e93e92dc0bc86f998f66e3eb82ff0f2c39ea6b61cbaf4ff1891ed908e1389dcd86d3f2c74ba5b44a968d12ea034ee01d5c2d0669ef7d5fc3a4b1e6bcdaccf93fbb83a9fd97400ba3bf0af6c619ad9302bda7c99db756d8a664351f7902066b22c56086f36f602abf91fb3b710e52d4a651adc8080c1d0368009596f3c93b8213e0f63ce4fafed6004e70b4cc52f36247fb22a3bfa63b0ba0acfd0d6068e1c8dcb250c4b11714a4274685995e987e30f01823c9f1a1dec444915b5d08656f1bc9198cf2f909d3d8f6e2cd5e86da7e8eab85b25f3a69d36e4fffa1fa00ad617e706d7873360f954c179c11cf6e0b3ee4e0e68d34342906d37c60fcdca5a1da9c4e15a8ea8c644803a6be1502a90ab4e4c91c166fd59d63e00fba4401fb5d58388d7d05b63063e061f20059bc88da8c3cde4f80e19c96a2d2b3dc7315bcd712ab6547a6cade796f0fd14d9828db438e8342fc7a581d034d57de0ca75e542f6a30c8698fdc0a6ba614d9829811bd87f75094bfad4f045f3b9b20da9b0bd58887449a24dd0e96dce2c7d3db4b906717b6c3baa41a39c8009f6ebe708dce4e4352c6879909dea73b732687b83e7f59ee79d0e2f28777b97b258c8274ecc55d60e2497a048918dc13dc94e9962105ce9aaf0fb46e06c81e610ebd4a24d6fb292757f9755708d925db3709c03e4d16e3cdcf58c6bedb97230c23df4c992830eec162df67cfaad08021c999860f62f7e5cfafcd78a934cf37f1d339e5db9d72a36338b5c3e6f5aed57dc23ab33a5bef9fd8951444f68639c15ddd827f273cec136fe96c383c83c31b6ab3a4e95830874c1b49fedc5de888322db3799dc017fdbc77b9e663fbc202ca29c51155f4f94e294ff0e9729d17a7d967fa45ed29ff76810451ce493b283179ed27135648733c410a0720ca0e542d5fd06de3042da79eeb3077389dd83e25ef09e1bace4427dc99d6c75c4da8b22e61e2b572f478b6f2360c40762ac76fc647306aab938598303144349e58a16a00ce19201958bca43fc120eaf6a2f828c56b847cfbb20caf72b8445c54c8d7eef6a4f10e70614007b24a0349fe9af55f3843e8fc98beec3f7913cdb7500e805923f987d37195be691e21cb946fbfcced8276554d1be1dc8aaed28ea40d034463aefba275abc6ccd2b1a370a227ddb8dc5e3df2b28e5f8b0f9e8d5c6d897a1ba1acee4f1d00f107c5a21d36378b3fa8b3c0f81eb9b5ea78365287f71c227761c483c626b3ab618e0601646b181c0759f6daeab7ab0e82750f36750ce1a6241771f8cc8491631fa5cf4dfd00c422955a644b0012935fd091faf64ef97541f434bfb72a4045654ce901f010a70c698791abe31205148224be94d33eac066526780818d3cd55aae7b22c14671f497670d7c215c73a29121894298fe23137996c460f1f119c88c748fca3b914b1d030da096074542c5064e5109ea2eb443ea9bbd584e9c72870708823499ab89992b203c99204271ee70b77838edaae211eb58020808112b67f0942ce30e596097db773c5fcedefc1ebdae306a4dcf1d8d3d6ac214d9a3670f7d72fd702f0a9648eb9a43117ed856359be6bbc7082e75672f837d4e53d6948a448ad60f5e915a45557e83fdc3c5535cc8ccb93b5a13d43cedbeb0356ebad5bc706970e7efd1cc78fac897ffa3fd998cae873c6315ca19c515dd726b479b3b86e55f7688eb41be641918c2d2c6019c52aa1ecab2de967739b134aed179272f61f60d4d73a87d0e3f3c105511c27e981dc6a282c62d94b1ffee2bd27cecf156302808d2cb65fccc964c9ff621e68179e7f46c7a09aa33a4496588ac454204323de125cfac9c18189e7614947d140e332b50d4fa5f7ee49b6f545b579a3c3b4bc386aad781037b69c791c3fd3842c9b18ddbc96a26d834d635f47bdefb106b09efd4b5239a5d2891c800ac850eef9d7848330336a3260245d9b1bdaab1e5df5b6b74c388cf211e0cc5dd11079a2cecf2583c99250ab6f2bacdd4e9301d79f8c37b5d7da85330a469d34149e03ac71216287080a37f89b5fba2122814e7710a8448cada087326294aefbe8e1df71147e2cf4fec5e1ddd15cbb7a6eaf6dda352052af8b26c2930a0ea3ae34980f87d89d4479b0f8b020d3d52fd95959daa7051e43ce4e7c2ddee4f96d440e20f5b1f6ca93ffe8cc3f9140a0ccb7aeeb13c5931954ea4fd3f6f6793c037f3361eaaac482fee6e554ae6b9d393122ff19ec59b3afff6079361c72bcd60023d64215253d5deb0cc08bb1f8303f610ff4d89008237a72e57ec71c16ff7ea48d4c5aa9dd7470b05a37e9f1d9fbb68a2b544085e93358f9fac0dcdc00029c645ad0d7f1370afab6c219f4300a8d1eee9b6075124de7990d5878d86b83e644ffa0fa9619ab5eccc3b1ce365c166fd35140f26f50c9a3628dd4ba6d94657fcd802a9b41c27254e4876ee2dc7b1b3f927a4cbeaeed75de641073398f8f387dfef82a76e5aaa91dddbc56e7b79ef1f97ea9044c1044df3a6be7b4100357aec0f638e3d418d34ec7e55c37624c04203fe70654ddc548dc546adea9f25142ad682b09041f165706af0a4a75e0690b5b4443f2b974443177c945efb26db0f53f120c030118b622effbcc6df1692857d81e2ce2493ab7ee5be164d2f4aab0df18947fc1bf5b9347d9fbbb35af6aafe6d9ad906352fc1475814259b0b792090cccade7ee7d63c1c448bcb6b0e69f7a65318e9de1f23de1a3b8adfeabe55c64036314a6218088055d7c9e8a8086c510c7273ca961fd5211682ebb85a1258a3a4cae6b7c89add172320948331382e3a0ef7c80c3cb9db67582eccff8115eea25fd28f2feb75122daaf21a43de77b770b2e32747b1e0008d045ac5cc9fc3c6284594149c0c6440dd2c8de289239bd49b3c7d67e3fa8811c3875952ca5e9b9be083b32478f0577956d084f5329e4e4d7c1aa2e11f12d17781786abe35f6adbf4f16cb229db1065f9e79665c8a43490041749d59828dcbea1a726a6513e5dbb0727098f9c8c549cc50e2d12c19befecfe04f3bbb7b430b1270057993c1d34b053536f85811866829aa2050ce33dea67f9baa3f91b96e9ecce98228045074913dcd0b47f5dc1137b482cf1f3e3cd3b3eec149f0495e8c1ae8daadce3c64d410812dc0a5d86d1501bfe92804b560f04022f53b2917c7618aaf65abb54a85e8758cc0b067ccbb1fe5314c1f313f34465c8356c0ec23dd93f15e42145bf8c09ddaf262d49989769d287ac0e066bf4d5363f01e3314a8fdbaf7f53c060f2e8053804c9aa6598bbd386525012e957f6f646e5a5c0318cc63d1b30140252e45bec4a14c423a088a4b0e0959d6b2b68212c3ee2f13843f190b3e2257bfbc4a9d3263ed7bd51ba28d31ab33c8342b22e0d4a545ed6bfe4a34a17da7490e3608f93017137e5ce7be5ccd100df40843037505bacbd4bed35e0e3cf0b7272f4a3627302b1c91c2097f598f8b27fbfb560ac3187bf90e2c1c770043895a2dd386675cff6f96a5ec17a21e867dd941b496406205183fc45b1da6ebcc1e6171480a17aaa936b9db0887d2fba66ab09cdfefa74eee879f69cdcbff7c64541203c84986540edeba8d1e686a1849256590346309ca0353fc1c16daced3267d00d48704a6799706a6d01405b5015f4ce111ba33b4c925336f34ea70c42fb443eeb383f5f22bf2e33b4d9df9a876804fa85fbf8e6a42fe20f436a61cb79153b7956c03396e3449e3f95f8932e14b3f4b5536efdeee79089ffef9bc79b89a6520d9fa912f90fde03f390bb03b62bc3bcc51b1768a1bc5a64d3d3a757656ed7078b65a5dd108beffc13362f7528332a537cba1fd1a43183cb4573d89e8b9f61d4dbca32fbaf01bb27a78850e807a3a8b0f5d70e516918eea9606a32742167826c97a1c41367b12972f99b725e56aa7a56518d3476e8e923eecded4ebef562d715498d21a37165c16beb4f0782b2cffe9e645c18a6b2d216fd6d1aa08c3880470affaa3004350b9627b97b6f048acde69a7c4a75ffce90cd8cb53d16ebbfa7c9e192972451638556304dd1a85c3254d162991f2e03a046c598d8b66cccd3a1aacedabfbf2799ed94b2d34483eade701f90d054afaa86190122b1dd19e140ce2cd177823c3720857bc4d91cc6bc066d4a8b4489ea4c2a1621bbabf3702d83697fb22b81b2b02cce9ba2ecc6b1af8428c18e649d6b20d5c9d96160c93ffb00cab87737a51276599d220f778b316d769d6fb4ba39b94009c5b4c5c33a2c122f46da72aea876f60e535776fdd59146fc464204865f8dfec56453d57f7fb54796fee0d3c722226db5972985f772719b44ccde979cf334bc53ad4486838aa9d85ab22cf2fa5c0f6128a2b806833c8bb42d704497dbf4e81786c9ed7426bab7617d3bf1d706068fd2c08f477a24634af4fa04bc4d2e01ef0851586af9baa4264e0b3afb15ba60e78c18243d6dc58fbe572b3a2d8996c09fa88cee219c0d69c1c235fa0bc4fecb67bd8350dd3ec0039061f7908b7283bfe06ad96d8d62ac89eae56a447c3f3be9de7ae4f597fd96d83f48d30be513d6d569c65210accbd796ccbb92f1c69d0af351875f267d0b1e3cbd3d6b56e1b0961f7a9dc21d30bee9208cdccd4b4da892e107103818a0c176544f270fd2402a08b8b18ea1b8de85df9efaca12885188de5cfb6cb7b9b3791e46a05d9dc6e370363cef4aa0e20d6b3a0ff7c892779715c47d382a692a576ec1f99cfacd6c56cb9183f1af6c8d1d6a35f8fa63b8199b7ff9347d4a3bd4228c6873667c754f76d917f7133e4ee5859861d53fbe76eb4a2b3f3523d582feb0ce6bfb55f6f144f52590857271852d346f17c4f4418fd87e01f1ed75528df2e07e6eb49bfedc7b71e1f46673574dc34d03309cda43aab7bd01d717e4318a15abaf8099da4a0a1d725a0f4c1f6feebf6861ff6098fcf2dca500bff23d4ff96964c24ca8df138dd8466199ef33146ed9bf96ef8983382ef6a95298457a0c31532b1a65114c413ece1dd2c8534f2380162a2550bfdd1d5a636d233be5728f886053d9c9754c4858137be3687ab65dae4c0b1931fbf0ba0480201ae646f92325ebf1288f83ad779caf018e63aee9aa5008b988d59db7d1c4a4b62ced45ee621381f7ef12a81a86746d17b717fe2321e9bd9a43e0292397f78a1018db08f0113bed7d9d84ddbfe37b00f8176fe4c2726dc8c459e6c3e41f3c83712e2c3ceff7989022b6346c3268801d55f542f674c7f825f54a19b151a2c85216bf8e9b45208baed8faff178ca71b02bb516cb9cab9fe401e1af4e03d8c2db2a05a3a310d083fc44c6ad922549486f03dbbf06f64153781dc73be620c9b78ff3adeefe300e53474a8e9c4d486315ee4cd205beac96d58bb3119c7faacabea1b817573d1ce126b641d145ee0611b63273d1737668655bf6707eacc184b6199551b2c75eb96a8e8108f106ba9ad71e5a3ba9285ab3178a3f9d62811ef97848540a66961a9a409a0adb6df70d5f748a1e002c7e880326eccf46297fb88ad1d000151df808d9b2bca5906138d6185509c959dceca6baeb64f5602de9f65316d70ccf98ca139b7a56c45e149c0cfd37517cd1f18097666d4ff390eee78d1f85030946c4ca32d8ffe41b6a63a4e9b676cbf330d1aa2640338e90a3f2c5444c4678975c148d6ab00888cd37db70f0dbcb544f1e859950d2dd4f104ab798aad98f1f6cd3a058ecc6cd85d32ebe67540e5f77cd18079002986ff8c9a05ee54bb060e3cd9a5c5bf56996a3e43726d2624b432cfa01a93e7609be6774ec779f7a07eec2d53fefd2fa947a280bba9dcb762b02d946f2461056be9a67171efc7eb7333db0e9588849bdaff1e0b872036993f6dc6a41afb6e3409947d43d47eb91307ff0ebae26e5dbfa2a1bceee64833bfdde8c3df65b5b6ccc51e5770a4fd5e6feee03a1781cac33b8666a997d30a57861045c4e36571b4cae0414091a03079adc2270d321e45053169a46c3e2b0a35e39d7b0b752ea5d8f0fb1f49dc80bba3c18fe85e2d0fd1651c9be4d868d99f3fe220c305d3d41eb7bdfbae353d93a43c483986127542ab1659a283de46ede39fb4275f9bed8fa50bf6379ff04e876726e3616da1bf7990bf181258d3e7e9692e1566324a42424de1b88ec9fe6b5dd8c55ed558b570db0db1ef800131d1922b7e208c902bc7b8d77c662c3857eb4835c380cd5d43d3db25d718de0ffc80c1c08aa300cf25a7bfbec1830cffb5ac934e305689d9c3d7308049afeeb5e858dde23dd710e1ecda9a2ea8714c1e153e72f52031afa0f1da8647e9662b277ad58230efe0f2654ce3152b15eb3f6c9df03223cb912dfe0395c5c0d6d8ed0605b330940373260359f2eee87e15b402060e7a934f540bd0068661b1e7edb073b05bfa8f8a6055821c03f4367a2c836090e0c53ed533e9efe51e1783f6c609d7721e770893d6eb37397b0da614faec5b491aa6a6e4568b829a894ef13f745b3e7974762bf388288d04bb61dccdbdfef79d0726b4df59b048d88f4cca127712c3222153dc7e565c0cb83dcaaad1b77b40caf81a40a4c94b6c1eb3c9bd66934c318f9cd3dd8c6e63af40edf0b35ffd2a58f726ef5b6bcb3bd4f618166cba504c634e070939692de65ed62db65b5ea6e8b8e87ad5b3245d78a499657e8459e48ac3899884f5a2facd9599f92a9d62e18eddb6a2d843e24c56f494b31ed8e4c2fed0465e424933126ec33b54041b49bd762628e17fa15f995bcbec0ec60e9c6ccb83f8c86b05d0c0d01ca9e8e40da813038bb90fa7fda30ab939ef9f3d4b881f815e72b336e173fce3d97fce35f59274e869fa25450c984953053fdbd232b740da6dff8880cf1a1ccf12909cb8172e0e10be2b8d6331fb67fb3cc6cf6417d625f47f1e416a4df56dbf7c651e0500356abf0fa7782f6147322889d411a4023eb25da0303bf6ab7766b5f3d6efeac98ea63f177eb0eee56ab72d237624a50816f30ec2f30039513008aa41807723a98e3ba2abc02db3dae2b4a16eeb4b5fd4e11d922533111dc11ab6a73e189a04efc8fe7c8f23fabf3e5aa48cb91fced3f7219fb01af567e9b6edf864ebaf2d04321904201d87d87ae012d2a5c968361b2f0f9b5b733cd95c20ee35e9ac379f9466478aa864622d8a8ece4bf01b55b31f3d692feef28adca1fb66165f9933abeea923a26cdc15ebcab06906054577923fdf9cc45cf0872a30a6471b1a8f1b7990d4389be6fb7e484e892488b77337ab715462baa0def12ae54a80e48ffc8d1a64e9c4eb2874b4483ecc9c49ae27ec586efd053c88668e38a0d1b0404cf94a23ca8b936e3f8b630134b130f43f4aedc6e32ebe0d901acdfa7698cfa4db5537f166e0ce15e080ae0b3de98767a18bedd2ca487d5e85c3e26c4e026d95dc3ef82cd4cdc9c6235b7db51696f4101cbbef460f1d5d06b88b018051d90033fe36a61eab3b045d1f04bc39e86e47a17d01c112f84c133a1a376ef7fc203a38dab1d10d812f415f5990e08267fbe39f52733c08c477fc647d2a8ea1b743f467b92745035943493aef70a1e1f6fa6ba7ec62a952d3f439547748c9620241af6fd37a515b41c664276500b59d8ff2569e56d88df3e4e4c0bbd8b472826dffeb51673fa6f28215e47a2bf99e9534ce3560de56b8c4fb715b1493bbd114c1c25478a1d8ebed5437e7ce54efdd1cde2906624a2ff8fcb62ad71f30e1fc61ffb42d4d8568a910f7f2952d14f92a027c857f3983bb9730020e497796c5faebed670911493f2a61bd2652a5e20c52333b95fb40929f9e3a7db724a1db3fccda7a9879d93ad6e696755c8ebf50d8c703b8e10e5d0b23f8b496b0a72542def86c8898ec81f52b0c3c9ffe86a6a42cd6e581e46ff582c834fec792c94939ac6768d5d9a432b48b34bc70cce8486c5c79a516805d8861a75806b820c80134a2eaa9b84a3a22b849e14657844df23ffe21532cca5fae968d27bee7efaa8895f51a4391f2d45e9f8d9948362973bec2b1a0b32d880decacb42a866cc8f34876e5da4a6aa21838e0ea537ace813b9aef7c8a81b3ab86873656060f7e8e869a6b39fd9ef802cba7efb8ea2ced76c3546a60377ab3fceb989015f0b96064ee5fc11516ce344bbe6b44cd13ad35ad4ee43056c0d050f4de31173bc85e43ff754d093fb7d40941ca91896ab3628ad41e4b548bbc00ccd41a9a7eba424d3c587d0ec5874a6a0c6bd42929d82500838f3d42381973f22aa7d8b7535e17311befda18ff7230684f90eecabe1a7cf915b20b8e054b23f938d449b33f8664f2a17f884d617f91bfb15fd593512350dae77c7cb797c4e3e95b614d170c1d5ddf91ebfd27d9e3d4106ed4cc1755d02f7f15648849fed4eb5892183909ddfd554a2c2c6ea4314e7d28b1e313ac3e464c2956885cae8e9c3c4b9f850e9f8b972ac912f1f6c6aace7889ff90ad21e980c69abf31e24106cedd3d5da8909decaf651e86fe1e610aa4f2384ac55e704d6beacd249ac543953d9c8a1c353f1fb1de2debd3d775693e22cb5b3d5a36eb1e2cee8fa74f9464f773225164f6378367221c4b2e9356fa25a5e69c90e379b84d18f18b4316374d961365bc0ad599dfe8a4c10a3e2182e3d5f2b5e56fcd2d9274cda4bf91fbbf3e730b1f834d95d73770f27210be67c82a7a3327f45da6f7e78d3eb4c12064622e1eb899b78f6eba192f5ae83917fddf687dce0eb1538eb8dd6e33e1c18d09e17bea4ead13acd039332c1f8f1ecdd288e7661791ea1906b01fab26e69895e6cc34a723a7cc417fd68337e766cb58c5546477962f1c23061f48f85812806c60f9be72817831539d23f7cf25b7f2bdca91396f4383aa0799829dc691bbc8c20cad62c936f944e2d87d1208db835a9bdb754b18ff7a58f36d8de76e5a74b8f7c3d779bd9740d82b816589e56fb0223970f37de31d7d01a68d7e4b3c532958266930903dea9c5a933eeae484f36c54a5a5266d0ff252ad5b5a994b2851950dcbcfa8bf70c57026dc5b3ff861aa57acd1788b9e17276d66c49860f46082ba48128a43ef964368e1ef2c6e411d44988d09d232a8a0eb12efbc22534ff5f4b8f298aa41886e74045dabecbaf6c60073aa806cd90f979a59c8a80c56adb5d3658b328ae8fd6b104f014e88cb4c93c664c75084991ce61a5d674103a167f47018c869d00bf1a0b333460bd2b7d84cf427da4e7d37fc795041aaa87df067bbe90c039544978044117636e573f546caa8908cb6b048af1979824bead310a9adf34677ae9ace82b027f51b1ccbb71368ecd5f4e12e791084762c77eee2ef4f8c9a9d7f40c6f06ce446d7ab0afba7184410a6f109410267499a3f368d21c070e01d6e064b78e3f75e92f97367abf7cd9cca4f3f8b857b52699eecb4162c8d8e8a4e743ac7dc87645cc3c0ef13cb36e9a1239c7ad2c2f476499b73420bd0d57b20696ec744b2c92f0dd5a8c15f2d2ca727877e38813a0e7e2a8f3c55588f8827c4c52595eab833f5e2fcc9c5eb25e8276b530f52ace9e4b98b320e984ddb460f0cda05ea0a025d659f71eb6b79b8e05a18bf04a60f85f95562f31ad94d7c07a8fd331e2a05b3ebab758d304840d09dc9ff3539a16ab24d0b003029c2e9111477c9fde470fa9aaed4381b2c756d30d221624b5474a861a22e544e7f9e09dceb50370348235c4462cee872c5cd0ba4e7b40240fb7a9ac193448c44694ad3c0375ba15e497731bb1f25e6dc9c68bc99bdcc1bf0d6ac8240cdc62c18f53c616f54f5d60ce2506aa4530213390ac52c75b87d357e68211860b511767f6b89cb186ae5d58fbb9fc6d818bdf56e9e762108cf402ff53ce6321124abf30715dcf24a53dd5c60f5971de5b200e9c6992994a4b4a287882a7105af0660390147f0355cbf90af736d2c12eadd16f2b9d714346ce464efe7327d0956615dfb7ac562d8124f147a6fae95054280b8890ad41b170d50237bad76bca896326f16f6f70945b4597bb74558a98259732d65391d36f12904b668ea8cbef6b7fef2ce56db60637b63945e4ef8edd6319d917e4dea03d8cee2d2c529dd9c2506e96f76ac5bdacb8cf210eaa4f583e0ff8a4ecfe2fa16ada13b3ae8d65fece7b748e307380133b062aabe71c72c02fefff1c6d0a8d42f771fc959d3b388d89cbd27e575734f0dd5262dac4c370a19dfbbfa9a40bcb280d109b9136c2265a0a50b39c4aab0eb57016fd156141416e610c87767406accd421ed3df7aba314456ad0a90151d9ee3c0d88bfa957d473cdc89cbaa7dcbb8ed5da8eb8fbb1433d4e179e32233abac46d03b2c7d7f10a233da299116123f45d046915bf671d382f846fb156391472eaef582768272ea6e8aa7b59fa98965110fa7e930f3e1e8fffda23a385716f691bdbafedab387bbe75b7ced767462e2b2711fb044f1159aa31103505c2ba2acc78e4dbea9a3b4ede3ac8b2babc3f43bcdf97833feeadc0c9304c8919ecb7f64e79dc7c7f81ba76e0de6d0541d7e4dc508711863d6f1d3d2ea2995fe3c80459d135dafe9023cbb12b11ac4d15ad874c9a4ad44439e25ef795ffe4ac2d9c499e5d106d3054f24f391422a7c15d96d46fa805ab333ad340e0524ffc935d1f251e6e960428392d0c9613fb8164e5e73879a6601b86c5504b60c8082cbea24341b41f54962a0aa3ee58a029e30296c44cfdf81f4b9b1a295de73cca3845909a55426543e7e0907d98860ed16f48a08c043411001662d493056b9ae1e443a143f614cace519d18b70bb460e86004903d97fc679109f7f56538effcc274a39881f45922be87656b9723caec7994040370761f4e094ae8435ddd447af290814d7311b80c530fd63f32a7a38d7906792f52ccb62c830ff2d3dc03eb5e36ee33e22ac5f30f4dc3a73eede752126938093c9dd80cd6f33f95eb203bcaff0b0ae239163b80d50e388e3e1e4ac3db10a982aa7839ffefc72298695e4a0b5c96fbf32c057b36778193056a9dac5f857bb9240643bf6319f33aa6d04b7014039622b1835133ee545292d8cba8445051d4d7182f57823d87cbfb4a9640f9a7ceb7b6367b70a4f263fe3db82bcb634f542f8175692a07be3e6520f99a018a8cd98f08c053a7d9f45e18c51582416d53918c5492dcb91307b8614f18b06aa142c63dc3ef74c54e9c3f2fe8224d14779364cda6ad8b900af2b7d070be50265b2ba6ee4af172f5163c4b5020e5a5a85d391bc8d0b5e9a2b3376bc520666c3f35f2f767d8bf315ca26fdfac52d972aa800f0c69ccb479595bc890c789aa6af86cf539a95ebff652bb0d0bcad0e209a42264198a471996d8f13be1728eb0ea79b94eb933b4a667e723bcfddf9b9c47f489b3550df4c692d73963f05a03f17c4438ee91e8104673c37afddc199e0dbd8b4dd49c72570f6693ac60a373ad6f9bd0dd1993eda830fb0b9ac6f29bc7e155ddb6a99eb0c5d91dd3cdc5ccd42b181d131fe5c446aced09164c4921495107a8e0b206bc2ad65db56d4fa8eaff03de5b08072b03499b1362c1b75b9a0341fe42e8a4201fffec31c412687f3240a8082ce14aa21e4a4153c5cf6d300d3c1b595270401052f7774375e292e512a28ffca2f9e7a3f575e1446f8f2cbd75aff3f8fe5fce4e9dd2c9a36a79bc1239fdc2078902c29930bb6cdb0bedfb12f5d6adbe76a65f3930082ea152c61580a9d864263b69d497f630453312e047246d2fe63a915b35dad1bc9d8ce65b678eb34d6339f2a1e5c89110fbf7f9dc10218504c081fd27f7d113071cdcc463d946ed1db10ae69d6fc420acf248f52effdaa0e6c7a25245f6a389da8516eb447b4a863a6ffd7eff92e5302210ce866998aa41c2ae2122211e02bead43b0f0341159b0e81ab221cf4f65699fe125acb98227f94396d8dd7e9e21609966d987636ebf32f61072bd24bdf9120f04594964f413f1e2050f923b427dbb0721485da1d701f13af37c0641d0da5c9b940d7e142b6eb4b25490f1698e3fd372b83103d705ab4b7ff59fe770ba9feaa192b7e82f46886cc1235b36a87829045d7fc54572fb9e7270d9c03df8dabc770e822926be0d84e148870b1ec58d1f77e4c8f650f16cdb2b3f8f912334857fcbec6de444cec6bb79e0ccd59560f645a92d01aea7f701bc29431e51e22ae303aa76ebfa8a32f6634b10d2b830ac8ad8aa12b055d2b9cc6ccd99dc51a03e4fc884f4b6e9ae8ed793a8120816c8a6aecbcd43c88013456087e3b13c7b93726e402f4f1a9a526a86afad712b8417eedcc873b91fd07e8c1b9754bccd0f5195cc3e5a2278482224c80e2b90e26dd11f1e571ca5b46e6763722e11b1f7787a49e0ceaea816b4f59bf8fdafe50aa0d2d1e52985bda743d3d0a414821bb2ccd28df48b0672d9d9787bdd4372e8e685f5b63da869fbf13857fa5f695a327b371e9460df09881bd0a379ddab3ac5fb37cefb8414cd367f740033b3fc24071bec66026fa1668a252d06adb92fe0d168c978e89e57a8bb6807574055a479df881bc29d98df2e2ac8e706c5eceeca0b74f46f5fb62eb5c89a20dbfde7504473780140f992558a9bd4c194892dabf44e0e71fe00880a769ec6194bdf5902516469c0b79b9351be3922f2d77313ecffb0b9cc87966b00b33013f40a1d44c5601bd68390b31d1bb4e734642a53628be8bf03d42412228866c77dd9b274ea04bced65dcd214597b2578c126d94a4951101cd4b2bf00ac14202f17d892cb31d7fe2d15538beafa8b8d207a2cd10019cab6ceb9829155f37b3bbdf960ee0b6b74cd96a65ccf64fd9f452abc67b802db18ed6a25137ef11eb056bef6dc7930ed29f7b0e679f5a768b3620d2ff","isRememberEnabled":true,"rememberDurationInDays":30,"staticryptSaltUniqueVariableName":"e06b548b27a7e7d8dcac8c756dd3f2bc"};

            // you can edit these values to customize some of the behavior of StatiCrypt
            const templateConfig = {
                rememberExpirationKey: "staticrypt_expiration",
                rememberPassphraseKey: "staticrypt_passphrase",
                replaceHtmlCallback: null,
                clearLocalStorageCallback: null,
            };

            // init the staticrypt engine
            const staticrypt = staticryptInitiator.init(staticryptConfig, templateConfig);

            // try to automatically decrypt on load if there is a saved password
            window.onload = async function () {
                const { isSuccessful } = await staticrypt.handleDecryptOnLoad();

                // if we didn't decrypt anything on load, show the password prompt. Otherwise the content has already been
                // replaced, no need to do anything
                if (!isSuccessful) {
                    // hide loading screen
                    document.getElementById("staticrypt_loading").classList.add("hidden");
                    document.getElementById("staticrypt_content").classList.remove("hidden");
                    document.getElementById("staticrypt-password").focus();

                    // show the remember me checkbox
                    if (isRememberEnabled) {
                        document.getElementById("staticrypt-remember-label").classList.remove("hidden");
                    }
                }
            };

            // toggle password visibility
            const toggleIcon = document.querySelector(".staticrypt-toggle-password-visibility");
            // these two icons are coming from FontAwesome
            const imgSrcEyeClosed =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg==";
            const imgSrcEyeOpened =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzYgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTI4OCAzMmMtODAuOCAwLTE0NS41IDM2LjgtMTkyLjYgODAuNkM0OC42IDE1NiAxNy4zIDIwOCAyLjUgMjQzLjdjLTMuMyA3LjktMy4zIDE2LjcgMCAyNC42QzE3LjMgMzA0IDQ4LjYgMzU2IDk1LjQgMzk5LjRDMTQyLjUgNDQzLjIgMjA3LjIgNDgwIDI4OCA0ODBzMTQ1LjUtMzYuOCAxOTIuNi04MC42YzQ2LjgtNDMuNSA3OC4xLTk1LjQgOTMtMTMxLjFjMy4zLTcuOSAzLjMtMTYuNyAwLTI0LjZjLTE0LjktMzUuNy00Ni4yLTg3LjctOTMtMTMxLjFDNDMzLjUgNjguOCAzNjguOCAzMiAyODggMzJ6TTE0NCAyNTZhMTQ0IDE0NCAwIDEgMSAyODggMCAxNDQgMTQ0IDAgMSAxIC0yODggMHptMTQ0LTY0YzAgMzUuMy0yOC43IDY0LTY0IDY0Yy03LjEgMC0xMy45LTEuMi0yMC4zLTMuM2MtNS41LTEuOC0xMS45IDEuNi0xMS43IDcuNGMuMyA2LjkgMS4zIDEzLjggMy4yIDIwLjdjMTMuNyA1MS4yIDY2LjQgODEuNiAxMTcuNiA2Ny45czgxLjYtNjYuNCA2Ny45LTExNy42Yy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM3oiLz48L3N2Zz4=";
            toggleIcon.addEventListener("click", function () {
                const passwordInput = document.getElementById("staticrypt-password");
                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    toggleIcon.src = imgSrcEyeOpened;
                    toggleIcon.alt = templateToggleAltHide;
                    toggleIcon.title = templateToggleAltHide;
                } else {
                    passwordInput.type = "password";
                    toggleIcon.src = imgSrcEyeClosed;
                    toggleIcon.alt = templateToggleAltShow;
                    toggleIcon.title = templateToggleAltShow;
                }
            });

            // handle password form submission
            document.getElementById("staticrypt-form").addEventListener("submit", async function (e) {
                e.preventDefault();

                const password = document.getElementById("staticrypt-password").value,
                    isRememberChecked = document.getElementById("staticrypt-remember").checked;

                const { isSuccessful } = await staticrypt.handleDecryptionOfPage(password, isRememberChecked);

                if (!isSuccessful) {
                    alert(templateError);
                }
            });
        </script>
    </body>
</html>
