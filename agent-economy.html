<!DOCTYPE html>
<html class="staticrypt-html">
    <head>
        <meta charset="utf-8" />
        <title>Protected Page</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- do not cache this page -->
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />

        <style>
            .staticrypt-hr {
                margin-top: 20px;
                margin-bottom: 20px;
                border: 0;
                border-top: 1px solid #eee;
            }

            .staticrypt-page {
                width: 360px;
                padding: 8% 0 0;
                margin: auto;
                box-sizing: border-box;
            }

            .staticrypt-form {
                position: relative;
                z-index: 1;
                background: #ffffff;
                max-width: 360px;
                margin: 0 auto 100px;
                padding: 45px;
                text-align: center;
                box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
            }

            .staticrypt-form input[type="password"],
            input[type="text"] {
                background: inherit;
                border: 0;
                box-sizing: border-box; /* This ensures padding is included in the total width */
                font-size: 14px;
                outline: 0;
                padding: 15px 30px 15px 15px; /* Adjust the padding to ensure there is space for the icon */
                width: 100%;
            }

            .staticrypt-password-container {
                position: relative;
                outline: 0;
                background: #f2f2f2;
                width: 100%;
                border: 0;
                margin: 0 0 15px;
                box-sizing: border-box;
            }

            .staticrypt-toggle-password-visibility {
                cursor: pointer;
                height: 20px;
                opacity: 60%;
                padding: 13px;
                position: absolute;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                width: 20px;
            }

            .staticrypt-form .staticrypt-decrypt-button {
                text-transform: uppercase;
                outline: 0;
                background: #4CAF50;
                width: 100%;
                border: 0;
                padding: 15px;
                color: #ffffff;
                font-size: 14px;
                cursor: pointer;
            }

            .staticrypt-form .staticrypt-decrypt-button:hover,
            .staticrypt-form .staticrypt-decrypt-button:active,
            .staticrypt-form .staticrypt-decrypt-button:focus {
                background: #4CAF50;
                filter: brightness(92%);
            }

            .staticrypt-html {
                height: 100%;
            }

            .staticrypt-body {
                height: 100%;
                margin: 0;
            }

            .staticrypt-content {
                height: 100%;
                margin-bottom: 1em;
                background: #76B852;
                font-family: "Arial", sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            .staticrypt-instructions {
                margin-top: -1em;
                margin-bottom: 1em;
            }

            .staticrypt-title {
                font-size: 1.5em;
            }

            label.staticrypt-remember {
                display: flex;
                align-items: center;
                margin-bottom: 1em;
            }

            .staticrypt-remember input[type="checkbox"] {
                transform: scale(1.5);
                margin-right: 1em;
            }

            .hidden {
                display: none !important;
            }

            .staticrypt-spinner-container {
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .staticrypt-spinner {
                display: inline-block;
                width: 2rem;
                height: 2rem;
                vertical-align: text-bottom;
                border: 0.25em solid gray;
                border-right-color: transparent;
                border-radius: 50%;
                -webkit-animation: spinner-border 0.75s linear infinite;
                animation: spinner-border 0.75s linear infinite;
                animation-duration: 0.75s;
                animation-timing-function: linear;
                animation-delay: 0s;
                animation-iteration-count: infinite;
                animation-direction: normal;
                animation-fill-mode: none;
                animation-play-state: running;
                animation-name: spinner-border;
            }

            @keyframes spinner-border {
                100% {
                    transform: rotate(360deg);
                }
            }

            @media screen and (-webkit-min-device-pixel-ratio: 0) {
                .staticrypt-form input[type="password"],
                input[type="text"] {
                    font-size: 16px;
                }
            }
        </style>
    </head>

    <body class="staticrypt-body">
        <div id="staticrypt_loading" class="staticrypt-spinner-container">
            <div class="staticrypt-spinner"></div>
        </div>

        <div id="staticrypt_content" class="staticrypt-content hidden">
            <div class="staticrypt-page">
                <div class="staticrypt-form">
                    <div class="staticrypt-instructions">
                        <p class="staticrypt-title">Protected Page</p>
                        <p></p>
                    </div>

                    <hr class="staticrypt-hr" />

                    <form id="staticrypt-form" action="#" method="post">
                        <div class="staticrypt-password-container">
                            <input
                                id="staticrypt-password"
                                type="password"
                                name="password"
                                placeholder="Password"
                                autofocus
                            />

                            <img
                                class="staticrypt-toggle-password-visibility"
                                alt="Show password"
                                title="Show password"
                                src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg=="
                            />
                        </div>

                        <label id="staticrypt-remember-label" class="staticrypt-remember hidden">
                            <input id="staticrypt-remember" type="checkbox" name="remember" />
                            Remember me
                        </label>

                        <input type="submit" class="staticrypt-decrypt-button" value="DECRYPT" />
                    </form>
                </div>
            </div>
        </div>

        <script>
            // these variables will be filled when generating the file - the template format is 'variable_name'
            const staticryptInitiator = ((function(){
  const exports = {};
  const cryptoEngine = ((function(){
  const exports = {};
  const { subtle } = crypto;

const IV_BITS = 16 * 8;
const HEX_BITS = 4;
const ENCRYPTION_ALGO = "AES-CBC";

/**
 * Translates between utf8 encoded hexadecimal strings
 * and Uint8Array bytes.
 */
const HexEncoder = {
    /**
     * hex string -> bytes
     * @param {string} hexString
     * @returns {Uint8Array}
     */
    parse: function (hexString) {
        if (hexString.length % 2 !== 0) throw "Invalid hexString";
        const arrayBuffer = new Uint8Array(hexString.length / 2);

        for (let i = 0; i < hexString.length; i += 2) {
            const byteValue = parseInt(hexString.substring(i, i + 2), 16);
            if (isNaN(byteValue)) {
                throw "Invalid hexString";
            }
            arrayBuffer[i / 2] = byteValue;
        }
        return arrayBuffer;
    },

    /**
     * bytes -> hex string
     * @param {Uint8Array} bytes
     * @returns {string}
     */
    stringify: function (bytes) {
        const hexBytes = [];

        for (let i = 0; i < bytes.length; ++i) {
            let byteString = bytes[i].toString(16);
            if (byteString.length < 2) {
                byteString = "0" + byteString;
            }
            hexBytes.push(byteString);
        }
        return hexBytes.join("");
    },
};

/**
 * Translates between utf8 strings and Uint8Array bytes.
 */
const UTF8Encoder = {
    parse: function (str) {
        return new TextEncoder().encode(str);
    },

    stringify: function (bytes) {
        return new TextDecoder().decode(bytes);
    },
};

/**
 * Salt and encrypt a msg with a password.
 */
async function encrypt(msg, hashedPassword) {
    // Must be 16 bytes, unpredictable, and preferably cryptographically random. However, it need not be secret.
    // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/encrypt#parameters
    const iv = crypto.getRandomValues(new Uint8Array(IV_BITS / 8));

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["encrypt"]);

    const encrypted = await subtle.encrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        UTF8Encoder.parse(msg)
    );

    // iv will be 32 hex characters, we prepend it to the ciphertext for use in decryption
    return HexEncoder.stringify(iv) + HexEncoder.stringify(new Uint8Array(encrypted));
}
exports.encrypt = encrypt;

/**
 * Decrypt a salted msg using a password.
 *
 * @param {string} encryptedMsg
 * @param {string} hashedPassword
 * @returns {Promise<string>}
 */
async function decrypt(encryptedMsg, hashedPassword) {
    const ivLength = IV_BITS / HEX_BITS;
    const iv = HexEncoder.parse(encryptedMsg.substring(0, ivLength));
    const encrypted = encryptedMsg.substring(ivLength);

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["decrypt"]);

    const outBuffer = await subtle.decrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        HexEncoder.parse(encrypted)
    );

    return UTF8Encoder.stringify(new Uint8Array(outBuffer));
}
exports.decrypt = decrypt;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
async function hashPassword(password, salt) {
    // we hash the password in multiple steps, each adding more iterations. This is because we used to allow less
    // iterations, so for backward compatibility reasons, we need to support going from that to more iterations.
    let hashedPassword = await hashLegacyRound(password, salt);

    hashedPassword = await hashSecondRound(hashedPassword, salt);

    return hashThirdRound(hashedPassword, salt);
}
exports.hashPassword = hashPassword;

/**
 * This hashes the password with 1k iterations. This is a low number, we need this function to support backwards
 * compatibility.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
function hashLegacyRound(password, salt) {
    return pbkdf2(password, salt, 1000, "SHA-1");
}
exports.hashLegacyRound = hashLegacyRound;

/**
 * Add a second round of iterations. This is because we used to use 1k, so for backwards compatibility with
 * remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashSecondRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 14000, "SHA-256");
}
exports.hashSecondRound = hashSecondRound;

/**
 * Add a third round of iterations to bring total number to 600k. This is because we used to use 1k, then 15k, so for
 * backwards compatibility with remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashThirdRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 585000, "SHA-256");
}
exports.hashThirdRound = hashThirdRound;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @param {int} iterations
 * @param {string} hashAlgorithm
 * @returns {Promise<string>}
 */
async function pbkdf2(password, salt, iterations, hashAlgorithm) {
    const key = await subtle.importKey("raw", UTF8Encoder.parse(password), "PBKDF2", false, ["deriveBits"]);

    const keyBytes = await subtle.deriveBits(
        {
            name: "PBKDF2",
            hash: hashAlgorithm,
            iterations,
            salt: UTF8Encoder.parse(salt),
        },
        key,
        256
    );

    return HexEncoder.stringify(new Uint8Array(keyBytes));
}

function generateRandomSalt() {
    const bytes = crypto.getRandomValues(new Uint8Array(128 / 8));

    return HexEncoder.stringify(new Uint8Array(bytes));
}
exports.generateRandomSalt = generateRandomSalt;

async function signMessage(hashedPassword, message) {
    const key = await subtle.importKey(
        "raw",
        HexEncoder.parse(hashedPassword),
        {
            name: "HMAC",
            hash: "SHA-256",
        },
        false,
        ["sign"]
    );
    const signature = await subtle.sign("HMAC", key, UTF8Encoder.parse(message));

    return HexEncoder.stringify(new Uint8Array(signature));
}
exports.signMessage = signMessage;

function getRandomAlphanum() {
    const possibleCharacters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

    let byteArray;
    let parsedInt;

    // Keep generating new random bytes until we get a value that falls
    // within a range that can be evenly divided by possibleCharacters.length
    do {
        byteArray = crypto.getRandomValues(new Uint8Array(1));
        // extract the lowest byte to get an int from 0 to 255 (probably unnecessary, since we're only generating 1 byte)
        parsedInt = byteArray[0] & 0xff;
    } while (parsedInt >= 256 - (256 % possibleCharacters.length));

    // Take the modulo of the parsed integer to get a random number between 0 and totalLength - 1
    const randomIndex = parsedInt % possibleCharacters.length;

    return possibleCharacters[randomIndex];
}

/**
 * Generate a random string of a given length.
 *
 * @param {int} length
 * @returns {string}
 */
function generateRandomString(length) {
    let randomString = "";

    for (let i = 0; i < length; i++) {
        randomString += getRandomAlphanum();
    }

    return randomString;
}
exports.generateRandomString = generateRandomString;

  return exports;
})());
const codec = ((function(){
  const exports = {};
  /**
 * Initialize the codec with the provided cryptoEngine - this return functions to encode and decode messages.
 *
 * @param cryptoEngine - the engine to use for encryption / decryption
 */
function init(cryptoEngine) {
    const exports = {};

    /**
     * Top-level function for encoding a message.
     * Includes password hashing, encryption, and signing.
     *
     * @param {string} msg
     * @param {string} password
     * @param {string} salt
     *
     * @returns {string} The encoded text
     */
    async function encode(msg, password, salt) {
        const hashedPassword = await cryptoEngine.hashPassword(password, salt);

        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encode = encode;

    /**
     * Encode using a password that has already been hashed. This is useful to encode multiple messages in a row, that way
     * we don't need to hash the password multiple times.
     *
     * @param {string} msg
     * @param {string} hashedPassword
     *
     * @returns {string} The encoded text
     */
    async function encodeWithHashedPassword(msg, hashedPassword) {
        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encodeWithHashedPassword = encodeWithHashedPassword;

    /**
     * Top-level function for decoding a message.
     * Includes signature check and decryption.
     *
     * @param {string} signedMsg
     * @param {string} hashedPassword
     * @param {string} salt
     * @param {int} backwardCompatibleAttempt
     * @param {string} originalPassword
     *
     * @returns {Object} {success: true, decoded: string} | {success: false, message: string}
     */
    async function decode(signedMsg, hashedPassword, salt, backwardCompatibleAttempt = 0, originalPassword = "") {
        const encryptedHMAC = signedMsg.substring(0, 64);
        const encryptedMsg = signedMsg.substring(64);
        const decryptedHMAC = await cryptoEngine.signMessage(hashedPassword, encryptedMsg);

        if (decryptedHMAC !== encryptedHMAC) {
            // we have been raising the number of iterations in the hashing algorithm multiple times, so to support the old
            // remember-me/autodecrypt links we need to try bringing the old hashes up to speed.
            originalPassword = originalPassword || hashedPassword;
            if (backwardCompatibleAttempt === 0) {
                const updatedHashedPassword = await cryptoEngine.hashThirdRound(originalPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }
            if (backwardCompatibleAttempt === 1) {
                let updatedHashedPassword = await cryptoEngine.hashSecondRound(originalPassword, salt);
                updatedHashedPassword = await cryptoEngine.hashThirdRound(updatedHashedPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }

            return { success: false, message: "Signature mismatch" };
        }

        return {
            success: true,
            decoded: await cryptoEngine.decrypt(encryptedMsg, hashedPassword),
        };
    }
    exports.decode = decode;

    return exports;
}
exports.init = init;

  return exports;
})());
const decode = codec.init(cryptoEngine).decode;

/**
 * Initialize the staticrypt module, that exposes functions callbable by the password_template.
 *
 * @param {{
 *  staticryptEncryptedMsgUniqueVariableName: string,
 *  isRememberEnabled: boolean,
 *  rememberDurationInDays: number,
 *  staticryptSaltUniqueVariableName: string,
 * }} staticryptConfig - object of data that is stored on the password_template at encryption time.
 *
 * @param {{
 *  rememberExpirationKey: string,
 *  rememberPassphraseKey: string,
 *  replaceHtmlCallback: function,
 *  clearLocalStorageCallback: function,
 * }} templateConfig - object of data that can be configured by a custom password_template.
 */
function init(staticryptConfig, templateConfig) {
    const exports = {};

    /**
     * Decrypt our encrypted page, replace the whole HTML.
     *
     * @param {string} hashedPassword
     * @returns {Promise<boolean>}
     */
    async function decryptAndReplaceHtml(hashedPassword) {
        const { staticryptEncryptedMsgUniqueVariableName, staticryptSaltUniqueVariableName } = staticryptConfig;
        const { replaceHtmlCallback } = templateConfig;

        const result = await decode(
            staticryptEncryptedMsgUniqueVariableName,
            hashedPassword,
            staticryptSaltUniqueVariableName
        );
        if (!result.success) {
            return false;
        }
        const plainHTML = result.decoded;

        // if the user configured a callback call it, otherwise just replace the whole HTML
        if (typeof replaceHtmlCallback === "function") {
            replaceHtmlCallback(plainHTML);
        } else {
            document.write(plainHTML);
            document.close();
        }

        return true;
    }

    /**
     * Attempt to decrypt the page and replace the whole HTML.
     *
     * @param {string} password
     * @param {boolean} isRememberChecked
     *
     * @returns {Promise<{isSuccessful: boolean, hashedPassword?: string}>} - we return an object, so that if we want to
     *   expose more information in the future we can do it without breaking the password_template
     */
    async function handleDecryptionOfPage(password, isRememberChecked) {
        const { staticryptSaltUniqueVariableName } = staticryptConfig;

        // decrypt and replace the whole page
        const hashedPassword = await cryptoEngine.hashPassword(password, staticryptSaltUniqueVariableName);
        return handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked);
    }
    exports.handleDecryptionOfPage = handleDecryptionOfPage;

    async function handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked) {
        const { isRememberEnabled, rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

        if (!isDecryptionSuccessful) {
            return {
                isSuccessful: false,
                hashedPassword,
            };
        }

        // remember the hashedPassword and set its expiration if necessary
        if (isRememberEnabled && isRememberChecked) {
            window.localStorage.setItem(rememberPassphraseKey, hashedPassword);

            // set the expiration if the duration isn't 0 (meaning no expiration)
            if (rememberDurationInDays > 0) {
                window.localStorage.setItem(
                    rememberExpirationKey,
                    (new Date().getTime() + rememberDurationInDays * 24 * 60 * 60 * 1000).toString()
                );
            }
        }

        return {
            isSuccessful: true,
            hashedPassword,
        };
    }
    exports.handleDecryptionOfPageFromHash = handleDecryptionOfPageFromHash;

    /**
     * Clear localstorage from staticrypt related values
     */
    function clearLocalStorage() {
        const { clearLocalStorageCallback, rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        if (typeof clearLocalStorageCallback === "function") {
            clearLocalStorageCallback();
        } else {
            localStorage.removeItem(rememberPassphraseKey);
            localStorage.removeItem(rememberExpirationKey);
        }
    }

    async function handleDecryptOnLoad() {
        let isSuccessful = await decryptOnLoadFromUrl();

        if (!isSuccessful) {
            isSuccessful = await decryptOnLoadFromRememberMe();
        }

        return { isSuccessful };
    }
    exports.handleDecryptOnLoad = handleDecryptOnLoad;

    /**
     * Clear storage if we are logging out
     *
     * @returns {boolean} - whether we logged out
     */
    function logoutIfNeeded() {
        const logoutKey = "staticrypt_logout";

        // handle logout through query param
        const queryParams = new URLSearchParams(window.location.search);
        if (queryParams.has(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        // handle logout through URL fragment
        const hash = window.location.hash.substring(1);
        if (hash.includes(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        return false;
    }

    /**
     * To be called on load: check if we want to try to decrypt and replace the HTML with the decrypted content, and
     * try to do it if needed.
     *
     * @returns {Promise<boolean>} true if we derypted and replaced the whole page, false otherwise
     */
    async function decryptOnLoadFromRememberMe() {
        const { rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        // if we are login out, terminate
        if (logoutIfNeeded()) {
            return false;
        }

        // if there is expiration configured, check if we're not beyond the expiration
        if (rememberDurationInDays && rememberDurationInDays > 0) {
            const expiration = localStorage.getItem(rememberExpirationKey),
                isExpired = expiration && new Date().getTime() > parseInt(expiration);

            if (isExpired) {
                clearLocalStorage();
                return false;
            }
        }

        const hashedPassword = localStorage.getItem(rememberPassphraseKey);

        if (hashedPassword) {
            // try to decrypt
            const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

            // if the decryption is unsuccessful the password might be wrong - silently clear the saved data and let
            // the user fill the password form again
            if (!isDecryptionSuccessful) {
                clearLocalStorage();
                return false;
            }

            return true;
        }

        return false;
    }

    async function decryptOnLoadFromUrl() {
        const passwordKey = "staticrypt_pwd";
        const rememberMeKey = "remember_me";

        // try to get the password from the query param (for backward compatibility - we now want to avoid this method,
        // since it sends the hashed password to the server which isn't needed)
        const queryParams = new URLSearchParams(window.location.search);
        const hashedPasswordQuery = queryParams.get(passwordKey);
        const rememberMeQuery = queryParams.get(rememberMeKey);

        const urlFragment = window.location.hash.substring(1);
        // get the password from the url fragment
        const hashedPasswordRegexMatch = urlFragment.match(new RegExp(passwordKey + "=([^&]*)"));
        const hashedPasswordFragment = hashedPasswordRegexMatch ? hashedPasswordRegexMatch[1] : null;
        const rememberMeFragment = urlFragment.includes(rememberMeKey);

        const hashedPassword = hashedPasswordFragment || hashedPasswordQuery;
        const rememberMe = rememberMeFragment || rememberMeQuery;

        if (hashedPassword) {
            return handleDecryptionOfPageFromHash(hashedPassword, rememberMe);
        }

        return false;
    }

    return exports;
}
exports.init = init;

  return exports;
})());
            const templateError = "Bad password!",
                templateToggleAltShow = "Show password",
                templateToggleAltHide = "Hide password",
                isRememberEnabled = true,
                staticryptConfig = {"staticryptEncryptedMsgUniqueVariableName":"e21a113b500c30f66f8253eed69aedd360aadfea5cab479c96785aa18a61ffb6730df4c9c2337bc5463c7fc2f01840d662a35f7aa5fd38bda5b58b4f1d0be829f4845759c78f4f6730fa8fec8b582cb4dfb17102c4f244032f9a98a5dc76e49c38485a327d169e0857ade09b0a18f59d33224d9c4c85acc17e64333b74a135363d3970b2beeac71a0516624fa80049b1d3280e1033f1a2eeffbffd092e9ef4b6fc7608cd4c65d554dca170c5cb9e1557f672fd3486f0f6064e3fc980de392173dd32711e9482f11305c1e0df2e7e0098e9c8f55e99279ca49d3cbb61da39f6fd7f26dfd4c9f143d97c8b266edef0c8eb31bebb5b545e2cd19112261d798403bb491238dc2d26bca5f25081e83fb26a0e86098f616820679dced63ca61261f619756e0b64b7c122cc8e27a70c8b82cb7d030cafc513de3ae0493321cfce3de90f87bf3e970787e8f6c0a3eec548b834da58f77ff2b97d9ecb7141adda23746dfcce53b586dc862ecfd4cd8acc81b80b32b969f94f2c773093a0f49812d8814e6fe920e82b4f1ce4c18775082b57ab1f8387d6f14ff70a318577ee539a924cafa3052462b7d2f3f35efcaa46aa48197dde6b92945a1572ec3edd13cca8671ecce0abf3c2565b469d2f5380210213cca4b1fc4836ca8c328c7c8de770d8781051f8d25f12dc8e92f8108f7834d5190d544ee9f9721188ea690d835e947370fbd7335db6bc461eced8924a34e943547f62e4280a56d7d3744f6c7af800528ed6021b8e2d742e587565401a83607d8cc429a5474b5b781b6066697f28e46c89d8f5c2751112d162579723e865a2bfba2517b2d39e28bfca1efee6ad8b97d05a4778ebd024533fb3aa23fb8134110d88f629147542ccc1cab48d5e73036d466195b07bc39561dca1e1ef0eff04befe982f4b77ad3c60b85599976045ed6faa6f0252fc4e0e177cae8025f63678eb222bed115a3208b969e655b2b77012474609ea1561902703e751b4925721091d30d61517cc80c82d371e50ad590a211a189deb26a8ac23d2ca4afefd1744a08c1c72d8361acb38ae1a6662c49e319503d23699551bc799078e2b57150901fff623868624f3c1d605574fe4ea9c6e79096dc1950f43a98cd7c38b87160aa3f8002f6d605e7a5116352a856b7628fd9e68fb890526833ca317803a8ed9d86b7f8df14fa04db4852b30b2a7486a4757156bac555197997f90a99f16a0d777eabc18f71d886af6286ea074f3a6be99a862e8c69a0edcfefb040adf3451af1714976d6671f4f4d0a56e6f366e4fde0d47020a959f7a744ca7416c1faa3d8f5960134f42eecf37968da3f9c291e46775bf578b9b5818e348e685ab84732fc1fdec024eaa4870d0eb3323b8b6001a1caa953b561c902b022abc5298243fe68686306f9dac1b096da85dc2fb1e05d5fbfbe8d971cb7c7ca0365ad3c83eefdc3a873d525330f7fd5a429c31f15bf34593113adb2295e6c594b72d3ece89c8b79ce622531d79911c244a67258771c0268e59d20a4e3a0b4c1781b1f668a249c491ea42f191c5f54aa42769ff6fac47a05e8dc47b757640b44cb7e8d5be46c848285c72dbdee75e0259877eab4aaefea7dca70de0da3b400f09a388054beb54e4f4d8dc5437bbc9458243727489c3d5e8413799f25651e2d358c20c6fd0eeb30855d57cae1f7a76fce34ead326d3b9702a7f7b7c81e4cd4fd95b6573949d0387b750e6113606c3b1e946ec4520ae443d9b38224ece0dc1ec8168555875fd53da3a661394ebdb1ac3adecdd5ea573cac45adebb4b58f146896994d8919d703ec940513439e26b5632d71c9444d5616a3b8ef442b8a2c5c54d984311f32dcabfd50cb55bafcda42990f892dc7d5a788a46d7a3f28c7cde95cd68b729109281a2b0a805a1e16d42c5ad136265b255c853e9697cc924e7ee77caad3fb1487cdeba192d8fcf027e799f36f771d9963dce9aefc8c45db930003648e6860de4f5324acc226a319e9122ec865d3ae946230f9266814eaefd9a3586f8559b8f20fe7826ff5793659b427a9b8d0aef571648600bff7131ddb6409fe9bddf687d5d403e5408317125e1a5521d9ab7bd7e317723bc8ba563bec11e073fff40d1575a5fc1af607eb5072aa670dee2e3c40c341b34607a895b72ca50943fadcd9f6e2ae366e03fd91362e70d5a71cf379c4e594afa3697a774c8226335f1b7a060c690cbf8d72a73d5867dcc7342c80669dc6dee0bb610f388bf19de27e960ef0a96e88e457135ce8a47acafee9ec2036627eabebc14751a98fd4e7643ee6bb4e0139961670a4c3212ae439f36c35e4c70346f751da01d9b6165a90b8b7baf29ebeed86cfe97a079ba92c60792d3046c4a20788b8b65b93375a5b5f50319e18f43bb4e38a38425d5e158950846bd14e3f92c88b6ab9bc7928645970d9a8ef337abe69ad2bcb1e179c0e14c012179a508a02c01a68734839ce6317a90d6e3a6fcd2a76682b4cf4aa101665bfaaf50a66a71939a0feb5f80dbe938aabf13b0472537d6f098645aa0d23c055262e6b7cdde37d4c72dc0b603ecf3ab389cd8ec23eea0990ac27019000580af85d88b33c5237c0a6af95bda65cff10a445386db76d53116cd546e56eea6b36259ebdcd8dd5240c8cd8bfd70a3b03cbc4790a9d5f8281ff0c0d5dae0f2d3a09d9466160960a7da0609ef3bdde8950bdb9fc84a363e5271a9aa7de2414c710a81b3d110e469becc844941b6fc53493506bf0696a77381a42acf645b6391e32d40ef5a48214d399006ac25ba94e1d7847e331e7c07e696ee77d35755c6ad81ba5d3d304620c005fd6c05031bdd26e2827046f4efbdc5564d7f52bf6bacb77bc85ed1999f2416abbc82bb1c269361bc09082d02d76138d4cc67db66293beab48d41cbff87fedb3ddb7007002b801caa78c872ec6eda5d7ac7d7af5739dea1c92a37065dc29b9f7fe0c328a5e373271a406508274207de448217380ee3e0889f7f2a11f82523deb04573715218e95a91bcb3741c07101bba04bbbafbadb3ffeb0f8efcedb375a35b8eeea48afa1202b14746ad3ec2c456153beac98bc4b391c6fd89db41eea8a3ca7e85acbf7703056b9c4156f3acaf8f24da3e9f406ab8526c4258c84893bb084e9055361f6032c97a9ba30b808d14c9a94c8d8c523c7613f701d575453c39f24c5cd9029bdacfe03bdbe9dfcf5963094802520b080e0eb0e77e4a49f5841a65678d7e14674bca71dd927af33fa326320e60d3824a65e3720e7c1a5f9238f79047f0b6fea115f085d04206010fae4ee05392541070414ea6751d69dece991b94063458a7a30d98a80e48975891b807cbb21717bb76d0cacd18df4502f300d53d26a32529f66c246ec105194726adff5e2ac03ba1b3c10b8b16a360fc175a68305bb39fb7300ccfd0d89202e4afa24b6f73f7fd9eb1b5f7efbff852e7ba5c9f36d13fce620d4614634c2c4180dfc3a0824dfee99819856013a74a2410c7539efdf9b9a14b11c1b2f4adc543275f63061a495322a8e6e81f36ce2c6e06569b76d6946394eb9ad807ba2fdfd6bccec52f77c4d2c82f683d14d20228252d712651107b99292565c46d18d07eb6b7b5a4404a46f31e5b62c714acdcf88ec6ccf9e071648c56a147c3fad4463ce6f808001f4051a7bece306f40999963357c9089fef41213f6b709cdd02a2aebfffe7aa8678c2f596b3d4c1f04ee1590526b38e686ab49fc1d10376cf830752209a5d76d6b043cc330a6078702c67b7fc01da7dcca433c480aa98c2548e4a5e23e05a6b7849d39d2a0ab059e3a326e525108042d36dada285e87af31dec659291e4f3337e26fbf20b9c15502d1380a475b4b4c033be6374c87b50ca5de9ca83cff6939203b6532981f7b6596ec1723918954c85b2e2103ed4c6bb18e774693911b93dce408d664e6f01ec4ba2cca39a5743f2a4b74635a2d53b0eb1c218e86a094ffb399732d8ce9931527efbce8458ca8d0f2dc213d02beb68503907dd5a5c0f3b516f271e77b51ce7e8500f75ffe8759b59263d205b9ed313f6f1fe86596b50c0d0544281a7ee2c6d2c2f5af621b29346424a645fe0bb42c4f5221bc7404612cc7748cd1e2318b6a63dae0485e1f94266a07f66d4b0eeb0b4b7033aa14b8eb09f601ed5e34158f7f3fcfe760f10b4c2e82fba76366a14e7ad66e8677273aaed02948b5d6a7b8c6df65b7c8e172ab359f978df4e5a1bdc3aa13f916fb32732ba529761005a84412ee80d3f04465798f4747fde9ffd5ebf62d8fa17d7c01feacf58a88744eb199338de8f3848cce0e8ce68e5ccccdb4ce41c9106481066fc7bdca2736b269f6c91711f18b7949b1b66e58f799fb3d285fd7366aaef4a986e350924ff48289edf371a2dfa199f9a6739a3a075e9eb309c0755fb0253aede0c23d5e9bcfcd73d0c451c4a81a686dd28d9fa7569058204b8f44c3ba9e4f91384deff1474bf7db1cffd58f02ab96f94622f7fbd25415c39823810ac7df4bf262741e5ea4f5ef3f96e4584e0ec573fdfbd3c28937448b1cf171b983d1aca5291daa9598bb2db738222128fa0c04c8ade8e3b650f36e213c33fe12df8daeedafe0b2f8f4ef9edb384bf8d320f4151f73b6f3e3f0e78775c770e7503d1b1a8145ad791988dbb3c6831693e2f31470e2f9faa5b3506c94f8c9fbf6e511c0636761f84fc464e0aa96b3ede8c5f3d0c9e5fd9a1cbaa2c43bf60fa54b89bd822b5951feaaa91994d1de41f58d90580dc1c5fa097cbff475b0dcd710d77a7628fcfe0bf9edff1b343ca9842dcd8a3d04a619cf4a96e286c7358888210faf931bcf8424e5ceab85c208fb87aa6a72b4f310404622390541de468b0439702214508648566997f3bbab21b2403e576e5242ecdcb1dc25028286e4b0d404095670090ea27e8d88048bb287eeab17ff9743615bcb157677e6b6e32b607bc283caf3aa39630c7a83dece14a987de9fb7eec39474bd6f91c7e576ba8bfef7f31a80ff92fccd968cc09302f0226bc6aa8deb428d58e6828ff84bf7bbac746d509b00bbf3e675323185810c4b5b97e69fc5f0883595c96e41335f20383227c701a3e5f5e2b1c78baea02a926c772fd66a4504d4dda8ac3fb64535f6654087cb9e16b03b7aad7c476c5b99161dbe63a31310071321c93aa5102a70b713e8482847e67d836a8b13f76dae58bfd8fd50245733757781c243ab3967f1470553a872f6518270283851d71fbf3f6d359195b1590dc0f4417b670379fb56a3f5ce65c5cb0c8df93ab673b0950ed5db8a76a18bcc356e90da2459c2ddac6c2c065501c998ad1b978a4c4a0445590a85a9b13e01c5be04ce9c0d0718857a8ccaaf1a53e3e45c5f69128de5aa8e795c903ca6f745fd1a6062a0b06eaeca8e09f665d4bf768cb2d031fcd47d1353f72451f51409d4699fc94580a72e3bc4db5f2f83f020ec6e7db9f6da73396e1004de7d01252907d0166e8489ee9d0d27708318d0e08b31b3f98854befb43d8de4b4f52bb478491043ecc1434ad50da703e643dc446061a45db7de006733f62be8651dc5cbf401bfd3e1021609c185fec604f654d957fb5b62a4cbb18c2c91dfdc11ce6402fabda583740df236e14cdcf4390c15388763a7cdb3f4c7ef4f76f17012784a762842d397ae21ea70df18c17654275a9f45757da8ceff45951f2fed636bff904a1751c0fc496e749069a73f9831290b0d8b28d531fb9524787b3456b0fa47697d9e317f55a43c5d3f4211514235404d1f43ac758b2a651e85e85e507194c993a1b89011b97804d347c8d5b9824dddbcba9be2522448dcda064e26ec65095e87d3ba26a173cd3d076cc8ec0e861d2d5c18addb811a385a43f4d709bc7410176c65c04ed2e3d73a7c7c9a1e0526b83f99d81922e6586f0fa43f55220bd1ff47602de5843806919df55e9cefa86f45a6c4463fd1ffb888a2dc60978910b7854081104258e834e16fb5046b6889f872cbc3328348e025917f9b9229ddcf9b19ea62e16a0760c1c388bb5794262620c05aca94641b51e06baea7c5d67c7368702e6ad2031bb4731592d54edad7ce4d80cee2deea3950521f68a58b5b38089769e0849e32ea792f0ff3cba50e7e9c86395508579c87ce15226fa85ccd315ce73ab8f94b208d5dba331f806f394cb97041f1380415fb83abacd27b1b0603e42996b33f56d1f33e1ae2542fd86a3c7c12802ddf7cf6ae9d112fa3e4f042959f19d9ca21a3956801b847ee44658b2243bc17c154971740f51f7659bb6f048baea17fec075f00f369f4e4c1d0439cc4183d1e5580123460f9f60a94cf4dacd9ff944eebc0bb396f5325b6b8b76396f4896c3041c519c70752a782429313a362cf38ce15a5f416fb69af85a052ab8ccf686d3466ea7fefadc7d5581331ea13006345d0a493112d77a98559db14e451df9419f2c7fdcdf6f23a938938e5b34e5794014d03bcdf23a52680fda0eef9ae87258618d49bfe61698cf7cbbde7d2714bca1098981c322ad47576948b1c132bfd5df06425fa1e9647448da185c24c5a68206768b0165f0cf63202415ab8a43c515f4613706559524882f9e17396a83238ba53636d6ddbb2c6c09d6915da8551ea1afae71474debbb36e6f3e4f88d82628781a6d0b4047544db7a66985bb1dfc3ac92f48754962b3a4da4e3e9d6d22d2e1dfe6ef797c1302ea43e1f6f6daa439b1a0dcd631b1aea1e8667571a18fb925668f85068ded47244e6418e970a4695fb9f0609b641daef7b4b13790155f5cddcbc809f778f1a72472903f68528be30c04ab366982c48ad606bf4129073bec8b8f5d017d17631520e5dfda88f2819a9bd4fa0b007ca44f5153795a5ac4237aab96af60c1f6aa4ae8b64865150553dd0e3e8803f859badfc969399d558007b8806e0fddfb0f9b0281763dd2c4b9d5e8746668fa600b70de5d661a4c828b772238ea31c6cf5033ca94c729bd4c884d0abee1eaeca7ffcfd0f932e56b95b29b40a32b577177b9a9c56f934e67fab5885458944de4c1e4e07f9b856895441a94178fc467c64dc3a94e7b4c23d928b67361372f903b490f45394cbd08f1dcf62b6184e26c1014d1e00b6a883de69a5699441efd81668008ef75c7826f4444c536f63c723358b07ac1cf1ddd5039969b555c106d9e8ee5e16e5002ab04b7b3998621871c605e5f5b090f2a1b9dd286992244d21065c1ac9b9bc64f176872eb7b24402ebad67a0525e54581256b8d0b3b2420a78e07ad23bc74b70ac5f101c38013169ba3da584bea73e8baade576044a2711234659fe2317464e94a76ce11bc3a05c07829803bd45b91160d6ce192c01902fdf0ea8140b46cc0bca786efd3e5414ebfeaa505af6de10cc8e10e1938af3dfcca9ba807693d10316ea7f9c1668e13e2c383f0a5811272590866616ad05d122f4e84179fb069399335730becd418966f00944f83342b19c1cd68b129254b2e9f474e2a5fcdbeef65d9d9fa909ea905976b5273da3b37c05f349d7a52153a77694d576f1c32491dc72d4182a06fb39de9cd10dc1649580edc5a8555f823cf2829bca56004d564ec92cfc9a5aa69482964f522b73d985b55c6b872ad3b645f0217b8f9114026a1e25423cefae7f329a9d615ded8f6ca284c210238b611965d2c8e711a9c4ae8da32703fd4f68a881133fe20e0425e3656b14906623b00e8e2be86505161ab89d55fa1a28a4febdf31c94b3b64a257c93a431c898b78ecc3eeae3e90a65c06a3eff7f1a4457d41a5aa480ba04b2150ba24c738626c9b27188af4d89de5577d4ac2e2a1eeafa9dfc4eb787266c4db5e64243c44a8bbcbbb0c43e72f792039d1c8329701f1b0188d3356d9f08ea5f6a3455c018c72db485e8003c75317c42142322e63b185aedf8e29d6f55129c5de4453ec51567939b358a9a3912825e29f0c54d6c4cb7444dfff3d7ba268b49d030f581a4a0ef8a4e7886738082ff301776a20730825d811ba59f692d23c813756eac07f00d23146f34f1113a4931670b72705449ff5494da2e3c17908eddfcfa3f16ca13b496c489efb77adb64e152c76080ec1d1eb8706f5663b86024292551d20505966efc1466c4cf98f6d6875c01c8168f41e3a92c9d1431b82703f1a99b15d72cc2370293075fc3c380ca14494c23c2908acd75ec9f81873a6d2725346809b58f7f73b2cab3a9c12be9b88f138386b8f508b0c85890f9d6b432b2662413af93e8575f73d8bb0d492ad9730dbe6e3384e3583dcf9f47249ce9789b95d1c9321e2bc3cf98c1f4e6df3ada2ddb087fcaf18071d294826bbcfe32ee7dfc34c528ef8582da3f1e407bd0dbe7e84e5685c38b9efdfd2e6459ba6c0d17a247abc98adcd661653a3b9404c2d2a12b27130094104b45fbd97894328a3a097cb24ca0c8f0b1a5d3a98ca76111b346b97313e45b130a6d6db65b45d6c4f511036fd60c1c98072f1c18578f515592fe4f38b3221856f066c3275a326a7f8f2f8f6443822755dca841c5646c43cba3b1d77a3f83d797a477a5b0186301923e5437974da9a79f5bc992689c4d7c4d870c8bc0110b55fc6d36da74c503395a353c11bc2ee2fb5b38c8c4eda6a5e050ca74dfb7e78871e5340b68e43d61f5f38d51e0a940b2ba7cf9725fc789e5c97ceaa16cd882da66feb33b6bbce530b9de5bd517b0c34f800727902abd346d06c844459206e8f7ccc863ebbcdc7ab3e2daaa94c8ba404cb1ed577df50c1c5f58847052be7202150ccc8b862f2bf3971574cdcd9e27b4fcb1234b245a4aa52152d6468da536b933d6e138bb2932a43383fe932bb6cab0c5c212ab82c24fb25c237b34bc9b30fa6f5337e90199e0c3849b6f7c0e63e76bc1eb38cf550434c2e00b816d3ad4f18d921f6b82393530f65080264b6e5a165a39f5f7e7a19749cbe711d72e73f8b52e32c7d98769ed9d12d4144ae9dbb97d852d787d809f5ec7c041bfc2feb50e8959ea70a82a88c405c28e1c9e7c9e9d0d89928a6d9c6f8bb1720335db12a79989d50cb5c238aac9325f3fbd68dc62edcac0036b5df2366957a02b4f3cd89381f975b4a1e2d73d6e829b4eb4a0a97357bf959ff58c35423113aec9c2b3aaab5b358604918b723ac5fe37977f380cb44bf2b21c1bdc33d46551295ab10047c2a8fb0e9ed7fb63d0301187bc31354f99dab46beba1cf2078055f9a2b84b07b04ef6efd65d88bd3f3c1c01ea76a77e7be1d2d917715dd6a1ad9631df906865b1bc298f3463c65cb08b67729e6853d1faa920f6e7f60bd442f74d1e8d735795eabc415cb3339c2bd048a2b0c6171e21bfcc29c372d7048eea0e4c524c6fb6b47dc6f4cbd807e428f2e354f00ba85178cba3a85e8a3ccbc0944802d8a0d1514c0b885040547775534e78211b2dff98e6fec2cc30d1440a7855d7bade83c404ee161a6194d6e9689029a123c7ba20afa9ef4a0e37e6e034ca0f56a235920f22cf3b13237d16d6f2dc6e3556834bea8946b62633c2e90de5edb314a66c664e7cc62c9614273675acbd7bd2a448f5db553e1417103adc2571b3c5c15d03fd98b38757aca5c7eae43b751b18fda4117320f6d4c1322b1a4e4dd696c83773fb25ce52689149ff6b32ba9e0e0420b9a333ee8ddbb4db553ece7874126ded5113d335bd76e52f846a3cd70c7a02407740d47fbc1125f7633c6fed481b0b25e12d681cb8dbc0e59d8f9535c3d4927d90c2d599c585b416bacd60dabbbeaac75b390b495fc8683a5f804bc649ab5bda770c80bd00abee24b52606ce02507234b013a81156ec4731c52167ff54f493d12f51766ba499fe8c113db6936926407792b4f81a76384fe37651371ac142e99a8dc51669de072922b966fb0e4923385df36b27a7fcb2274e639a381ab08c8fe693a496471dc989830e4d11afabe38df0d32122038b69bd694bbf83a8cff4ca7ea061ed40f016235c0a3b9a3cce0ef3c7b53a74b7c718252a6d483a109bb09d59609088e597857c6ea6aa397938e540b8ca6a0568dc55e06dfc9aba59b1ae790a7731abf28c1ca7a347049eb106092de6d0b9adaeb8b992c838e73d4a0b7b3fb9552e6e790b07a6c08ee28b589428b4255f090538c5856fd7c488e0febd6af680f595608cc2ab21dbffbf4393caab5b3f88c3c9b2b2cfdf479c582ada9595f87c9d5095ab557836523df25faa60ff1dcb27858516a3b6aaef6adf5ffc3fc82588d9c12a4454e0dfa53d77517a9b8af299060ca58e21fa9042f57ea49f172d3e6cf41fdfa656f4a531fe104b99d1cd1e8d0f8cce397d5360386e071a0ae39670d194a8ecb55c8b27763e1360cb754ed2c4add241cb62a015a56590a7913652688ec7dbce548627c53e7cc144f00055ba599affdd7e0edc5f77f1306a2f41b5668a4c7b54b0cbf9227c644ab34fbaf2c4c9e4cc4ea91a4366a7b2f00f2d184e3f3574b63b3ff518c4eb7326a5e62d59a87dd3cadbf9c051bbeed83644a5f62d2cdee0555556bd806958d8c55bebab5f66927f7a0a7ec10971d80c6dc69902564cb8031381c7844c39d4d97f58926d3a165870a605e943f1b5223eed612583758c10d28da6c5d11fad3c4346d39890b46c2430b060e71c9be2e9b810252d41c372e1028fb31326d5711fc56a762a8b7888978e69c19467ac002f6987019d64bfdc108368eeeb61204ea271009bd0c021a5499104bfa3086e039db9fca0186f6c7dc6d561235dcca46f8bc39d9ec6f2e80f12f5c65e8be308df04476ff24827f4937c5fe52b6b2d734290d133d610b679fc60baf16e12b2755a52269c15299776b6733eff9d3f1d536f55db028cca6d8f37bc5bd87a0c79b2655ef80c009429420c4849755086ee4982f22f2c3f63eefbc6e9ca8655062aeb304ebdbb6b559b773db9ab7ed47446447f1b1971f5b44dfd975c97615d5d654cdc945dafb58e9b3470157ad629673ab6479af75bf0266c452eea83eb148e8b2dc003bcd2960f815559df3df34d7d13bc726f894831492d5868749541368da625e886f75633d9d2a35015fa5322d5a2c4d48ac1dcd94c3a6943cfad7310cb59c94826778122808af76e09d97155c333f5777a9c328d95b0e230e0a50d3ff4896ea66dcf925722c382259c61246ead6dce1e9f951cd5fe0d9e729905efe64923cc219f7317e1985255f59b7f4d56219a1e3fe2309574ee8b4ff066f6ce7bce3df5a514b6c3d48870465d62dae0bdf425541a087eb2bab8ed3734d58bd4d12ab1bbfedda89109d986077602827b755ea099e446f7e9ef5f927d9338ea0427f7331d2036eb42c4489719fc803e4f87142337f9b64b7441f51f84006ab11a07188fbc5306c2b6a12318fab75aac80d495a1a67631e1bc969ffe552a7be9c007b28d5ae16c118d7d5abb573b77199751aba65ba8d03a99a01254b336498f18e586d46da8fea6c746181a1403fee2e37462a1f1e84ea8caf66f151308501f0e04c7baf2f979c16bceee6fdcb2a4a66139a1a653f1c7ef4651c11ac5bec058ea86e923441132bf1fa9794e26d1305a69c271becedd5c0ee377066f14badb51587a999bff28e5fc0279169ad11574857779a82fd50adc6717ef0bc717b27e08cec1fd289011c6218aa9dbee2c6fb1a21e5051f97ef3ae7768e6b26f18f66146dd38dc75bbaba0eef4789083de35a301095ab510bca4a09c5a27dd12cff2e98cd47538577bdf4ab1e7dcb80f78c0c3ec29fda8b7d79a083b24218c48e8c468a2e4411d9b2658158738c6416e400e8a985153b4dd12eff36cd156adb5f94f61beba6f8f36d1e23df7327596e8d1231afe2e5eca0a3e73ac56fdcf758c965826a669a7ba3bdf181280f97007f6d9a8116258d5f6988df2d5498dd43ae5740422e63d10f1980a179c5634e07951988a8b121f43f1b22e1dbdfcd5db2b1eaed02da225846dea3cb134964f4156630d25b836fb950ed90b28cb45110172383b3ecd9f5940fc329319e51c9df85f02c0b2a7a0523397b1ff8923504a8742b57ecfbae4ac8e41c8f629629901274cc97ec723f2f14b313b537062a4d0ae43b76a08de1f45dbe26935bd553762bc9fee57440ad92abcbbd760300517f4637a7ad311e0ee1e82c82e0e316e411c7f0a64bfddfe41a758da4f4263b1584ebb7676d444027cd49949a8ccb2994cb55435f61522d5423f1cb7a9311c9cda796b852cb35b89805c3369e2e31e65f36313034c01210448574ba5a0a4e133a4a61b2d9c795dc5fa56450b4aa946388aa371b6d29e9e04fc775d53bc392317b4e20d91ba3e03eb8f486150810b6a339beb42532af97bd0f1536420b463f4a53793636a7e2c8fee3825be814046a2fcfee0205422db4d21f59f6ae050ba76cb94baa71e62e81ffaea02c76c9988a7667fd00d23acbd4a70e56c7b4e080fd71447d510b9de80f2738567e938ec903606a74f11d6579183c33bc6cb979b1a86255c1522c32199f15561e0c708f0c37991493d615497a297b8b0cccecc2ab063ccb94f3612d22e9fe959702c7119afec71fef4f876fda43ef76ecddd625f31991263362afdc35ccdbb2c48b2dca8b258bede59aa1865f34ee780036c4ec6cc64d379b92139381ade4657aabef8653b2ce23fde9ebc66648dd3202fe36c0d3aaedd23abbd80635c264b3d2c94e90ca7a68fb4865c729097deb83725eea5a7a3ea79ef07ddecdfdbf9a5ba3fe47ad195be8e316bbd19c529ba1d8e469facd25ac9ff70561b71e8adfa434b8420c63f21c89517cb770251e565688e3f24d791f68ccae55925553cadb7df507ba6a25427306c73427393ab5b190faf9efaa8bf890261253a169c9fd0d7d3b7df5f21c6bec43432988abeae355558cdb92db4f6f93e51030a8ab1604f7b5c6c9bfd6de529d75f5d160f8ed83b9e1837d3b6488708d408870880ac522a9e6b59609e7216628bb84fb1b1fb6ad57d42bdede4d40d665f14cd0649f2b12b4884939dbf56a123f747b5fa33206f0d87f360a4e756a1e04a411a49d43070b64197dc7f3d27009ba53bacbdce472bed2927d80892375756a137cfcb57938cd9b7e68a57ac3098fd48dd41cec6e439c9893ebf8a35ee1f5f0a6f04ec30b74161a6b7bd518729c948863c05a2e0cb2e3d34cb783f8a9339554016b14679f323d83c446512ce59652490e5f24c0132d859e1707c3e17169a68fdc37d8b010c10cd6924f074aa141993f07febd2d8d4a3b2efa337ec0814a533188404154773bc4278de09795402b15735931dc1e9a2917a67d36b1e657e77ef5cb427f7fcc8238e2f7075ee1a824b99f9a0940fc91ae2eacbb23a46914da13a5cad7997bd532baf0ae5d5f74b99d3ea5df87ebd74d35222d9d33f299b37ec0e6d249bfc883686e51ff56f032ff082dcf0e247eaf8d64d257bb2fa17646d083c1903243f01a9d0e4e061feb18be0909873037439c46a2f40cd2409bb553af4a978c286b20a8d92dcec9ca309902210abc177047719a7460a8dbe7386f57781f0c6a8b18aaf9dde0ea89bcab3bded894ab1fc1338392ec3b19160cd932c822669e3b79460f360da42c8c44327b23de9d4a3321ac6d78023bbcc116701520844e839ce7db55d503ef4eb0fd7657e4d3daa033b7703864759c4a2c2e0284981bb184efa5f7f8bb5ddacb28988a5e120b01310c16464a57d4c48960eb7bfd68d11da5b2392689cd81ae37745e17a4736c7efe46631573fd95f018935d05d21df5e6425a4ac0aaca6148835def550a69664411f518903bc4592a7420a95746cc774d2f32efe1c3e1e906d246c0ae985d64458050625cd2a879ced460c2fa659cc1a25d7aa72d8fac391b0d8fee6b35153787095b41cbc6d5287eba227d9717dbe09e322e8516a7915fdff57c0dade34b2d41bcba419eba3cb7e457be66fde778aa0e23d32c938cab0046bb8bca87e69fff64bd08125b515d71ecc0116a0d7300686c2622488d87c4bc491cb5dbba0f802a64086ce9373870d6e6dd321f1418b06cf4aaeb789601ba21151b86429b2ba435c49488455fb0fa4de1d37511d70994c6970da3e74fb250092a0626e808eb800f0e04741b4643ffa5960a289453c8f06c43731caca6b2b767b7ecbb38fe2603b7da5bbe85754ee8b49e9ea26344e6bef925da1aeb2cdf07871a2eba7f123723578cb3b4c866d7081bac3e00fd13c88ecfe2a482bd4b9b07165f18a73b31c6377992545f3cea7234f3c33a67cc4c846716a3f64c76cfa0ffaddf7fdf9c849e3480621860b8de9c7dddc76565f5135d59b3712461f67032522508a41615163365026999ca08777ff341c3c00061de0ba67215fa3e65a0956080d9a47b0981134d4a84c99c283244707f9ac09e2c4dfadad8c00202d184e798406e67af96d5783dbcb04c850b512f2843254b5c0016b7d17762d609ecbf88425a650a5d5de351d9a004347d770e30c10984bd0e63cf673ca1a2fa4ebd8c663ca0cf6554c8e608d1af651d3347995ddebd1354717c1b893ed5d677a6cbf756256c2a1f013ce433ced842c4c597da5765d72dd4775d36f0ef9bca03815ce8f8c7b84cbfc6345cc5474700fddff12ae31bdf0aa2ff52ee68ef4cca1766a859370a3c586662f136413d7c28dbeabd6c3e2a663b6293ff2db400ffd2c0071854bd1cf3c6e685ea63734560ea638d5e492fc7bf6c7114b7a8f1245375130c0cf48621985c99718dc83e656869bb05325ff0b8eaa0f5167b179713774df255556b23048189d21b1c92fc4476b12d395b7e94043d5a39ea4aea3503e1d073b76d999d6e9d245086ce16c00ababffa3fdbd0bc000d5df899d58688ab5bf3dd09ee6da0f5842c0879995e16d649cf7bd745b2be78cd9a2314a3ece99ba01d86a74b83f7966f1df5bb2d59e096f0ec635f69d6498ef46435457007ea07fe49af5af04d1342ef60fb16646d39832769785ba9abb999734a1f531e4be0ffbd599f0f4c45005eddfbb188092b352a43405acf256ec9e6b878e0d3cfb5911fe3748b9a2f837ddc6a09ecf391827fa4b83dc5bede1ea0269778ae4dea3836ba65444e9e495170191f96787bc8ff1470b38c8dda2554ec52ddfe9893e0d681e6abe437676acc1bd881d566aad2437f1825e9bc1dbbec5df8f9d39e407deb5ed335e9419657e125fca7e6e5deecf2e27b4ddad3998415f3bbb8161df1f3e789ab553f94692b27757aee7a9450e13533aaeea7a054ab4623572b606d3906a00895c28f652bbd23b76bd979dc75e6a328c183cd3dad62adbda51bfbd1f39ffcff8c1f775fdf95a8b1c67495d1dd7478b3624407c8a29e7141005ecb5bdb2f3271a02e06e29b34745398c59d8c6605478cbd1d438f512b9cd66e714ffbac22e418fd8ba0726664584b2774793fb64fa859a2855952d97e6448c05a36d23d796dae0171fc60b9160a390c37f1017edb2e8ab42e198e3872786af1bfc08fb1a7ea564a33f27ae9ce5a6ec81d755cefb0fa438220e0bc8a326dd49cb008e4b07211f86281a02b49d3bc71a7a8153b17ce7c8fb1d477758a2adea3e9dc2a966201fb399129fb14645e265e41c579f9e7a8358ceb5d753a2273bc21d9d9e481ee49ab1d4a4795192ac507d6416c602774003e9c1cff87b5ebac982298f68f1da67924a2ed10df66e289a3a57168b1f699f92540c2e2328497d19963756a2c6a3e4c38b017bf855fda048b49f182c0c0f4c2bcbc68f1d70e57c87374f1053661e476b3bfb3ea9f6d57bdc973fe073eb2c4393a5a4004fa62773bc7326d30caf0c7571bdcb352b7b619db9f5528351fa2e7420a1fd60c0d218bb05897573ba45cfe3744cd3319ecf0701f585523c952bd4ff54513d713633c17e6a1154d5ff79d5f90fd4568485bff668500ce5bec16a0dabd5a084d08febfe3a8a4f2645d092a1fb5221f98277beca747380341fa7b7693e1c9e05130726e169878978e382c8cdc2ac17c412dee3e85a8159d3b715f694539e9be739eba07","isRememberEnabled":true,"rememberDurationInDays":30,"staticryptSaltUniqueVariableName":"e06b548b27a7e7d8dcac8c756dd3f2bc"};

            // you can edit these values to customize some of the behavior of StatiCrypt
            const templateConfig = {
                rememberExpirationKey: "staticrypt_expiration",
                rememberPassphraseKey: "staticrypt_passphrase",
                replaceHtmlCallback: null,
                clearLocalStorageCallback: null,
            };

            // init the staticrypt engine
            const staticrypt = staticryptInitiator.init(staticryptConfig, templateConfig);

            // try to automatically decrypt on load if there is a saved password
            window.onload = async function () {
                const { isSuccessful } = await staticrypt.handleDecryptOnLoad();

                // if we didn't decrypt anything on load, show the password prompt. Otherwise the content has already been
                // replaced, no need to do anything
                if (!isSuccessful) {
                    // hide loading screen
                    document.getElementById("staticrypt_loading").classList.add("hidden");
                    document.getElementById("staticrypt_content").classList.remove("hidden");
                    document.getElementById("staticrypt-password").focus();

                    // show the remember me checkbox
                    if (isRememberEnabled) {
                        document.getElementById("staticrypt-remember-label").classList.remove("hidden");
                    }
                }
            };

            // toggle password visibility
            const toggleIcon = document.querySelector(".staticrypt-toggle-password-visibility");
            // these two icons are coming from FontAwesome
            const imgSrcEyeClosed =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg==";
            const imgSrcEyeOpened =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzYgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTI4OCAzMmMtODAuOCAwLTE0NS41IDM2LjgtMTkyLjYgODAuNkM0OC42IDE1NiAxNy4zIDIwOCAyLjUgMjQzLjdjLTMuMyA3LjktMy4zIDE2LjcgMCAyNC42QzE3LjMgMzA0IDQ4LjYgMzU2IDk1LjQgMzk5LjRDMTQyLjUgNDQzLjIgMjA3LjIgNDgwIDI4OCA0ODBzMTQ1LjUtMzYuOCAxOTIuNi04MC42YzQ2LjgtNDMuNSA3OC4xLTk1LjQgOTMtMTMxLjFjMy4zLTcuOSAzLjMtMTYuNyAwLTI0LjZjLTE0LjktMzUuNy00Ni4yLTg3LjctOTMtMTMxLjFDNDMzLjUgNjguOCAzNjguOCAzMiAyODggMzJ6TTE0NCAyNTZhMTQ0IDE0NCAwIDEgMSAyODggMCAxNDQgMTQ0IDAgMSAxIC0yODggMHptMTQ0LTY0YzAgMzUuMy0yOC43IDY0LTY0IDY0Yy03LjEgMC0xMy45LTEuMi0yMC4zLTMuM2MtNS41LTEuOC0xMS45IDEuNi0xMS43IDcuNGMuMyA2LjkgMS4zIDEzLjggMy4yIDIwLjdjMTMuNyA1MS4yIDY2LjQgODEuNiAxMTcuNiA2Ny45czgxLjYtNjYuNCA2Ny45LTExNy42Yy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM3oiLz48L3N2Zz4=";
            toggleIcon.addEventListener("click", function () {
                const passwordInput = document.getElementById("staticrypt-password");
                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    toggleIcon.src = imgSrcEyeOpened;
                    toggleIcon.alt = templateToggleAltHide;
                    toggleIcon.title = templateToggleAltHide;
                } else {
                    passwordInput.type = "password";
                    toggleIcon.src = imgSrcEyeClosed;
                    toggleIcon.alt = templateToggleAltShow;
                    toggleIcon.title = templateToggleAltShow;
                }
            });

            // handle password form submission
            document.getElementById("staticrypt-form").addEventListener("submit", async function (e) {
                e.preventDefault();

                const password = document.getElementById("staticrypt-password").value,
                    isRememberChecked = document.getElementById("staticrypt-remember").checked;

                const { isSuccessful } = await staticrypt.handleDecryptionOfPage(password, isRememberChecked);

                if (!isSuccessful) {
                    alert(templateError);
                }
            });
        </script>
    </body>
</html>
