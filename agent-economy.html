<!DOCTYPE html>
<html class="staticrypt-html">
    <head>
        <meta charset="utf-8" />
        <title>Protected Page</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- do not cache this page -->
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />

        <style>
            .staticrypt-hr {
                margin-top: 20px;
                margin-bottom: 20px;
                border: 0;
                border-top: 1px solid #eee;
            }

            .staticrypt-page {
                width: 360px;
                padding: 8% 0 0;
                margin: auto;
                box-sizing: border-box;
            }

            .staticrypt-form {
                position: relative;
                z-index: 1;
                background: #ffffff;
                max-width: 360px;
                margin: 0 auto 100px;
                padding: 45px;
                text-align: center;
                box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
            }

            .staticrypt-form input[type="password"],
            input[type="text"] {
                background: inherit;
                border: 0;
                box-sizing: border-box; /* This ensures padding is included in the total width */
                font-size: 14px;
                outline: 0;
                padding: 15px 30px 15px 15px; /* Adjust the padding to ensure there is space for the icon */
                width: 100%;
            }

            .staticrypt-password-container {
                position: relative;
                outline: 0;
                background: #f2f2f2;
                width: 100%;
                border: 0;
                margin: 0 0 15px;
                box-sizing: border-box;
            }

            .staticrypt-toggle-password-visibility {
                cursor: pointer;
                height: 20px;
                opacity: 60%;
                padding: 13px;
                position: absolute;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                width: 20px;
            }

            .staticrypt-form .staticrypt-decrypt-button {
                text-transform: uppercase;
                outline: 0;
                background: #4CAF50;
                width: 100%;
                border: 0;
                padding: 15px;
                color: #ffffff;
                font-size: 14px;
                cursor: pointer;
            }

            .staticrypt-form .staticrypt-decrypt-button:hover,
            .staticrypt-form .staticrypt-decrypt-button:active,
            .staticrypt-form .staticrypt-decrypt-button:focus {
                background: #4CAF50;
                filter: brightness(92%);
            }

            .staticrypt-html {
                height: 100%;
            }

            .staticrypt-body {
                height: 100%;
                margin: 0;
            }

            .staticrypt-content {
                height: 100%;
                margin-bottom: 1em;
                background: #76B852;
                font-family: "Arial", sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            .staticrypt-instructions {
                margin-top: -1em;
                margin-bottom: 1em;
            }

            .staticrypt-title {
                font-size: 1.5em;
            }

            label.staticrypt-remember {
                display: flex;
                align-items: center;
                margin-bottom: 1em;
            }

            .staticrypt-remember input[type="checkbox"] {
                transform: scale(1.5);
                margin-right: 1em;
            }

            .hidden {
                display: none !important;
            }

            .staticrypt-spinner-container {
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .staticrypt-spinner {
                display: inline-block;
                width: 2rem;
                height: 2rem;
                vertical-align: text-bottom;
                border: 0.25em solid gray;
                border-right-color: transparent;
                border-radius: 50%;
                -webkit-animation: spinner-border 0.75s linear infinite;
                animation: spinner-border 0.75s linear infinite;
                animation-duration: 0.75s;
                animation-timing-function: linear;
                animation-delay: 0s;
                animation-iteration-count: infinite;
                animation-direction: normal;
                animation-fill-mode: none;
                animation-play-state: running;
                animation-name: spinner-border;
            }

            @keyframes spinner-border {
                100% {
                    transform: rotate(360deg);
                }
            }

            @media screen and (-webkit-min-device-pixel-ratio: 0) {
                .staticrypt-form input[type="password"],
                input[type="text"] {
                    font-size: 16px;
                }
            }
        </style>
    </head>

    <body class="staticrypt-body">
        <div id="staticrypt_loading" class="staticrypt-spinner-container">
            <div class="staticrypt-spinner"></div>
        </div>

        <div id="staticrypt_content" class="staticrypt-content hidden">
            <div class="staticrypt-page">
                <div class="staticrypt-form">
                    <div class="staticrypt-instructions">
                        <p class="staticrypt-title">Protected Page</p>
                        <p></p>
                    </div>

                    <hr class="staticrypt-hr" />

                    <form id="staticrypt-form" action="#" method="post">
                        <div class="staticrypt-password-container">
                            <input
                                id="staticrypt-password"
                                type="password"
                                name="password"
                                placeholder="Password"
                                autofocus
                            />

                            <img
                                class="staticrypt-toggle-password-visibility"
                                alt="Show password"
                                title="Show password"
                                src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg=="
                            />
                        </div>

                        <label id="staticrypt-remember-label" class="staticrypt-remember hidden">
                            <input id="staticrypt-remember" type="checkbox" name="remember" />
                            Remember me
                        </label>

                        <input type="submit" class="staticrypt-decrypt-button" value="DECRYPT" />
                    </form>
                </div>
            </div>
        </div>

        <script>
            // these variables will be filled when generating the file - the template format is 'variable_name'
            const staticryptInitiator = ((function(){
  const exports = {};
  const cryptoEngine = ((function(){
  const exports = {};
  const { subtle } = crypto;

const IV_BITS = 16 * 8;
const HEX_BITS = 4;
const ENCRYPTION_ALGO = "AES-CBC";

/**
 * Translates between utf8 encoded hexadecimal strings
 * and Uint8Array bytes.
 */
const HexEncoder = {
    /**
     * hex string -> bytes
     * @param {string} hexString
     * @returns {Uint8Array}
     */
    parse: function (hexString) {
        if (hexString.length % 2 !== 0) throw "Invalid hexString";
        const arrayBuffer = new Uint8Array(hexString.length / 2);

        for (let i = 0; i < hexString.length; i += 2) {
            const byteValue = parseInt(hexString.substring(i, i + 2), 16);
            if (isNaN(byteValue)) {
                throw "Invalid hexString";
            }
            arrayBuffer[i / 2] = byteValue;
        }
        return arrayBuffer;
    },

    /**
     * bytes -> hex string
     * @param {Uint8Array} bytes
     * @returns {string}
     */
    stringify: function (bytes) {
        const hexBytes = [];

        for (let i = 0; i < bytes.length; ++i) {
            let byteString = bytes[i].toString(16);
            if (byteString.length < 2) {
                byteString = "0" + byteString;
            }
            hexBytes.push(byteString);
        }
        return hexBytes.join("");
    },
};

/**
 * Translates between utf8 strings and Uint8Array bytes.
 */
const UTF8Encoder = {
    parse: function (str) {
        return new TextEncoder().encode(str);
    },

    stringify: function (bytes) {
        return new TextDecoder().decode(bytes);
    },
};

/**
 * Salt and encrypt a msg with a password.
 */
async function encrypt(msg, hashedPassword) {
    // Must be 16 bytes, unpredictable, and preferably cryptographically random. However, it need not be secret.
    // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/encrypt#parameters
    const iv = crypto.getRandomValues(new Uint8Array(IV_BITS / 8));

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["encrypt"]);

    const encrypted = await subtle.encrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        UTF8Encoder.parse(msg)
    );

    // iv will be 32 hex characters, we prepend it to the ciphertext for use in decryption
    return HexEncoder.stringify(iv) + HexEncoder.stringify(new Uint8Array(encrypted));
}
exports.encrypt = encrypt;

/**
 * Decrypt a salted msg using a password.
 *
 * @param {string} encryptedMsg
 * @param {string} hashedPassword
 * @returns {Promise<string>}
 */
async function decrypt(encryptedMsg, hashedPassword) {
    const ivLength = IV_BITS / HEX_BITS;
    const iv = HexEncoder.parse(encryptedMsg.substring(0, ivLength));
    const encrypted = encryptedMsg.substring(ivLength);

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["decrypt"]);

    const outBuffer = await subtle.decrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        HexEncoder.parse(encrypted)
    );

    return UTF8Encoder.stringify(new Uint8Array(outBuffer));
}
exports.decrypt = decrypt;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
async function hashPassword(password, salt) {
    // we hash the password in multiple steps, each adding more iterations. This is because we used to allow less
    // iterations, so for backward compatibility reasons, we need to support going from that to more iterations.
    let hashedPassword = await hashLegacyRound(password, salt);

    hashedPassword = await hashSecondRound(hashedPassword, salt);

    return hashThirdRound(hashedPassword, salt);
}
exports.hashPassword = hashPassword;

/**
 * This hashes the password with 1k iterations. This is a low number, we need this function to support backwards
 * compatibility.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
function hashLegacyRound(password, salt) {
    return pbkdf2(password, salt, 1000, "SHA-1");
}
exports.hashLegacyRound = hashLegacyRound;

/**
 * Add a second round of iterations. This is because we used to use 1k, so for backwards compatibility with
 * remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashSecondRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 14000, "SHA-256");
}
exports.hashSecondRound = hashSecondRound;

/**
 * Add a third round of iterations to bring total number to 600k. This is because we used to use 1k, then 15k, so for
 * backwards compatibility with remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashThirdRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 585000, "SHA-256");
}
exports.hashThirdRound = hashThirdRound;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @param {int} iterations
 * @param {string} hashAlgorithm
 * @returns {Promise<string>}
 */
async function pbkdf2(password, salt, iterations, hashAlgorithm) {
    const key = await subtle.importKey("raw", UTF8Encoder.parse(password), "PBKDF2", false, ["deriveBits"]);

    const keyBytes = await subtle.deriveBits(
        {
            name: "PBKDF2",
            hash: hashAlgorithm,
            iterations,
            salt: UTF8Encoder.parse(salt),
        },
        key,
        256
    );

    return HexEncoder.stringify(new Uint8Array(keyBytes));
}

function generateRandomSalt() {
    const bytes = crypto.getRandomValues(new Uint8Array(128 / 8));

    return HexEncoder.stringify(new Uint8Array(bytes));
}
exports.generateRandomSalt = generateRandomSalt;

async function signMessage(hashedPassword, message) {
    const key = await subtle.importKey(
        "raw",
        HexEncoder.parse(hashedPassword),
        {
            name: "HMAC",
            hash: "SHA-256",
        },
        false,
        ["sign"]
    );
    const signature = await subtle.sign("HMAC", key, UTF8Encoder.parse(message));

    return HexEncoder.stringify(new Uint8Array(signature));
}
exports.signMessage = signMessage;

function getRandomAlphanum() {
    const possibleCharacters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

    let byteArray;
    let parsedInt;

    // Keep generating new random bytes until we get a value that falls
    // within a range that can be evenly divided by possibleCharacters.length
    do {
        byteArray = crypto.getRandomValues(new Uint8Array(1));
        // extract the lowest byte to get an int from 0 to 255 (probably unnecessary, since we're only generating 1 byte)
        parsedInt = byteArray[0] & 0xff;
    } while (parsedInt >= 256 - (256 % possibleCharacters.length));

    // Take the modulo of the parsed integer to get a random number between 0 and totalLength - 1
    const randomIndex = parsedInt % possibleCharacters.length;

    return possibleCharacters[randomIndex];
}

/**
 * Generate a random string of a given length.
 *
 * @param {int} length
 * @returns {string}
 */
function generateRandomString(length) {
    let randomString = "";

    for (let i = 0; i < length; i++) {
        randomString += getRandomAlphanum();
    }

    return randomString;
}
exports.generateRandomString = generateRandomString;

  return exports;
})());
const codec = ((function(){
  const exports = {};
  /**
 * Initialize the codec with the provided cryptoEngine - this return functions to encode and decode messages.
 *
 * @param cryptoEngine - the engine to use for encryption / decryption
 */
function init(cryptoEngine) {
    const exports = {};

    /**
     * Top-level function for encoding a message.
     * Includes password hashing, encryption, and signing.
     *
     * @param {string} msg
     * @param {string} password
     * @param {string} salt
     *
     * @returns {string} The encoded text
     */
    async function encode(msg, password, salt) {
        const hashedPassword = await cryptoEngine.hashPassword(password, salt);

        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encode = encode;

    /**
     * Encode using a password that has already been hashed. This is useful to encode multiple messages in a row, that way
     * we don't need to hash the password multiple times.
     *
     * @param {string} msg
     * @param {string} hashedPassword
     *
     * @returns {string} The encoded text
     */
    async function encodeWithHashedPassword(msg, hashedPassword) {
        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encodeWithHashedPassword = encodeWithHashedPassword;

    /**
     * Top-level function for decoding a message.
     * Includes signature check and decryption.
     *
     * @param {string} signedMsg
     * @param {string} hashedPassword
     * @param {string} salt
     * @param {int} backwardCompatibleAttempt
     * @param {string} originalPassword
     *
     * @returns {Object} {success: true, decoded: string} | {success: false, message: string}
     */
    async function decode(signedMsg, hashedPassword, salt, backwardCompatibleAttempt = 0, originalPassword = "") {
        const encryptedHMAC = signedMsg.substring(0, 64);
        const encryptedMsg = signedMsg.substring(64);
        const decryptedHMAC = await cryptoEngine.signMessage(hashedPassword, encryptedMsg);

        if (decryptedHMAC !== encryptedHMAC) {
            // we have been raising the number of iterations in the hashing algorithm multiple times, so to support the old
            // remember-me/autodecrypt links we need to try bringing the old hashes up to speed.
            originalPassword = originalPassword || hashedPassword;
            if (backwardCompatibleAttempt === 0) {
                const updatedHashedPassword = await cryptoEngine.hashThirdRound(originalPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }
            if (backwardCompatibleAttempt === 1) {
                let updatedHashedPassword = await cryptoEngine.hashSecondRound(originalPassword, salt);
                updatedHashedPassword = await cryptoEngine.hashThirdRound(updatedHashedPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }

            return { success: false, message: "Signature mismatch" };
        }

        return {
            success: true,
            decoded: await cryptoEngine.decrypt(encryptedMsg, hashedPassword),
        };
    }
    exports.decode = decode;

    return exports;
}
exports.init = init;

  return exports;
})());
const decode = codec.init(cryptoEngine).decode;

/**
 * Initialize the staticrypt module, that exposes functions callbable by the password_template.
 *
 * @param {{
 *  staticryptEncryptedMsgUniqueVariableName: string,
 *  isRememberEnabled: boolean,
 *  rememberDurationInDays: number,
 *  staticryptSaltUniqueVariableName: string,
 * }} staticryptConfig - object of data that is stored on the password_template at encryption time.
 *
 * @param {{
 *  rememberExpirationKey: string,
 *  rememberPassphraseKey: string,
 *  replaceHtmlCallback: function,
 *  clearLocalStorageCallback: function,
 * }} templateConfig - object of data that can be configured by a custom password_template.
 */
function init(staticryptConfig, templateConfig) {
    const exports = {};

    /**
     * Decrypt our encrypted page, replace the whole HTML.
     *
     * @param {string} hashedPassword
     * @returns {Promise<boolean>}
     */
    async function decryptAndReplaceHtml(hashedPassword) {
        const { staticryptEncryptedMsgUniqueVariableName, staticryptSaltUniqueVariableName } = staticryptConfig;
        const { replaceHtmlCallback } = templateConfig;

        const result = await decode(
            staticryptEncryptedMsgUniqueVariableName,
            hashedPassword,
            staticryptSaltUniqueVariableName
        );
        if (!result.success) {
            return false;
        }
        const plainHTML = result.decoded;

        // if the user configured a callback call it, otherwise just replace the whole HTML
        if (typeof replaceHtmlCallback === "function") {
            replaceHtmlCallback(plainHTML);
        } else {
            document.write(plainHTML);
            document.close();
        }

        return true;
    }

    /**
     * Attempt to decrypt the page and replace the whole HTML.
     *
     * @param {string} password
     * @param {boolean} isRememberChecked
     *
     * @returns {Promise<{isSuccessful: boolean, hashedPassword?: string}>} - we return an object, so that if we want to
     *   expose more information in the future we can do it without breaking the password_template
     */
    async function handleDecryptionOfPage(password, isRememberChecked) {
        const { staticryptSaltUniqueVariableName } = staticryptConfig;

        // decrypt and replace the whole page
        const hashedPassword = await cryptoEngine.hashPassword(password, staticryptSaltUniqueVariableName);
        return handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked);
    }
    exports.handleDecryptionOfPage = handleDecryptionOfPage;

    async function handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked) {
        const { isRememberEnabled, rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

        if (!isDecryptionSuccessful) {
            return {
                isSuccessful: false,
                hashedPassword,
            };
        }

        // remember the hashedPassword and set its expiration if necessary
        if (isRememberEnabled && isRememberChecked) {
            window.localStorage.setItem(rememberPassphraseKey, hashedPassword);

            // set the expiration if the duration isn't 0 (meaning no expiration)
            if (rememberDurationInDays > 0) {
                window.localStorage.setItem(
                    rememberExpirationKey,
                    (new Date().getTime() + rememberDurationInDays * 24 * 60 * 60 * 1000).toString()
                );
            }
        }

        return {
            isSuccessful: true,
            hashedPassword,
        };
    }
    exports.handleDecryptionOfPageFromHash = handleDecryptionOfPageFromHash;

    /**
     * Clear localstorage from staticrypt related values
     */
    function clearLocalStorage() {
        const { clearLocalStorageCallback, rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        if (typeof clearLocalStorageCallback === "function") {
            clearLocalStorageCallback();
        } else {
            localStorage.removeItem(rememberPassphraseKey);
            localStorage.removeItem(rememberExpirationKey);
        }
    }

    async function handleDecryptOnLoad() {
        let isSuccessful = await decryptOnLoadFromUrl();

        if (!isSuccessful) {
            isSuccessful = await decryptOnLoadFromRememberMe();
        }

        return { isSuccessful };
    }
    exports.handleDecryptOnLoad = handleDecryptOnLoad;

    /**
     * Clear storage if we are logging out
     *
     * @returns {boolean} - whether we logged out
     */
    function logoutIfNeeded() {
        const logoutKey = "staticrypt_logout";

        // handle logout through query param
        const queryParams = new URLSearchParams(window.location.search);
        if (queryParams.has(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        // handle logout through URL fragment
        const hash = window.location.hash.substring(1);
        if (hash.includes(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        return false;
    }

    /**
     * To be called on load: check if we want to try to decrypt and replace the HTML with the decrypted content, and
     * try to do it if needed.
     *
     * @returns {Promise<boolean>} true if we derypted and replaced the whole page, false otherwise
     */
    async function decryptOnLoadFromRememberMe() {
        const { rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        // if we are login out, terminate
        if (logoutIfNeeded()) {
            return false;
        }

        // if there is expiration configured, check if we're not beyond the expiration
        if (rememberDurationInDays && rememberDurationInDays > 0) {
            const expiration = localStorage.getItem(rememberExpirationKey),
                isExpired = expiration && new Date().getTime() > parseInt(expiration);

            if (isExpired) {
                clearLocalStorage();
                return false;
            }
        }

        const hashedPassword = localStorage.getItem(rememberPassphraseKey);

        if (hashedPassword) {
            // try to decrypt
            const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

            // if the decryption is unsuccessful the password might be wrong - silently clear the saved data and let
            // the user fill the password form again
            if (!isDecryptionSuccessful) {
                clearLocalStorage();
                return false;
            }

            return true;
        }

        return false;
    }

    async function decryptOnLoadFromUrl() {
        const passwordKey = "staticrypt_pwd";
        const rememberMeKey = "remember_me";

        // try to get the password from the query param (for backward compatibility - we now want to avoid this method,
        // since it sends the hashed password to the server which isn't needed)
        const queryParams = new URLSearchParams(window.location.search);
        const hashedPasswordQuery = queryParams.get(passwordKey);
        const rememberMeQuery = queryParams.get(rememberMeKey);

        const urlFragment = window.location.hash.substring(1);
        // get the password from the url fragment
        const hashedPasswordRegexMatch = urlFragment.match(new RegExp(passwordKey + "=([^&]*)"));
        const hashedPasswordFragment = hashedPasswordRegexMatch ? hashedPasswordRegexMatch[1] : null;
        const rememberMeFragment = urlFragment.includes(rememberMeKey);

        const hashedPassword = hashedPasswordFragment || hashedPasswordQuery;
        const rememberMe = rememberMeFragment || rememberMeQuery;

        if (hashedPassword) {
            return handleDecryptionOfPageFromHash(hashedPassword, rememberMe);
        }

        return false;
    }

    return exports;
}
exports.init = init;

  return exports;
})());
            const templateError = "Bad password!",
                templateToggleAltShow = "Show password",
                templateToggleAltHide = "Hide password",
                isRememberEnabled = true,
                staticryptConfig = {"staticryptEncryptedMsgUniqueVariableName":"1de336b162a01af1941d16257c9d6740a2cff3d11ff5af17ea1fcce670c667ab69acde3ce486904f58b003575ed63230e82c584ae489f067e7d848ee055ca8f2d7b0ef91bbd654eea55833f60b143b18106a9aad669082df98ed497e6b2fa4c545d05f0c79192352134668445f7ffc1aa4ace73f110430670fdfff09e230edfc7c9e6942d682060f62fa464f843efa96fed92adb22caeff359712738c002c064422004b1302fc812ec0bbccfde4f12be5026c7bd7796a3a8f014d2b122c27db4dc3d48d3f0e65ed6eae354bdcf82ab02327b033ef7c415bcae9cad1267c8f7cbe9952b1f6eec780c400c58a1d7a36c927016a080d01912ec6117972509aea347c41a03603371e6872667b75edb30a2cf4f01868edd9f213674f7a001cd74ad454f05ceac6271bd612145a0f9e259bfed27aadaf25c51a186c3cf57c969ecca6cbf990b4a265f35a5b041e6064902d0ed466ec202a8bf504a23830fe1be3ca4b6759eb2308ffea00a1620a53b6b517bdab3623620c13c17a810d440c22f6a5ce018edbfef76a7d3f3c7c7280e64ab0818ee3e0ab147b6b2fade432ef9a542a94c1e4409838c7ae6573743133d359548837ddd5c27e4fa3113030b32339cdc3e3a31a21ebcf7bc3767f481570fd795fcd1077af963950cb4edfee1d77fcfef7699f97a56c0e65f7a127848f4508de2c45dd467c23851a05e33acf717dd89b6c3166bb6ea16fe3bb3308fee9a453c94bdb2a34c248afcac2ee1a0fbadb3c103de755ebbfbc498cc4afe143938cbcca5c1f3b0b57a67877ef94bbe07c206ec332007ca92f155951e142740a57c62a1dc81d56a734f11183a01f2ec7d051a643dfc149b03e3b41a6ead038403afe9c7807af2308530ece326e8842bd23aa380c17c2131bffb91f9b6a783d7f0f590557c1d51357807c8998e3b7b814016b205b8f59ce35be5bd28212ac1be0d51da246502730438dd328c099e578b8d2e3da75f8bdf49eef7ec5356c04e9398b5e7b9b0f45ddbfdd86fd2277bb2e29d2e1dab72bf1f9c58ba3ed8887937600f495ddbc9ece42ea26ebe2c3365dba3dd6857a8876084926bcf1e504349ffa791de8d0ac54d66a1b6e83318d9994a274a69dc4e51a94d016b23c727a026485ddd09c3924d1b871b20dd66deb07c9426c6c07a5627bc9a2d1e867f7da23a8ec6930d304c6217e758828d97998b699f3dd4321557785931f6c7c5b99e36d2c172bc0ce074b21513a5c0d88f1a511a88d123f5c9f3591815e6b1a97642dfffbabc68b87b1ec0d51f3460e044fcb579fc90ddb12db2b8a31064b126022672be3170d350a59a9840c0910bd1b4322b9f847718cc27f6449b18f10157a9109f783b122b799c345ed66849e9dfe40fdc10c983952c60b369c021a879a935503e2b145fd363efb788a6b42a5208b1721d0957314e66d0a2317f9043623a978e63e6f39ad2a06468672e5ba360e87b2319d004306f5cfc2a10e59a5832b720ea005e19108d13e31b86037fa6c31432c43780bdcc97000c9bb4b1cd3c0ccbdbdcdc7cd83582a074ec124617f6b84cf783a45a7d12bdbb7089944d71d1424744f5c03d9f218fd933d681a3da144547d246074a130534b97f5e44da7e4e4800653c51b53367fc84e5e57971ace397fed81e592680022865038daac186e0d1f47e8c4aa0a3d00226511b5d608a7177b2385984a2273c229a2a2263c3f89885f00be11f0f7ac296090ec137cfa65618e562dc1897cc4ae7b52060eea829d3dcce8516215c3af50ebf3cd61bd8c35cbdf8ae7a215e58d47c9943eda1f037b1c445978e38755757f73c173f8b38a5627f022fa21a4051d9cfed9ed391dc8aefffca29f730477d1fafc57164c8cefe78ace91be8e970dd795d33a12c98e469e5d8a18f67dc163c938e84028d9791de55363b3c0b3fcee69cb8060ba624ba4c7ad08266847e34c76dbb6c23cd56f3b01f9f5fa7dc38e72773179f6e8914c98b2972ff38a94a91c45c03b712eeaa7e1148bed2b80c89debcefae5a83b33748e1e73b184afc03206c6aed1955c9245dec8987c6a6564a4e7e5df53028d2fc6d46696abed675ced3a813fb2bc9b662c9c0accb5fa3a77209a4bdc0a18f9fa9a6eb0023e28e02165699803c35fadc06543cab58e182ac580546e286da11c5d4b183c0a64357114a60a499edafe6e40138df10f67cefb4fdffe44041899db3a6cfa4570ba423ec78e8e7391a14b38e215a8eed230e2953462da074926d960c7d651e50e8de5f60d700863c7ecfa9ec1fb0349f9f1c8de2c73870b397b69bb7a55c02d371cd22c98ff0307380271a34605e719c2a82e20fb84dee94a07749ac16765804d3943ad6ba9a44297b0624bb61776dfab6930694522d047755c7935d6fe16fea3c3e0c5db05da2a0ccb4f564150c8d809fd6426fa9eab66e22422d073d214863d5e635473544e7fa1c6106415677e1271fc97f6ea2da86f4d5e8f5c249eb0d49260f7ca31afd9762d75ecebdc0fe780019b496d52386f053420b61c6003a25a7da1f5e89ef6615e2945d7fb5bd620b2eab313a240f89731292a4591f9c9e69a36336c3ac0d6424d8ad8baa518761e894ce7d9d704bc7c2c0fec01b1dc2c1f1f191ecf3bc76f40d160d07b61f3d6f9b8506fa04f0b703c200b7b634290c51b42683d87f431bce5c35a44af7a1e8301932de454662df57eab8afd375b52a6a3735b9a27ad17452c4283f57c7e2051477b9990442430d2ed418401f398568795264e37693304809939e5937e2673d5cab90df86e25ac2dab4db17228da317e6a61e228deb5bb345c5173c1cd9d77171f60c5a5a15bbacf279560583ab6e1d613717574db990b9e116e389758d35267c483a6235c2fbf9f0572a7f74bfa35410199ced8e205f51130ac9ef8ff457fc99bd0351e41491a7d691656ab7933dbc5505072075ba208f96f6612eceb79ad44a62649b351acb25a7cfed8d9825bf7cff67292d78381ad96519c21218367177c8baaff2c343ad62adde8acd3967dbeaa03e64098fa2c785c6b8924ff3ce743099129c7eca763bd7cff455844e845c40bbc17bddd6729f9ee16cc92a67f55b5e1441740d9ae66911d6984a9cd5899a3aa812ebcf2f3ef602ec710a512ee13838721da2773e68c599804ea8e6c2c1a368c0473bbcd721e23ee2312e2784f04b41262cebfb6f9c2ae9ecc99af5637d0dddf2b88e91108e6e628aec0dd967733c7a707a2871cca88be39bedca9d6aa73a1122b41c3034118ab4c849dc404009c1bdba9ea10d0cd5bb89e92b401acfa236cfd47df7df81cbe0c76b285f75244703cb2f11c6df42af31e930e1940b47c03ba6cafa59cac6b78fe866d9d98213faa62e66758453f90ec1954ce36d757291d4995a74be100e9562d347f52f9e64d464deb9263b3395aa9286750b1a25421383be956ff17296dec86af2f8a65e1a2bdcb35f316fe035efb35b5ad44c6f1581d8b4bfcc74b1c6c10e53d505211112be0cd367a2ff291bdd2e845dda8fda6bc2ecce5e15f6a09f48fa8d9416769cc4ccd9245d023198412e39ad7dd0250133c0c619a2e08b776cc3b65b6a8a5ecbdf72e7ef216de20f28254bbba035011651330df689c2fc1c02fdd749569e993b33862f5dc81bd572943e84bf1387862ff370a3a16009b982c772faf2c0626ab9d7cafc1a052ffe1ecbd4978de31c4230064685fa06fdf5301b9bd5c08e6ae0bd56aa192252015d6edde4c9d913c966595a266658042cac70aeb8c9ab224be7f39d3b3374e712a7aa6764c836b7ef88d4fa69438a56e56362d70f9227028695c07f9027ca4885b0bdeab0768376ba2d7b59172d48242bc03833231dbb70f870a8ca83b27e3ba4040be8068d116fd917d394e87a49c19af0e06f01c2d15550636c23126eaae364814d8998ca6a456a0e9cdef051746ed603d7e93966e916cfa06e6a7246fd6e6f62c5f16639250f4071299ff5f73cc4d88c4cba904953e3f9a8e60d504e0c17c0a11884f5fd44c08fb4b38955d003f5a1661ff95cc1686c35c2f07609c56057ea9574f419f224137a1c4d0a7df5419bca5ed60c4deff6945cc2037638daf521c7f4423ca7c3d4ba62a05b6cd31a03a6ac6dd402b66eb4a83b627a89c2695ea3b5c168159e3b4e1dd53155934185c1eaf5bbf188f1426331700709476b1a2f3a5e380b49de239d490b725a37ac912e2dc716c40a4763d7aa9d56a41c382052764ea51945c8ffa2c74b00cc178ec85ffd9f6b9d351a4bb3fa5d3f6acd170e0bcd4a8708682e1c1ec877431dea59a1efa199b465c82958e140e500eb59c790768487cf8521f7de573cb4c4a2a790f5387099b901b18e0648f96f3658724cb10c7ff6d594a55c21826a32614f7d94cc652e21946b94a1a93f7caf774ba7552b7ba9054d50e2daba9817365fdfef25f3d4ac851ca154360232529417248883883c58f59bfa1841a9f920465f1ca36e82f0e1fceeb30d8dd742dd851a29f343423ed4c490f48dd21fce90b673cd7e2b2680399e7f9ca065b2970af4a6c1014238714d531e39b7d3e79e9c694865ee01264a360bec691d4dde3141900acefea254b2c0cb61f37a887ba36927c7f32e73d0f8f82814f313d2d0d06e38ef70e71a35bc391307c3959d28de535c12a26ff48dc02d83a2b5f268732ec2b03685e8f22eba5bf31da435f17b42e1e0f01d11e2db9b386b07f1dedf9dfe2d3cc8d47ea33ec7caa89857341369bd86135f8e2393d9515676069b8c8bf32a640c5b5f255c8874d1a60ea017d21bb47316e459d17810d5a0ac9d038082d9a085ecb54d77507736169ce287877553648210f9098dbe31a5ffe6a2df3a0c4d12878db3d36c967a6c50fb4dc8e0153fb87d7a458de3eeb80fe8cbc393853a92d2c1bac02453a4725cf47577ec90719001870547f992efe4b480215f7cc1107a6c8780f2b4d6fad127fe71efe5a248511cf3c1ca99d54d1b4578c90cdc136c3baa81e87fe5409bb76fda4c4bf4716cffd071e85fd325fc48e37785004f66a9dd95f772c3cb05b02a3ebc2b6839f4b0eac012b320a525a87049c8ca341c72bb7d90f9cf7f35e1004ef988d3518abbaf7560847b89ed83d8e6d6c9446bd43936a3535ba494391ac00d25243ae1adbf9be501f222d5787948c8c90527f69fde66da0bb33e41ab5a58ca081c124b137c495ea2381cd77d166bd3bd5dacf1a2310142f0d1a1b5c39f3254bf09d7b8c67fda051332f9ea02745d44d8d58c6568581cbaa268cfa4a0acee4fb408ba83dbb65f048bafea70fbcc8e986570f0b14b45394016e02f4278544c593581afb1d1a5dee4a480c4aadf888d6ea572de2ed45d0d928018623726108c8a003e4a04f81f7ebb807109fbf692c533b10696d6f7991785caa61816aeae1d3edc714550f5c6748d61fb1642d8339d9cfd055b8fc2f06b8caea95b88eb927705b4945596918209a4e608ef8b999ab05e8954d2aee449e1481bca167db95c717e2b27f35ddfcd5bec3aade76b52a8fcd742a3930ef6505d1b8728bc76de48f2e52c2f629124177a6c337ab28bfaa2a52ca69f905c1c4d2f57e04d89a5990d9108e25f769b77a48faaccc8c594c7e2dfb34e0a91b50c899226c90a879f20a69d1b3e539eed4aeb5299fde5ac560e2531324584aacbd5656ae4c665b20a57b6df5d9639f539e5ba2d771a54d6aa0da4b02d660c4a4ff8ee0842df602668f8933f5e770f8543adbf042ec6e3b11d3e9f707040aab19f3972bbb7b92048a65468da1fc37156df2fcf22e821369b7792f71864be17674a4ae68d97963e189d0d8bcb0e6e2505e6aabc231cd5651b3b977ddc4513635f7f3df92a283f8a07f94aabace7ac543f3abbf316a3a2f0abe19bb2c4dfdf8ad7330befb263461218e6532dcbab5940f4115582a36956f351da945e7f42d4bc846b56854a72a8f57ef17583cda48f420d112d4f6f1fdb2ef59b79ea1748768aef7499f9b83bc5f536f7fccfc076b562847e9a333903a0b4014ed6be01cc46425220aa5b5fc8f0580bbfad8eae7fffec9edf4e93e5360f5965f353b27724ee8e11151596cb0df7af9e063bc4076dc3cb98ef0e999d0aadb6aa6cccb680ed0ee831ecaad05601fe54370778b2479f705cc80b64dcb9d496b89b67e3b903fb0fdbad460f5f54aaf66d77bc4191ed0a9912f5afd5f7c0282368240437cd0361081edc26039b46c41fad44065c8d3ac075d3ba71640ff7c4790a8666ada8e23a39a2302cc605546efc6ead6a42c773e3443e8c2ef1c04bd14ba27a6ab021c1a694e1cd704dff19827573f7b488b6ac90c06951d7a3c95c9987a7ab8c360724441bde70cd86e89eedb3aaf610f85ce0061c9b4bab63b04f344a60c28e4805f13da423ee286d376e2929a9cb2cf8de927208a08d7bfbf03d28a53d20a6ce5469685846850f6649a1f9c382f2797063acbbf081a299619a193da35216cbc58260c3ecb5cd8a40535d297757986b1941d08a563ea16a5030e84e4dbaaf8a514948eee749d2c8516508f612880504fb26b6cfb6f8ebb49f211ccb55f187f2eff64336b4421f7945a525196de4f3daf0e05f9e0f41729f2856c4be37211d88c69369915b3baa81b3cb8ee58206705026725896d87e2cff92c096d03caa001bf30889356ba9d4230bc7e5050fcfb4babb704583ecccf5f2d3ac533aa8a090b34e770e6f78f0b9366cac14d11f83b5efde9e613e9a869b533a480aef33629ccc3a76f5cef3c2c2172182b3a3c89f2bd88ea83506a2cc485a33bf944e23701f6280bad574ac1bb4643bb60077e7f4bd10899914188712cd8fa73bd9846ede272e833411178fb4a7f41c403b47dd69a27d4ac63880b3b5b73ab286f7f2e6ba47f765b8096fced2c0109c60fba80b63c64a09f7025c38ae98a6f4cbb70ae41dd9ce56cab1ba1e39b5a0845a3e30853a9058e80ad07a5658c76023b0779f49b575a93f788541ec7c19cdd4fa579e719b81193f205273ed3bc687fe2df5cfa11cdfb82b359fa4130b570c249414f7498752447b8b2efa514d253d2141e35d519d69aae9ef0ae8cf99871c9d79fcb15727feb3db10ceeffa7e5d31bae79d1800ffcdc088945801401705ceb2dbd53683e3067dc9379d54e51c2b5680793cb32d6a85d19aca576c1ec0012b0b97eb6d67e50f59913e580be4633951ff9fa201697102671f380c332bc682b8db37bb34a8c86adb45a9315d897f86c03fe8edd473b7c7aec262459a2592735a45f108dfb4933035866ceec9e7b4b14fe8b26e2b9a911a96635f4510b4c623f467260ab93b15a1f7d615e3f53c56d3048020b86c34c6ef462cf8320f022509cbd530d70b51231c42d6c2597338c5a06389c2022f95fd51a6f3dba92ab86bb1af247c6bc7b679ac188a7c148e14a972eacefb4bf40fed4d67c158cc004ff3a655b772bf4a0e6b5d87c2123af8e9f9dfdb935c5c992f38cabddfba6321e5436ce2680eb789afe2507dd75db5bfd79121c73deb9dd1b8c2f8bd4b5f7e6ac33174335d8a5bef4a4919b486de0900a20b4cdf008a72c60a5cd60c5b9a4ea62a8646201ab237e778c31ad8413590c70da1d3bab3484bf0b8773f50b3257fd705d2b5c5a7eb1fc24ec2f0ffc03b5997d31e4fb8d2d1f63bfa70d714c534093f0a53a9d77c6f6cce3e65e9efd26cd2461d7a6473b168f8cc7f17ac5fb039f4c3e5459a7f006bd09347814a4a90f1ac3aac74df6b1dc90c9da98aaf3630df6b29afeb62edb5b39651d43be2203a41bd52648c503ac2cc9aeb8d47b493fbb77fda331303ccce3f76ed0e914c1cae4422f264f84ad11b43946d51f8befeca56966c8f0c440b147017bb4e6fe12bc6181f6fe278006ba91aa1d553a6bdd7a4bc96f4ea65d9eed2ad7be231d8367d32b21d818e0a92099617d9366b5fb44bc4602428cdd33b20deeddcb8072eff06b152a8771df4c92ffbb261f8705c01201531de15732f996af42c0fc82204ead61d0c1c2a3d8c2221608a1d9dd62624ff71ebbbfac23887a322ff4d5405c1051af6d6ab124366165692903ecce7aee47fb1ba61e4b91fd971b9d42d841285f727badcda4ae8c9e240817db6cec941242a33238b5145d42b22691e02ad249ac77448e26980ef81413fb65013ea4df27e562e14cbddb930c4d689568e75fbebaff3bd758034d279a760f203070e9e1b3f8917056b2358ec2934fb8da53a946f786cb79ebce4fdd73baee251cd4f7574d6eb6c91165d8b54c176d13b825013cee7c0e56a8081ae13ef716f567fa99d9f687681eaa0b25ddc346bae84c4193daa0334441ee4cf858e545244ef7bd1e9057b9a8fd93af2a30158ea33e0bf49eca89553dbab47b55ff47bd1e0c5ddeed755a0608089a9bc1d36b338bd540612d18f55fe6fcc8a7b8bc5921a7e5540ddf5ae72fc02f54be6ce7c34cf19a95f88ba09b14115066a858bd3ce2f6a047e5d2c5ac597666ff57427e07683fc15ce9773b6160809f7f83e9d430cf879cadd7854db61867d7bdfe50153b505b78b7126360d113371dcf3946ee2a84c000138b14aab70d46a9a858e07825c9af178d3b9b1b2021a075da3e77fc33be44a7a4fe77ba9de1a9a9c325a212b5077d1c1d9f59cd06dd463ce99bc8b80a3100f86d2a128cd8ba54d2c1a5adcda5c942cc738db0f93c681bc6fb8db6823d2a253a23b1096116ac411bca0cc365399cade83138ce970bf1d52e144e47e8552a6155ebc5c0d5cdfc31d9ebe97c2ddfdc8434a5ec5d326ebcf520bcf86e46e722e7dd6da2d19badb383251ba04bdbbc81a7f503c934898e03f3040b02d63b1682912f43555b33fc85aa2f7661a6533003f6fa35e85e4cca762878fa38f8fb4e046ed301187a4c462de9431fbc623346b683667d46d00ef4d482346759f641c573a6050add1a85421a84c3b299c7510f166053fb55a8de12f54057a1458406915bb7a4b51fe8e5d5d96a97ee2d79fe8d4c61d0234a341a72c1db224f4a1ebe7373f26bf631d5ec9697e209756482e1974caf5d4620e012f7ef6f7dc125c6022d936bfc63e482ca828141426b68ba1582fd3b4d679ab93ef75bff169ba98bf465d7df0254f3c9dde57ff5742c49050e49a311987205ffa348fcd1037e82a6bc8625f950878cfab365683a2f00ab4a8d9cc520354365194a1596689668791bdba9fac0110b2a3202a121ac8fef140faa7b6c037294e5ed33d201e7784b1ffdf15e2b4e8b02fb13c99e4ed879ba5e3a567a7273e0d97ac725ff88a081bdb381e9533ea4a28c0f047dc06480708e23535301ac37c027c535ab950217856256f85f13d25527fb31d5878c1925924fa497e61cab19ffe493e0d1042e99539f08daa66d58f623007c77dfde584f13c7dbc4377f8edc95006ab7838945876e946be64fb0dda76dfcc13e590e1dbecb1928edacc7ffff0c6c4d25ae4f0c026b6c393bc5b85333e90fca0818747256fb9e92b18b28bd53848667386795463bee005b0ea3ffe0a058076f67f6c928c14d35a2e411650b5bc95beb6343eee7246b0d8e185f5e39d7b248f2242bd7eeb85d8fba5efdeb0f3b5ee718b1cee58493f5961f4df93e09ccc0f259236292bc3830d0b60cf9b21f190a376ce64cad3956f985056a6535a94b71473d87bd04c6185c0136ab27e635bd5bd091f21014cff0ca22a12e4510822ae3a6d1a255214ba3a2cf6ee45e6f7e6c523278d7d47ef3a83875d44bc5b45447ea7c5c88a841f3cdb3cc2bc758f85a2d0833821291208067218d20213a6fde23bc657966f985020ede28596268464bcfade255b12bb91ea0263a89f7f0a4af3c380194ea5257dfa39bc745731d98ec3d2dac69df0d39664c525d657737749f1bbb1985b847957770e583d564afe9afa933b44b8cdcb8996295d8772ba5cae6e7cdc3e1786469968bb17c5dc39f9744e8f2588bc74d5158cbb38457df7a1cf9416ffed750fe0d08b7f0e517d41372fe470c25512dd4d814cda2c8b0d13fd971a370dff8f0c00916b17b2378606e89fb8950003bd7d4c7f763a778c4e1c73e96202f93af85c37f8cd156c0531fa54eecd829cc3163af8e0f2bffc198940ee14242eaf407bf0c742b416a2a644bd40f4662cc449c45959911bb7453b5a40078b5be57092b16063db4e98f651b54bcd9ccac8d81cd1c67407cc55b344129367cae67eeadce52ad831394ab3a4a1f896f6d310fcfc47922c7b6e47f622222b5ba9b15cce060e850ae8c28d23e344e9dd1c6a2dfa36ddbdef6ec28fc0e031fb8d06bd199afd3f78aad898819195bbcc08e8e9e9734d37685d90a20a30ab0ad71df2aa2c6edb7253c45cb114d3d78875668e16ca8beffd5c911bd5574f4bce3ad20d2d46db14d1f941438d47793bea49d73d1f5deaf6f723e9a8e136e8522f968e72adf613ca4252bf69a2bca7ef5435dc67ef7b022f34a7292a23298a89a299e36ccab3cada2e6e3de0f78990d6f0a9c297af1513150efb5179b85a5f334164300e8ae92deeca7ff49fb6cee46ab3fe50897fa8fc76719358490b137aab800e53d8303f9e10dc0cc716eb282e9f321aeebb5ba472505a500b64863a48cc5fc42f8068843db3371b15f084dc3a2e366d3448c53c841456d68331659ad54a4c2cf45e43ffbb783cf93547c81127fd2b62dd0d4910ae15e01037bfdeb5d625bdc92fcc6197c09543d1830e4eb10fb5f8cf826e8057ea07deff2b3f62dda6b05028b4edd7e85f14373215bc84ac888112ffa2604f44f8930d5f91e159975388ac666789361ed21c091726cb6114cc547b85730a3f26a0537c3ce7a012a7133c473707e01cb0e7653955d69ae8660d3129af02b6f462919daa33e2940acce8190f458c958ef740d6a96f8643a13cba9dca3f7da161e88a193f4496f0b39edcb3f00676c6042864d07ca7a127283c086af7b23d6fee24a0e273e476310a93ff2fcdbe91b51387f1d6fd7bdb72e7268388a31a4d1c545aa28ee72cb7abbff012a54ce56ccf8bb21f014562585558bce27df487624e6cd3b3ea9f127d0a0d5cdcf6eb2259a4f6d9227e0200892ae99e621d0d2996fbae602cfa5cefe440c061364803f08d1cc5f705d5f4658d6e9331bd8a7da48fd8cf00c7e98007a90717c881b6c35f8c8c561ca6872cebffe5914b99fb20f5870192ecf258a24f3193ce6dd15d2fedc6b1056acac570dacf214987a7820bf93be34c7c43004051e03c3660606da81d95b5b682a144a7a4b1fb045348231e8ae3105039bb6c2fabea6e2c88688f21224612aa3ebb2a9655fe197202eab64d0805609c6b7f084d9a398e23580196c017d6a350a2b1f9f0b7b97765b953384ed68a100ca5a80e7a3e6fbbe2020cbc4ba18a50a30e45e95483da51d1855fe4ebb90e68b198803e221f949f301333aa2afa251b8b023a8bd932590ca1321c8ae784359e340aa4cf7a390ccaa8a3dbdcdad263d110415fb32ab7e4850c7efccd5cf1ff696f767bccd9a4c02a9ffa07339f5ee4e365b6f1f547c545558148dc272e7d9151cc6c7d2f4d3657bd4d660134e51803d0e21bf164b298c53d4bda88b009d5cfa75e470f68179faac4d7fe0dbb4b6b28353daaa012690e91a2905197a5cc7e6e47e3e0f2b784650e5a598a1c67a5ea33700c0fb031ec12bb6f4168c1ac89225fa524674124603c4f1336d0109afcc6a586a7a90b09e1e6c5e86c79f85e8234d9ca61e164c0b02ad475aa4645963791cce7c696a6b58ffad432eea12534a086cc1c4c3051c814d6437ab063c7b89ed03a5ca4e1f91121c30ef815ef048d6333ecf68278d5aead6d860bba6fd431e765105be215f2cb7d4f58bb1cc0701f101f93cef2b4fcf69aca0f97d080da44a7e6f0be281c3a75c5d990489bde02e185f6f04f61946ef7a0f6a4ea55a8a66e4b946602fb35d0fcb5ec976494ebfc45f5101a47235afa00502a48a616c5db7dc4092fc74e2680542aea287158d654401de1705b5bdabacf973d0ada97a682f9327f5ffd5c6e32bfc9ad38986d3243d51213ae83ed5d852911038f6ffa57b65f5ae2fa6287dc816bb3f1e0afb06b637551edeb2a029cd44d8e2b645d9c01ab324702567f8f946c668b37e33ea4e3f83b5250f67ad7a074668498c50e069b49d19a546decc2e7ab1eea4ee232ca421edd20dd64782bcbd5dca56444f74f818f7c10fbe644d09b3f8746857e823bb59c0d10335f68981f2c1cb1c249ae4d7fe83cdf542349330e61662015bca0bab216e9bd7bddfc1b4c849fc74eded245cf5e72ac28f4842fcd358982b6fad450a73f35f1d3bba8983c5c4e2b1288265a036c2b09781dc86729558ebc55a92060f4604e3ece799fc7b0acf342680c2f3ed8e873033a0527ca6945e3a54e6d069f5a2028b9d1e64cec117641dcc08ba1eba406f094064ac1dcb9df505144a959ef4a8c267871145361a4f844b3f32ef873c220e6f32089af78f11d8816edc70310ee8a86b8390c80a7b3c0902e9ec5bdb06829b17ad709c3c95992514d3d3815106321c8223ff92dc5019b9999e83910fda69c69174e23f24783edbae81ddf475a06cc5c1032a8318343e508201b489b29f743e5790bf3313960c44d10915ce5b35a4443b9170d274e8067cdfa438bcf49e0ee92710cfb5df98e274d5aeaab408b7874dbb705aab1c0fe0827eed11a5ad8a3e852072e5c2f5457b05de5a0be91896c397f9e07b68955db840f80a29ce58415463950db485b255f3ecef973efe77756755b222401cda8baf29fcfd77e20fff2397bae8f1b7779fa122a1dc180cc7b41384750630a7f08a7f0df336e8d7fd36802a5692be291a9ceb87719452e9df2c14f63c822b3766c90da0d1a6df99eff90af05e5b8a789e69b1f53944f83dc842c2f7afd0f5451d2f5ee015c091c636f1303422fa7220dd77665ac52935597795859b96fb68bc499fefd79684a0b925165520d0972467be3d01ee6ab3a655a661a442d4eb6d10d5737741b97b2076e19f48cbbef582de6910a39f25bb9ea407439122c84a025cf2899585215b4692ea7b302f3ff43d0fa397f98850d827601b7f1800412ce224adfec4caea00fc17cda49485bdcb8dc3477979299d4650f84702835d74461e8a5418c3487c26fbeb6c681d2e71bde8abd5f2aba39169be2eadd36155467125acddaa0f68d0213ae28737ef1a6206b33adba264481ab63544e34648c8cca2d6b9ee2c76eac1f6d35e3dad24f3c05793d08da2bb3996fea3f20cdc05fa79b80c8a79f44564e67e4e5c2d2da543203735f7ab2154c3ce180d1a35ad1a35cc4550be75e80863e6d82204b57b61c1deef1da40e33af8fb25ed571f3d4f11ef2996c4845032f85075296682c5dadf3fd3f966bbd9970108fdf0836731693fad8d89300a0d201fa74db3683515c2327027dacfc270bbda4fde721af31d87d919f8bddf68f2b66cac7ad41bf97686ecc8d3334f4428c164296c77ad4c41f5dfac30b74f3c86d3615f9e129de3dbabf8f5ccc0db6c9aeab0f360f902cfe04f4774cb6a2080cde604c9e96e4d8eb8432a064cb4c746b1ce73df65c800bc9bb56c32daf1e5086ec72f4afea455e295c3924adaa176aa7ceb4e99392a013b6f846445f1d4565e3c75e63f97e741d1df1e76e1320d5c9c54004b4a5cead20a0c29aa1978372f69f06a7d37bbdef7da6312ba40bf13a8aa14836fcf713a71f40584fa62ccb69d429027d97bfafbf8541fdeb9074e4bce88b8d70227547242de43a62ffcc6fa0dcff2de1edc413fe20dba9e86dc2fa58ae96a5a44d728afa731a085427eabbcc280ac0c5e8952af77b3e235913141e7866a8fffd1643f68bd65503c7c8122196d0b72eef3183a96778f9608db20d6e8d8e622e92f904e8e0c9fc455a8861fcfd14ad3af0ab59637e7d8a039cfe385965652af242aac7af2f31b07145a1a996788900bb3841d165e7bbdc4881fa2e727bd530789dffbc21ec05250e39596803334414d944069b3ae0c3509b9f2ff270f2d0a563db75916f708761194bcc3b16050d3d5078b7e97c654891a9fbfd1c98c538221b959e036d2ca3cd34d19fe2fec6919f679a51925f1e1cad8a49ff971f32b5b890e2828694d32d5375aee2bd4ce98dbffbc55cd51d4e6b60994a1594156bef9562b75ced09b2322aebe03d6c498b2c99bab62eccf881fd63bab275ea79c661339b64b4383c53c773213b0cdbb6a96ddd0d42887f1a80f62feea566722de1f1a34b1a230a0aea1bd423a9e8088b58da3c39fa79380f9dea2b9f577183d54fa453fb4e2411c0102adc5c78cc50fdd0782ffc09f001be8b61473e6f064cb76d7c6df9b698bf627b250bb98ff0a0893ddd7c7554b48c0162d2a03cb185277767fc3e4119e2a7a43bc4e1bd240e45eae587839e463002b4e5196edfcfe0ad589f364506fdfa9966604f798da96a0d308c563d48d43431a5e72ae0fee07347022127ca607ec3cfc0340f128823a5cf554db229040c7db147382d53cb76c0ac37275ed678b6687bb609c184e243e4d97966f3bf845ea78b4ad893d0b15b27aae115d84567e9bbc658ffa6ce0d64eae34be01ae53721e534e408851606473519f27a80f46a14057428d74994d9eb61abed4900365f9241fef07555a5ec902b202365e166edd6d447a2a9d3f53b32d07501c0025dd7c80f48d86c0d6daab9d672353f7e4e926ddf6cb240a7110dec57d7647b258272c0643c43c438cb900e42a45d01bf8538c87670d7d9df19b38c77e90444ec9f2f925e2af365c6ba69423a29eddbf802157be42f6f92f3504f1194adad725e5ed6c580617a4d99c480ce5bac0cd5850f575a3e02fd153e7d742d1b9c236b2a786adc54d0a7fef31a5667cd68768148e9c9b4faf773f636fc5717c31dabe4dd77aefcc3e119b2295de088444c3f77fba9777ffc5894fa4aa065c1b00e14f6dad92b65c0313dc105d798d67c1eb7ad383b2003614e2d592ba6ce8eb86b3817219873776b6f0300b2dcb33dec6ef58dbb934e44f254687a7498f39f92645014a954cdc0d4b2f404489c15f1c695264fc93445bca43688017edcf6f1b81de2aeb5e0914c0eed6743eb26df1c4cd0fb85174db19c025f6931241a9ef7150b6dd60a95a456f2923dfbc3fc34398ee73df3ddba46660515d3b1473e2e156af38366a4b330df2c6e753cbc71bfd4de5beccb1c5915c3adb52168d0e5162cb62774cad097196092f532312c57e23cc989001ec91c169b7e2948d7267570795b507161f1a82145fe2c420cbdea152eeb40e1899e0c0316b81a84a01c6152b9a0fc212f97da9f0953d837aea1fcbabc549c708789faea4369f4cd7b092d9777e0775e79b741e8be88b2933eac5b8de955624f8c12bc139f0db03deac1c7240da9646e4d5f4ccd89f94ed6566fa413cf685c182c53f214e248a69590da2ba28fd1c5a413b9d17fc0092c58daba3c6d3af4c23813635f92a53910ad23e99d59c7665cdbf698c17042cb2dcfcb83f6fa7c93bd5b1805f827a61be1282b4e977388f4f432c4c772963d1f0db6709f75c4b6e6e7ceca7a27f9c3cc0f522af6736a5399387b9fddc1597e9506eb81bd650bbb436613d52a5daf41e582df60c2ec8f59718970607908658dc7072e7adff4fb2cc86fc9a4fece3db497cf202c43696d583bee7db030d3c9e150b9e27c538feaa6aa267a942eb99b4f23248aa0e328f5ace66d83a61799f54b4888bfeeb9dd4cf10a1d9425d8e6f4a01d7b876357d878fa9d5cbe87da0ad15d32851bfde608f594c724bb8c2ee4d8f326c2ae4865db0cc071af3a0d94a2103935b6b723e0642a38dbeab1a2b7a490a9ab52b5b740a1319b13ad934edf416b58011901d5ae3c136ce9f9311442a7f1426927658662058f98229f6cf784fe30bc64ef8c3c9693eba78608fc717b1125d4ce704187d69f32a4b2ac9dd9baad020f6b2b13f0608f63f0ae07ee271b9b37355c9590f3f2e889076ce40eafb98","isRememberEnabled":true,"rememberDurationInDays":30,"staticryptSaltUniqueVariableName":"e06b548b27a7e7d8dcac8c756dd3f2bc"};

            // you can edit these values to customize some of the behavior of StatiCrypt
            const templateConfig = {
                rememberExpirationKey: "staticrypt_expiration",
                rememberPassphraseKey: "staticrypt_passphrase",
                replaceHtmlCallback: null,
                clearLocalStorageCallback: null,
            };

            // init the staticrypt engine
            const staticrypt = staticryptInitiator.init(staticryptConfig, templateConfig);

            // try to automatically decrypt on load if there is a saved password
            window.onload = async function () {
                const { isSuccessful } = await staticrypt.handleDecryptOnLoad();

                // if we didn't decrypt anything on load, show the password prompt. Otherwise the content has already been
                // replaced, no need to do anything
                if (!isSuccessful) {
                    // hide loading screen
                    document.getElementById("staticrypt_loading").classList.add("hidden");
                    document.getElementById("staticrypt_content").classList.remove("hidden");
                    document.getElementById("staticrypt-password").focus();

                    // show the remember me checkbox
                    if (isRememberEnabled) {
                        document.getElementById("staticrypt-remember-label").classList.remove("hidden");
                    }
                }
            };

            // toggle password visibility
            const toggleIcon = document.querySelector(".staticrypt-toggle-password-visibility");
            // these two icons are coming from FontAwesome
            const imgSrcEyeClosed =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg==";
            const imgSrcEyeOpened =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzYgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTI4OCAzMmMtODAuOCAwLTE0NS41IDM2LjgtMTkyLjYgODAuNkM0OC42IDE1NiAxNy4zIDIwOCAyLjUgMjQzLjdjLTMuMyA3LjktMy4zIDE2LjcgMCAyNC42QzE3LjMgMzA0IDQ4LjYgMzU2IDk1LjQgMzk5LjRDMTQyLjUgNDQzLjIgMjA3LjIgNDgwIDI4OCA0ODBzMTQ1LjUtMzYuOCAxOTIuNi04MC42YzQ2LjgtNDMuNSA3OC4xLTk1LjQgOTMtMTMxLjFjMy4zLTcuOSAzLjMtMTYuNyAwLTI0LjZjLTE0LjktMzUuNy00Ni4yLTg3LjctOTMtMTMxLjFDNDMzLjUgNjguOCAzNjguOCAzMiAyODggMzJ6TTE0NCAyNTZhMTQ0IDE0NCAwIDEgMSAyODggMCAxNDQgMTQ0IDAgMSAxIC0yODggMHptMTQ0LTY0YzAgMzUuMy0yOC43IDY0LTY0IDY0Yy03LjEgMC0xMy45LTEuMi0yMC4zLTMuM2MtNS41LTEuOC0xMS45IDEuNi0xMS43IDcuNGMuMyA2LjkgMS4zIDEzLjggMy4yIDIwLjdjMTMuNyA1MS4yIDY2LjQgODEuNiAxMTcuNiA2Ny45czgxLjYtNjYuNCA2Ny45LTExNy42Yy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM3oiLz48L3N2Zz4=";
            toggleIcon.addEventListener("click", function () {
                const passwordInput = document.getElementById("staticrypt-password");
                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    toggleIcon.src = imgSrcEyeOpened;
                    toggleIcon.alt = templateToggleAltHide;
                    toggleIcon.title = templateToggleAltHide;
                } else {
                    passwordInput.type = "password";
                    toggleIcon.src = imgSrcEyeClosed;
                    toggleIcon.alt = templateToggleAltShow;
                    toggleIcon.title = templateToggleAltShow;
                }
            });

            // handle password form submission
            document.getElementById("staticrypt-form").addEventListener("submit", async function (e) {
                e.preventDefault();

                const password = document.getElementById("staticrypt-password").value,
                    isRememberChecked = document.getElementById("staticrypt-remember").checked;

                const { isSuccessful } = await staticrypt.handleDecryptionOfPage(password, isRememberChecked);

                if (!isSuccessful) {
                    alert(templateError);
                }
            });
        </script>
    </body>
</html>
