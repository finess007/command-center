<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Content Marketing ‚Äî Alessa</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 100%);
      color: #e8e8e8;
      min-height: 100vh;
      padding: 18px;
    }
    a.back {
      position: fixed; top: 16px; left: 16px; color: #888; text-decoration: none;
      font-size: 0.9rem; z-index: 1000; background: rgba(0,0,0,0.5);
      padding: 8px 12px; border-radius: 8px;
    }
    a.back:hover { color: #a78bfa; }

    .wrap { max-width: 1100px; margin: 0 auto; padding-top: 40px; }

    header { margin-bottom: 28px; }
    h1 { font-size: 1.8rem; margin-bottom: 4px; }
    .sub { color: #888; font-size: 0.9rem; }

    /* Tabs */
    .tabs {
      display: flex; gap: 6px; margin-bottom: 24px; flex-wrap: wrap;
      border-bottom: 1px solid rgba(255,255,255,0.08); padding-bottom: 12px;
    }
    .tab {
      background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
      color: #999; padding: 8px 16px; border-radius: 10px; cursor: pointer;
      font-size: 0.85rem; transition: all 0.2s;
    }
    .tab:hover { color: #e8e8e8; border-color: rgba(255,255,255,0.2); }
    .tab.active { background: rgba(167,139,250,0.2); border-color: rgba(167,139,250,0.4); color: #c4b5fd; }

    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    /* Cards */
    .card {
      background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px; padding: 20px; margin-bottom: 16px;
      transition: all 0.2s;
    }
    .card:hover { border-color: rgba(255,255,255,0.15); }
    .card-header {
      display: flex; align-items: center; gap: 10px; margin-bottom: 12px;
    }
    .card-emoji { font-size: 1.5rem; }
    .card-title { font-size: 1.1rem; font-weight: 600; }
    .card-desc { color: #888; font-size: 0.85rem; margin-bottom: 12px; font-style: italic; }

    /* Buttons */
    .btn {
      background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.14);
      color: #e8e8e8; padding: 7px 14px; border-radius: 10px; cursor: pointer;
      font-size: 0.82rem; transition: all 0.2s;
    }
    .btn:hover { background: rgba(255,255,255,0.12); border-color: rgba(255,255,255,0.25); }
    .btn.primary { background: rgba(167,139,250,0.2); border-color: rgba(167,139,250,0.35); color: #c4b5fd; }
    .btn.success { background: rgba(34,197,94,0.15); border-color: rgba(34,197,94,0.3); color: #4ade80; }
    .btn.danger { background: rgba(239,68,68,0.12); border-color: rgba(239,68,68,0.3); color: #f87171; }
    .btn.sm { padding: 4px 10px; font-size: 0.78rem; }

    /* Tags / Chips */
    .chip {
      display: inline-block; padding: 3px 10px; border-radius: 8px;
      font-size: 0.75rem; font-weight: 500;
    }
    .chip.history { background: rgba(168,85,247,0.15); color: #c084fc; }
    .chip.styling { background: rgba(236,72,153,0.15); color: #f472b6; }
    .chip.fabric { background: rgba(34,197,94,0.15); color: #4ade80; }
    .chip.trending { background: rgba(59,130,246,0.15); color: #60a5fa; }
    .chip.mythbust { background: rgba(245,158,11,0.15); color: #fbbf24; }
    .chip.idea { background: rgba(107,114,128,0.2); color: #9ca3af; }
    .chip.draft { background: rgba(59,130,246,0.15); color: #60a5fa; }
    .chip.script { background: rgba(168,85,247,0.15); color: #c084fc; }
    .chip.produced { background: rgba(245,158,11,0.15); color: #fbbf24; }
    .chip.published { background: rgba(34,197,94,0.15); color: #4ade80; }

    /* Idea list */
    .idea-list { list-style: none; padding: 0; }
    .idea-item {
      display: flex; align-items: center; justify-content: space-between; gap: 8px;
      padding: 8px 12px; border-radius: 8px; font-size: 0.88rem;
      background: rgba(255,255,255,0.02); margin-bottom: 4px;
      border: 1px solid transparent; transition: all 0.2s;
    }
    .idea-item:hover { border-color: rgba(255,255,255,0.1); background: rgba(255,255,255,0.04); }
    .idea-text { flex: 1; }
    .idea-actions { display: flex; gap: 4px; flex-shrink: 0; }

    .add-row {
      display: flex; gap: 8px; margin-top: 10px;
    }
    .add-row input {
      flex: 1; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.12);
      color: #e8e8e8; padding: 8px 12px; border-radius: 10px; font-size: 0.85rem;
      outline: none;
    }
    .add-row input:focus { border-color: rgba(167,139,250,0.4); }

    /* Pipeline */
    .pipeline {
      display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px;
      margin-bottom: 24px;
    }
    @media (max-width: 768px) {
      .pipeline { grid-template-columns: repeat(3, 1fr); }
    }
    @media (max-width: 480px) {
      .pipeline { grid-template-columns: 1fr 1fr; }
    }
    .pipe-stage {
      background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08);
      border-radius: 14px; padding: 16px; text-align: center; min-height: 120px;
    }
    .pipe-emoji { font-size: 1.5rem; margin-bottom: 6px; }
    .pipe-label { font-size: 0.78rem; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
    .pipe-count { font-size: 2rem; font-weight: 700; color: #c4b5fd; }
    .pipe-items { margin-top: 10px; }
    .pipe-item {
      display: flex; align-items: center; justify-content: space-between; gap: 6px;
      padding: 6px 10px; border-radius: 8px; font-size: 0.8rem;
      background: rgba(255,255,255,0.04); margin-bottom: 4px;
    }
    .pipe-item-text { flex: 1; text-align: left; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .pipe-item .btn { padding: 2px 8px; font-size: 0.72rem; }

    /* Calendar */
    .cal-grid {
      display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px;
      margin-bottom: 16px;
    }
    @media (max-width: 640px) {
      .cal-grid { grid-template-columns: repeat(3, 1fr); }
    }
    .cal-header-cell {
      text-align: center; font-size: 0.75rem; color: #888;
      text-transform: uppercase; letter-spacing: 1px; padding: 4px;
    }
    .cal-cell {
      background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08);
      border-radius: 10px; padding: 10px 8px; min-height: 80px; cursor: pointer;
      transition: all 0.2s; position: relative;
    }
    .cal-cell:hover { border-color: rgba(167,139,250,0.3); }
    .cal-cell.today { border-color: rgba(167,139,250,0.5); background: rgba(167,139,250,0.06); }
    .cal-date { font-size: 0.75rem; color: #666; margin-bottom: 6px; }
    .cal-item {
      font-size: 0.75rem; padding: 3px 6px; border-radius: 6px;
      background: rgba(167,139,250,0.1); margin-bottom: 3px;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }

    /* Calendar navigation */
    .cal-nav {
      display: flex; align-items: center; gap: 12px; margin-bottom: 16px;
    }
    .cal-nav-title { font-size: 1.1rem; font-weight: 600; min-width: 180px; text-align: center; }

    /* Published log */
    .log-table {
      width: 100%; border-collapse: separate; border-spacing: 0 4px;
    }
    .log-table th {
      text-align: left; padding: 8px 12px; font-size: 0.75rem; color: #888;
      text-transform: uppercase; letter-spacing: 1px; font-weight: 500;
    }
    .log-table td {
      padding: 10px 12px; font-size: 0.85rem; background: rgba(255,255,255,0.02);
    }
    .log-table tr td:first-child { border-radius: 10px 0 0 10px; }
    .log-table tr td:last-child { border-radius: 0 10px 10px 0; }
    .log-table tbody tr:hover td { background: rgba(255,255,255,0.05); }

    @media (max-width: 640px) {
      .log-table th, .log-table td { padding: 6px 8px; font-size: 0.78rem; }
      .hide-mobile { display: none; }
    }

    /* Stats */
    .stats-grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 14px; margin-bottom: 24px;
    }
    .stat-card {
      background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08);
      border-radius: 14px; padding: 20px; text-align: center;
    }
    .stat-value { font-size: 2.2rem; font-weight: 700; color: #c4b5fd; }
    .stat-label { font-size: 0.78rem; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-top: 4px; }

    .dist-bar {
      display: flex; align-items: center; gap: 10px; margin-bottom: 8px;
    }
    .dist-label { font-size: 0.82rem; width: 130px; flex-shrink: 0; }
    .dist-track {
      flex: 1; height: 8px; background: rgba(255,255,255,0.06);
      border-radius: 4px; overflow: hidden;
    }
    .dist-fill { height: 100%; border-radius: 4px; transition: width 0.3s; }
    .dist-fill.history { background: #c084fc; }
    .dist-fill.styling { background: #f472b6; }
    .dist-fill.fabric { background: #4ade80; }
    .dist-fill.trending { background: #60a5fa; }
    .dist-fill.mythbust { background: #fbbf24; }
    .dist-count { font-size: 0.78rem; color: #888; width: 30px; text-align: right; }

    /* Modal */
    .modal-overlay {
      display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7); z-index: 2000; align-items: center; justify-content: center;
    }
    .modal-overlay.show { display: flex; }
    .modal {
      background: #1a1a2e; border: 1px solid rgba(255,255,255,0.12);
      border-radius: 16px; padding: 24px; width: 90%; max-width: 440px;
    }
    .modal h3 { margin-bottom: 16px; font-size: 1.1rem; }
    .modal label {
      display: block; font-size: 0.82rem; color: #888; margin-bottom: 4px; margin-top: 12px;
    }
    .modal input, .modal select, .modal textarea {
      width: 100%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.12);
      color: #e8e8e8; padding: 8px 12px; border-radius: 10px; font-size: 0.85rem;
      outline: none; font-family: inherit;
    }
    .modal input:focus, .modal select:focus, .modal textarea:focus { border-color: rgba(167,139,250,0.4); }
    .modal select option { background: #1a1a2e; }
    .modal-actions {
      display: flex; gap: 8px; justify-content: flex-end; margin-top: 20px;
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 3px; }

    /* Empty states */
    .empty { color: #555; font-size: 0.85rem; text-align: center; padding: 24px; }
  </style>
</head>
<body>
  <a class="back" href="index.html">‚Üê Back</a>

  <div class="wrap">
    <header>
      <h1>üì± Content Marketing</h1>
      <p class="sub">Alessa ‚Äî Content strategy, pipeline & calendar</p>
    </header>

    <!-- Tabs -->
    <div class="tabs">
      <div class="tab active" data-tab="angles">üìê Content Angles</div>
      <div class="tab" data-tab="pipeline">üöÄ Pipeline</div>
      <div class="tab" data-tab="calendar">üìÖ Calendar</div>
      <div class="tab" data-tab="published">üìã Published</div>
      <div class="tab" data-tab="stats">üìä Stats</div>
    </div>

    <!-- ===================== TAB: CONTENT ANGLES ===================== -->
    <div id="tab-angles" class="tab-panel active"></div>

    <!-- ===================== TAB: PIPELINE ===================== -->
    <div id="tab-pipeline" class="tab-panel">
      <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;margin-bottom:16px">
        <h2 style="font-size:1.2rem">Content Pipeline</h2>
        <button class="btn primary" onclick="openPipelineModal()">+ Add Item</button>
      </div>
      <div class="pipeline" id="pipeline-stages"></div>
    </div>

    <!-- ===================== TAB: CALENDAR ===================== -->
    <div id="tab-calendar" class="tab-panel">
      <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;margin-bottom:16px">
        <h2 style="font-size:1.2rem">Content Calendar</h2>
        <button class="btn primary" onclick="openCalendarModal()">+ Schedule</button>
      </div>
      <div class="cal-nav">
        <button class="btn sm" onclick="calNav(-1)">‚Äπ</button>
        <div class="cal-nav-title" id="cal-title"></div>
        <button class="btn sm" onclick="calNav(1)">‚Ä∫</button>
        <button class="btn sm" onclick="calToday()">Today</button>
      </div>
      <div class="cal-grid" id="cal-grid"></div>
    </div>

    <!-- ===================== TAB: PUBLISHED ===================== -->
    <div id="tab-published" class="tab-panel">
      <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;margin-bottom:16px">
        <h2 style="font-size:1.2rem">Published Content Log</h2>
        <button class="btn primary" onclick="openPublishModal()">+ Log Content</button>
      </div>
      <div id="publish-log"></div>
    </div>

    <!-- ===================== TAB: STATS ===================== -->
    <div id="tab-stats" class="tab-panel">
      <h2 style="font-size:1.2rem;margin-bottom:16px">Quick Stats</h2>
      <div class="stats-grid" id="stats-grid"></div>
      <div class="card" style="margin-top:8px">
        <div class="card-header"><span class="card-emoji">üìä</span><span class="card-title">Category Distribution</span></div>
        <div id="dist-bars"></div>
      </div>
    </div>
  </div>

  <!-- ===================== MODALS ===================== -->
  <!-- Pipeline Modal -->
  <div class="modal-overlay" id="modal-pipeline">
    <div class="modal">
      <h3>üìù Add Pipeline Item</h3>
      <label>Topic</label>
      <input id="pipe-topic" placeholder="e.g. How WWII changed women's fashion" />
      <label>Category</label>
      <select id="pipe-cat">
        <option value="history">üèõÔ∏è Fashion History</option>
        <option value="styling">üëó Styling Tips</option>
        <option value="fabric">üáÆüáπ Italian Fabric</option>
        <option value="trending">üìà Trending</option>
        <option value="mythbust">üí° Myth Busting</option>
      </select>
      <label>Stage</label>
      <select id="pipe-stage-sel">
        <option value="idea">üìù Idea</option>
        <option value="draft">‚úçÔ∏è Draft</option>
        <option value="script">üé¨ Script</option>
        <option value="produced">üé• Produced</option>
        <option value="published">üì± Published</option>
      </select>
      <div class="modal-actions">
        <button class="btn" onclick="closeModal('modal-pipeline')">Cancel</button>
        <button class="btn primary" onclick="addPipelineItem()">Add</button>
      </div>
    </div>
  </div>

  <!-- Calendar Modal -->
  <div class="modal-overlay" id="modal-calendar">
    <div class="modal">
      <h3>üìÖ Schedule Content</h3>
      <label>Date</label>
      <input type="date" id="cal-date" />
      <label>Topic</label>
      <input id="cal-topic" placeholder="e.g. 3 ways to style a slip dress" />
      <label>Category</label>
      <select id="cal-cat">
        <option value="history">üèõÔ∏è Fashion History</option>
        <option value="styling">üëó Styling Tips</option>
        <option value="fabric">üáÆüáπ Italian Fabric</option>
        <option value="trending">üìà Trending</option>
        <option value="mythbust">üí° Myth Busting</option>
      </select>
      <div class="modal-actions">
        <button class="btn" onclick="closeModal('modal-calendar')">Cancel</button>
        <button class="btn primary" onclick="addCalendarItem()">Schedule</button>
      </div>
    </div>
  </div>

  <!-- Publish Modal -->
  <div class="modal-overlay" id="modal-publish">
    <div class="modal">
      <h3>üìã Log Published Content</h3>
      <label>Date</label>
      <input type="date" id="pub-date" />
      <label>Topic</label>
      <input id="pub-topic" placeholder="Topic of the published content" />
      <label>Category</label>
      <select id="pub-cat">
        <option value="history">üèõÔ∏è Fashion History</option>
        <option value="styling">üëó Styling Tips</option>
        <option value="fabric">üáÆüáπ Italian Fabric</option>
        <option value="trending">üìà Trending</option>
        <option value="mythbust">üí° Myth Busting</option>
      </select>
      <label>Format</label>
      <select id="pub-format">
        <option value="post">Post</option>
        <option value="video">Video</option>
        <option value="reel">Reel</option>
        <option value="story">Story</option>
        <option value="carousel">Carousel</option>
      </select>
      <label>Platform</label>
      <select id="pub-platform">
        <option value="instagram">Instagram</option>
        <option value="tiktok">TikTok</option>
        <option value="facebook">Facebook</option>
        <option value="youtube">YouTube</option>
      </select>
      <label>Engagement (optional ‚Äî fill later)</label>
      <input id="pub-engagement" placeholder="e.g. 1.2K likes, 45 comments" />
      <div class="modal-actions">
        <button class="btn" onclick="closeModal('modal-publish')">Cancel</button>
        <button class="btn primary" onclick="addPublished()">Log</button>
      </div>
    </div>
  </div>

<script>
// ===== STORAGE =====
const STORAGE_KEY = 'alessa-content-marketing-v1';
const CATEGORIES = {
  history:  { emoji: 'üèõÔ∏è', label: 'Fashion History',      desc: '"The little black dress was invented because..." ‚Äî educational, shareable' },
  styling:  { emoji: 'üëó', label: 'Styling Tips',          desc: '"3 ways to style a slip dress" ‚Äî practical, saves to collections' },
  fabric:   { emoji: 'üáÆüáπ', label: 'Italian Fabric Education', desc: '"Why Italian cotton feels different" ‚Äî positions Alessa as premium' },
  trending: { emoji: 'üìà', label: "What's Trending",       desc: '"Spring 2026: the comeback of..." ‚Äî timely, algorithm-friendly' },
  mythbust: { emoji: 'üí°', label: 'Myth Busting',          desc: '"Fast fashion companies don\'t want you to know..." ‚Äî provocative, high engagement' }
};
const STAGES = {
  idea:      { emoji: 'üìù', label: 'Ideas' },
  draft:     { emoji: '‚úçÔ∏è', label: 'Draft' },
  script:    { emoji: 'üé¨', label: 'Script' },
  produced:  { emoji: 'üé•', label: 'Produced' },
  published: { emoji: 'üì±', label: 'Published' }
};
const STAGE_ORDER = ['idea','draft','script','produced','published'];

const DEFAULT_IDEAS = {
  history: [
    "Coco Chanel's revolution ‚Äî how one woman changed everything",
    "Evolution of the evening dress through the decades",
    "Why Italian fashion dominated the 20th century",
    "The history of silk ‚Äî from ancient China to modern couture",
    "How WWII changed women's fashion forever"
  ],
  styling: [
    "Day-to-night outfit transitions ‚Äî 3 easy tricks",
    "How to accessorize a simple dress for maximum impact",
    "Color theory for outfits ‚Äî what flatters YOU",
    "Capsule wardrobe basics ‚Äî 15 pieces, 30 outfits",
    "Seasonal layering ‚Äî stay warm AND stylish"
  ],
  fabric: [
    "Italian vs Chinese fabric comparison ‚Äî feel the difference",
    "What thread count actually means (and why it matters)",
    "Why silk drapes differently depending on origin",
    "The 128-part quality process behind every Alessa piece",
    "Hand vs machine stitching ‚Äî can you tell?"
  ],
  trending: [
    "Spring 2026: the comeback of the midi skirt",
    "Runway-to-street translations you can actually wear",
    "Comeback pieces ‚Äî what's old is new again",
    "Celebrity style breakdowns ‚Äî steal their look for less",
    "Social media fashion trends that actually last"
  ],
  mythbust: [
    "The true cost of a $10 dress ‚Äî where does the money go?",
    "Markup secrets the fashion industry hides",
    "Quality vs quantity math ‚Äî the real cost per wear",
    "Fabric longevity facts ‚Äî why cheap falls apart",
    "Why returns are destroying fashion (and the planet)"
  ]
};

function loadData() {
  const raw = localStorage.getItem(STORAGE_KEY);
  if (raw) return JSON.parse(raw);
  // Initialize with defaults
  const data = {
    ideas: JSON.parse(JSON.stringify(DEFAULT_IDEAS)),
    pipeline: [],
    calendar: [],
    published: []
  };
  saveData(data);
  return data;
}

function saveData(d) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(d));
}

let data = loadData();

// ===== TABS =====
document.querySelectorAll('.tab').forEach(t => {
  t.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
    document.querySelectorAll('.tab-panel').forEach(x => x.classList.remove('active'));
    t.classList.add('active');
    document.getElementById('tab-' + t.dataset.tab).classList.add('active');
    render();
  });
});

// ===== RENDER: CONTENT ANGLES =====
function renderAngles() {
  const el = document.getElementById('tab-angles');
  let html = '';
  for (const [key, cat] of Object.entries(CATEGORIES)) {
    const ideas = data.ideas[key] || [];
    html += `<div class="card">
      <div class="card-header">
        <span class="card-emoji">${cat.emoji}</span>
        <span class="card-title">${cat.label}</span>
        <span class="chip ${key}" style="margin-left:auto">${ideas.length} ideas</span>
      </div>
      <div class="card-desc">${cat.desc}</div>
      <ul class="idea-list">`;
    ideas.forEach((idea, i) => {
      html += `<li class="idea-item">
        <span class="idea-text">${esc(idea)}</span>
        <div class="idea-actions">
          <button class="btn sm success" title="Send to pipeline" onclick="ideaToPipeline('${key}',${i})">‚Üí Pipeline</button>
          <button class="btn sm danger" title="Remove" onclick="removeIdea('${key}',${i})">‚úï</button>
        </div>
      </li>`;
    });
    html += `</ul>
      <div class="add-row">
        <input id="add-${key}" placeholder="Add idea..." onkeydown="if(event.key==='Enter')addIdea('${key}')" />
        <button class="btn primary sm" onclick="addIdea('${key}')">+</button>
      </div>
    </div>`;
  }
  el.innerHTML = html;
}

function addIdea(cat) {
  const inp = document.getElementById('add-' + cat);
  const v = inp.value.trim();
  if (!v) return;
  if (!data.ideas[cat]) data.ideas[cat] = [];
  data.ideas[cat].push(v);
  saveData(data);
  inp.value = '';
  renderAngles();
}

function removeIdea(cat, idx) {
  data.ideas[cat].splice(idx, 1);
  saveData(data);
  renderAngles();
}

function ideaToPipeline(cat, idx) {
  const topic = data.ideas[cat][idx];
  data.pipeline.push({ id: Date.now(), topic, category: cat, stage: 'idea', created: new Date().toISOString() });
  data.ideas[cat].splice(idx, 1);
  saveData(data);
  renderAngles();
}

// ===== RENDER: PIPELINE =====
function renderPipeline() {
  const el = document.getElementById('pipeline-stages');
  let html = '';
  for (const stageKey of STAGE_ORDER) {
    const st = STAGES[stageKey];
    const items = data.pipeline.filter(p => p.stage === stageKey);
    html += `<div class="pipe-stage">
      <div class="pipe-emoji">${st.emoji}</div>
      <div class="pipe-label">${st.label}</div>
      <div class="pipe-count">${items.length}</div>
      <div class="pipe-items">`;
    items.forEach(item => {
      const catEmoji = CATEGORIES[item.category]?.emoji || '';
      const nextIdx = STAGE_ORDER.indexOf(stageKey);
      const canAdvance = nextIdx < STAGE_ORDER.length - 1;
      const canRevert = nextIdx > 0;
      html += `<div class="pipe-item">
        <span style="flex-shrink:0">${catEmoji}</span>
        <span class="pipe-item-text" title="${esc(item.topic)}">${esc(item.topic)}</span>
        ${canRevert ? `<button class="btn sm" onclick="movePipeline(${item.id},-1)" title="Move back">‚Äπ</button>` : ''}
        ${canAdvance ? `<button class="btn sm success" onclick="movePipeline(${item.id},1)" title="Advance">‚Ä∫</button>` : ''}
        <button class="btn sm danger" onclick="removePipeline(${item.id})" title="Remove">‚úï</button>
      </div>`;
    });
    html += '</div></div>';
  }
  el.innerHTML = html;
}

function movePipeline(id, dir) {
  const item = data.pipeline.find(p => p.id === id);
  if (!item) return;
  const idx = STAGE_ORDER.indexOf(item.stage);
  const next = idx + dir;
  if (next < 0 || next >= STAGE_ORDER.length) return;
  item.stage = STAGE_ORDER[next];
  saveData(data);
  renderPipeline();
}

function removePipeline(id) {
  data.pipeline = data.pipeline.filter(p => p.id !== id);
  saveData(data);
  renderPipeline();
}

function openPipelineModal() {
  document.getElementById('pipe-topic').value = '';
  document.getElementById('modal-pipeline').classList.add('show');
}

function addPipelineItem() {
  const topic = document.getElementById('pipe-topic').value.trim();
  if (!topic) return;
  const cat = document.getElementById('pipe-cat').value;
  const stage = document.getElementById('pipe-stage-sel').value;
  data.pipeline.push({ id: Date.now(), topic, category: cat, stage, created: new Date().toISOString() });
  saveData(data);
  closeModal('modal-pipeline');
  renderPipeline();
}

// ===== RENDER: CALENDAR =====
let calDate = new Date();

function renderCalendar() {
  const year = calDate.getFullYear();
  const month = calDate.getMonth();
  document.getElementById('cal-title').textContent = calDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

  const firstDay = new Date(year, month, 1).getDay(); // 0=Sun
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  const today = new Date();

  let html = '';
  const dayNames = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  dayNames.forEach(d => { html += `<div class="cal-header-cell">${d}</div>`; });

  // Empty cells before first day
  for (let i = 0; i < firstDay; i++) {
    html += '<div></div>';
  }

  for (let day = 1; day <= daysInMonth; day++) {
    const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
    const isToday = today.getFullYear() === year && today.getMonth() === month && today.getDate() === day;
    const items = data.calendar.filter(c => c.date === dateStr);
    html += `<div class="cal-cell${isToday ? ' today' : ''}" onclick="openCalendarModalForDate('${dateStr}')">
      <div class="cal-date">${day}</div>`;
    items.forEach(item => {
      const catEmoji = CATEGORIES[item.category]?.emoji || '';
      html += `<div class="cal-item">${catEmoji} ${esc(item.topic)}</div>`;
    });
    html += '</div>';
  }
  document.getElementById('cal-grid').innerHTML = html;
}

function calNav(dir) {
  calDate.setMonth(calDate.getMonth() + dir);
  renderCalendar();
}
function calToday() {
  calDate = new Date();
  renderCalendar();
}

function openCalendarModal() {
  document.getElementById('cal-date').value = new Date().toISOString().split('T')[0];
  document.getElementById('cal-topic').value = '';
  document.getElementById('modal-calendar').classList.add('show');
}

function openCalendarModalForDate(dateStr) {
  document.getElementById('cal-date').value = dateStr;
  document.getElementById('cal-topic').value = '';
  document.getElementById('modal-calendar').classList.add('show');
}

function addCalendarItem() {
  const date = document.getElementById('cal-date').value;
  const topic = document.getElementById('cal-topic').value.trim();
  const cat = document.getElementById('cal-cat').value;
  if (!date || !topic) return;
  data.calendar.push({ id: Date.now(), date, topic, category: cat });
  saveData(data);
  closeModal('modal-calendar');
  renderCalendar();
}

// ===== RENDER: PUBLISHED =====
function renderPublished() {
  const el = document.getElementById('publish-log');
  if (data.published.length === 0) {
    el.innerHTML = '<div class="empty">No published content logged yet. Click "+ Log Content" to start tracking.</div>';
    return;
  }
  const sorted = [...data.published].sort((a,b) => b.date.localeCompare(a.date));
  let html = `<div style="overflow-x:auto"><table class="log-table">
    <thead><tr>
      <th>Date</th><th>Topic</th><th class="hide-mobile">Category</th>
      <th>Format</th><th>Platform</th><th class="hide-mobile">Engagement</th><th></th>
    </tr></thead><tbody>`;
  sorted.forEach(p => {
    const cat = CATEGORIES[p.category];
    html += `<tr>
      <td style="white-space:nowrap">${p.date}</td>
      <td>${esc(p.topic)}</td>
      <td class="hide-mobile"><span class="chip ${p.category}">${cat ? cat.emoji + ' ' + cat.label : p.category}</span></td>
      <td>${formatLabel(p.format)}</td>
      <td>${platformLabel(p.platform)}</td>
      <td class="hide-mobile">${p.engagement ? esc(p.engagement) : '<span style="color:#555">‚Äî</span>'}</td>
      <td><button class="btn sm danger" onclick="removePublished(${p.id})">‚úï</button></td>
    </tr>`;
  });
  html += '</tbody></table></div>';
  el.innerHTML = html;
}

function formatLabel(f) {
  const map = { post: 'üìù Post', video: 'üé¨ Video', reel: 'üì± Reel', story: 'üìñ Story', carousel: 'üé† Carousel' };
  return map[f] || f;
}
function platformLabel(p) {
  const map = { instagram: 'üì∏ IG', tiktok: 'üéµ TikTok', facebook: 'üë• FB', youtube: '‚ñ∂Ô∏è YT' };
  return map[p] || p;
}

function openPublishModal() {
  document.getElementById('pub-date').value = new Date().toISOString().split('T')[0];
  document.getElementById('pub-topic').value = '';
  document.getElementById('pub-engagement').value = '';
  document.getElementById('modal-publish').classList.add('show');
}

function addPublished() {
  const date = document.getElementById('pub-date').value;
  const topic = document.getElementById('pub-topic').value.trim();
  const cat = document.getElementById('pub-cat').value;
  const format = document.getElementById('pub-format').value;
  const platform = document.getElementById('pub-platform').value;
  const engagement = document.getElementById('pub-engagement').value.trim();
  if (!date || !topic) return;
  data.published.push({ id: Date.now(), date, topic, category: cat, format, platform, engagement });
  saveData(data);
  closeModal('modal-publish');
  renderPublished();
}

function removePublished(id) {
  data.published = data.published.filter(p => p.id !== id);
  saveData(data);
  renderPublished();
}

// ===== RENDER: STATS =====
function renderStats() {
  const totalIdeas = Object.values(data.ideas).reduce((s, arr) => s + arr.length, 0);
  const now = new Date();
  const weekAgo = new Date(now); weekAgo.setDate(weekAgo.getDate() - 7);
  const monthAgo = new Date(now); monthAgo.setMonth(monthAgo.getMonth() - 1);

  const producedThisWeek = data.published.filter(p => new Date(p.date) >= weekAgo).length;
  const producedThisMonth = data.published.filter(p => new Date(p.date) >= monthAgo).length;
  const pipelineTotal = data.pipeline.length;

  document.getElementById('stats-grid').innerHTML = `
    <div class="stat-card"><div class="stat-value">${totalIdeas}</div><div class="stat-label">Ideas in Bank</div></div>
    <div class="stat-card"><div class="stat-value">${pipelineTotal}</div><div class="stat-label">In Pipeline</div></div>
    <div class="stat-card"><div class="stat-value">${producedThisWeek}</div><div class="stat-label">Published This Week</div></div>
    <div class="stat-card"><div class="stat-value">${producedThisMonth}</div><div class="stat-label">Published This Month</div></div>
  `;

  // Distribution
  const maxIdeas = Math.max(1, ...Object.values(data.ideas).map(a => a.length));
  let distHtml = '';
  for (const [key, cat] of Object.entries(CATEGORIES)) {
    const count = (data.ideas[key] || []).length;
    const pct = (count / maxIdeas) * 100;
    distHtml += `<div class="dist-bar">
      <div class="dist-label">${cat.emoji} ${cat.label}</div>
      <div class="dist-track"><div class="dist-fill ${key}" style="width:${pct}%"></div></div>
      <div class="dist-count">${count}</div>
    </div>`;
  }
  document.getElementById('dist-bars').innerHTML = distHtml;
}

// ===== HELPERS =====
function esc(s) {
  const d = document.createElement('div');
  d.textContent = s;
  return d.innerHTML;
}

function closeModal(id) {
  document.getElementById(id).classList.remove('show');
}

// Close modals on overlay click
document.querySelectorAll('.modal-overlay').forEach(ov => {
  ov.addEventListener('click', e => {
    if (e.target === ov) ov.classList.remove('show');
  });
});

// ===== MAIN RENDER =====
function render() {
  data = loadData();
  renderAngles();
  renderPipeline();
  renderCalendar();
  renderPublished();
  renderStats();
}

render();
</script>
</body>
</html>
