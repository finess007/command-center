<!DOCTYPE html>
<html class="staticrypt-html">
    <head>
        <meta charset="utf-8" />
        <title>Protected Page</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- do not cache this page -->
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />

        <style>
            .staticrypt-hr {
                margin-top: 20px;
                margin-bottom: 20px;
                border: 0;
                border-top: 1px solid #eee;
            }

            .staticrypt-page {
                width: 360px;
                padding: 8% 0 0;
                margin: auto;
                box-sizing: border-box;
            }

            .staticrypt-form {
                position: relative;
                z-index: 1;
                background: #ffffff;
                max-width: 360px;
                margin: 0 auto 100px;
                padding: 45px;
                text-align: center;
                box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
            }

            .staticrypt-form input[type="password"],
            input[type="text"] {
                background: inherit;
                border: 0;
                box-sizing: border-box; /* This ensures padding is included in the total width */
                font-size: 14px;
                outline: 0;
                padding: 15px 30px 15px 15px; /* Adjust the padding to ensure there is space for the icon */
                width: 100%;
            }

            .staticrypt-password-container {
                position: relative;
                outline: 0;
                background: #f2f2f2;
                width: 100%;
                border: 0;
                margin: 0 0 15px;
                box-sizing: border-box;
            }

            .staticrypt-toggle-password-visibility {
                cursor: pointer;
                height: 20px;
                opacity: 60%;
                padding: 13px;
                position: absolute;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                width: 20px;
            }

            .staticrypt-form .staticrypt-decrypt-button {
                text-transform: uppercase;
                outline: 0;
                background: #4CAF50;
                width: 100%;
                border: 0;
                padding: 15px;
                color: #ffffff;
                font-size: 14px;
                cursor: pointer;
            }

            .staticrypt-form .staticrypt-decrypt-button:hover,
            .staticrypt-form .staticrypt-decrypt-button:active,
            .staticrypt-form .staticrypt-decrypt-button:focus {
                background: #4CAF50;
                filter: brightness(92%);
            }

            .staticrypt-html {
                height: 100%;
            }

            .staticrypt-body {
                height: 100%;
                margin: 0;
            }

            .staticrypt-content {
                height: 100%;
                margin-bottom: 1em;
                background: #76B852;
                font-family: "Arial", sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            .staticrypt-instructions {
                margin-top: -1em;
                margin-bottom: 1em;
            }

            .staticrypt-title {
                font-size: 1.5em;
            }

            label.staticrypt-remember {
                display: flex;
                align-items: center;
                margin-bottom: 1em;
            }

            .staticrypt-remember input[type="checkbox"] {
                transform: scale(1.5);
                margin-right: 1em;
            }

            .hidden {
                display: none !important;
            }

            .staticrypt-spinner-container {
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .staticrypt-spinner {
                display: inline-block;
                width: 2rem;
                height: 2rem;
                vertical-align: text-bottom;
                border: 0.25em solid gray;
                border-right-color: transparent;
                border-radius: 50%;
                -webkit-animation: spinner-border 0.75s linear infinite;
                animation: spinner-border 0.75s linear infinite;
                animation-duration: 0.75s;
                animation-timing-function: linear;
                animation-delay: 0s;
                animation-iteration-count: infinite;
                animation-direction: normal;
                animation-fill-mode: none;
                animation-play-state: running;
                animation-name: spinner-border;
            }

            @keyframes spinner-border {
                100% {
                    transform: rotate(360deg);
                }
            }

            @media screen and (-webkit-min-device-pixel-ratio: 0) {
                .staticrypt-form input[type="password"],
                input[type="text"] {
                    font-size: 16px;
                }
            }
        </style>
    </head>

    <body class="staticrypt-body">
        <div id="staticrypt_loading" class="staticrypt-spinner-container">
            <div class="staticrypt-spinner"></div>
        </div>

        <div id="staticrypt_content" class="staticrypt-content hidden">
            <div class="staticrypt-page">
                <div class="staticrypt-form">
                    <div class="staticrypt-instructions">
                        <p class="staticrypt-title">Protected Page</p>
                        <p></p>
                    </div>

                    <hr class="staticrypt-hr" />

                    <form id="staticrypt-form" action="#" method="post">
                        <div class="staticrypt-password-container">
                            <input
                                id="staticrypt-password"
                                type="password"
                                name="password"
                                placeholder="Password"
                                autofocus
                            />

                            <img
                                class="staticrypt-toggle-password-visibility"
                                alt="Show password"
                                title="Show password"
                                src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg=="
                            />
                        </div>

                        <label id="staticrypt-remember-label" class="staticrypt-remember hidden">
                            <input id="staticrypt-remember" type="checkbox" name="remember" />
                            Remember me
                        </label>

                        <input type="submit" class="staticrypt-decrypt-button" value="DECRYPT" />
                    </form>
                </div>
            </div>
        </div>

        <script>
            // these variables will be filled when generating the file - the template format is 'variable_name'
            const staticryptInitiator = ((function(){
  const exports = {};
  const cryptoEngine = ((function(){
  const exports = {};
  const { subtle } = crypto;

const IV_BITS = 16 * 8;
const HEX_BITS = 4;
const ENCRYPTION_ALGO = "AES-CBC";

/**
 * Translates between utf8 encoded hexadecimal strings
 * and Uint8Array bytes.
 */
const HexEncoder = {
    /**
     * hex string -> bytes
     * @param {string} hexString
     * @returns {Uint8Array}
     */
    parse: function (hexString) {
        if (hexString.length % 2 !== 0) throw "Invalid hexString";
        const arrayBuffer = new Uint8Array(hexString.length / 2);

        for (let i = 0; i < hexString.length; i += 2) {
            const byteValue = parseInt(hexString.substring(i, i + 2), 16);
            if (isNaN(byteValue)) {
                throw "Invalid hexString";
            }
            arrayBuffer[i / 2] = byteValue;
        }
        return arrayBuffer;
    },

    /**
     * bytes -> hex string
     * @param {Uint8Array} bytes
     * @returns {string}
     */
    stringify: function (bytes) {
        const hexBytes = [];

        for (let i = 0; i < bytes.length; ++i) {
            let byteString = bytes[i].toString(16);
            if (byteString.length < 2) {
                byteString = "0" + byteString;
            }
            hexBytes.push(byteString);
        }
        return hexBytes.join("");
    },
};

/**
 * Translates between utf8 strings and Uint8Array bytes.
 */
const UTF8Encoder = {
    parse: function (str) {
        return new TextEncoder().encode(str);
    },

    stringify: function (bytes) {
        return new TextDecoder().decode(bytes);
    },
};

/**
 * Salt and encrypt a msg with a password.
 */
async function encrypt(msg, hashedPassword) {
    // Must be 16 bytes, unpredictable, and preferably cryptographically random. However, it need not be secret.
    // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/encrypt#parameters
    const iv = crypto.getRandomValues(new Uint8Array(IV_BITS / 8));

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["encrypt"]);

    const encrypted = await subtle.encrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        UTF8Encoder.parse(msg)
    );

    // iv will be 32 hex characters, we prepend it to the ciphertext for use in decryption
    return HexEncoder.stringify(iv) + HexEncoder.stringify(new Uint8Array(encrypted));
}
exports.encrypt = encrypt;

/**
 * Decrypt a salted msg using a password.
 *
 * @param {string} encryptedMsg
 * @param {string} hashedPassword
 * @returns {Promise<string>}
 */
async function decrypt(encryptedMsg, hashedPassword) {
    const ivLength = IV_BITS / HEX_BITS;
    const iv = HexEncoder.parse(encryptedMsg.substring(0, ivLength));
    const encrypted = encryptedMsg.substring(ivLength);

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["decrypt"]);

    const outBuffer = await subtle.decrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        HexEncoder.parse(encrypted)
    );

    return UTF8Encoder.stringify(new Uint8Array(outBuffer));
}
exports.decrypt = decrypt;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
async function hashPassword(password, salt) {
    // we hash the password in multiple steps, each adding more iterations. This is because we used to allow less
    // iterations, so for backward compatibility reasons, we need to support going from that to more iterations.
    let hashedPassword = await hashLegacyRound(password, salt);

    hashedPassword = await hashSecondRound(hashedPassword, salt);

    return hashThirdRound(hashedPassword, salt);
}
exports.hashPassword = hashPassword;

/**
 * This hashes the password with 1k iterations. This is a low number, we need this function to support backwards
 * compatibility.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
function hashLegacyRound(password, salt) {
    return pbkdf2(password, salt, 1000, "SHA-1");
}
exports.hashLegacyRound = hashLegacyRound;

/**
 * Add a second round of iterations. This is because we used to use 1k, so for backwards compatibility with
 * remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashSecondRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 14000, "SHA-256");
}
exports.hashSecondRound = hashSecondRound;

/**
 * Add a third round of iterations to bring total number to 600k. This is because we used to use 1k, then 15k, so for
 * backwards compatibility with remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashThirdRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 585000, "SHA-256");
}
exports.hashThirdRound = hashThirdRound;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @param {int} iterations
 * @param {string} hashAlgorithm
 * @returns {Promise<string>}
 */
async function pbkdf2(password, salt, iterations, hashAlgorithm) {
    const key = await subtle.importKey("raw", UTF8Encoder.parse(password), "PBKDF2", false, ["deriveBits"]);

    const keyBytes = await subtle.deriveBits(
        {
            name: "PBKDF2",
            hash: hashAlgorithm,
            iterations,
            salt: UTF8Encoder.parse(salt),
        },
        key,
        256
    );

    return HexEncoder.stringify(new Uint8Array(keyBytes));
}

function generateRandomSalt() {
    const bytes = crypto.getRandomValues(new Uint8Array(128 / 8));

    return HexEncoder.stringify(new Uint8Array(bytes));
}
exports.generateRandomSalt = generateRandomSalt;

async function signMessage(hashedPassword, message) {
    const key = await subtle.importKey(
        "raw",
        HexEncoder.parse(hashedPassword),
        {
            name: "HMAC",
            hash: "SHA-256",
        },
        false,
        ["sign"]
    );
    const signature = await subtle.sign("HMAC", key, UTF8Encoder.parse(message));

    return HexEncoder.stringify(new Uint8Array(signature));
}
exports.signMessage = signMessage;

function getRandomAlphanum() {
    const possibleCharacters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

    let byteArray;
    let parsedInt;

    // Keep generating new random bytes until we get a value that falls
    // within a range that can be evenly divided by possibleCharacters.length
    do {
        byteArray = crypto.getRandomValues(new Uint8Array(1));
        // extract the lowest byte to get an int from 0 to 255 (probably unnecessary, since we're only generating 1 byte)
        parsedInt = byteArray[0] & 0xff;
    } while (parsedInt >= 256 - (256 % possibleCharacters.length));

    // Take the modulo of the parsed integer to get a random number between 0 and totalLength - 1
    const randomIndex = parsedInt % possibleCharacters.length;

    return possibleCharacters[randomIndex];
}

/**
 * Generate a random string of a given length.
 *
 * @param {int} length
 * @returns {string}
 */
function generateRandomString(length) {
    let randomString = "";

    for (let i = 0; i < length; i++) {
        randomString += getRandomAlphanum();
    }

    return randomString;
}
exports.generateRandomString = generateRandomString;

  return exports;
})());
const codec = ((function(){
  const exports = {};
  /**
 * Initialize the codec with the provided cryptoEngine - this return functions to encode and decode messages.
 *
 * @param cryptoEngine - the engine to use for encryption / decryption
 */
function init(cryptoEngine) {
    const exports = {};

    /**
     * Top-level function for encoding a message.
     * Includes password hashing, encryption, and signing.
     *
     * @param {string} msg
     * @param {string} password
     * @param {string} salt
     *
     * @returns {string} The encoded text
     */
    async function encode(msg, password, salt) {
        const hashedPassword = await cryptoEngine.hashPassword(password, salt);

        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encode = encode;

    /**
     * Encode using a password that has already been hashed. This is useful to encode multiple messages in a row, that way
     * we don't need to hash the password multiple times.
     *
     * @param {string} msg
     * @param {string} hashedPassword
     *
     * @returns {string} The encoded text
     */
    async function encodeWithHashedPassword(msg, hashedPassword) {
        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encodeWithHashedPassword = encodeWithHashedPassword;

    /**
     * Top-level function for decoding a message.
     * Includes signature check and decryption.
     *
     * @param {string} signedMsg
     * @param {string} hashedPassword
     * @param {string} salt
     * @param {int} backwardCompatibleAttempt
     * @param {string} originalPassword
     *
     * @returns {Object} {success: true, decoded: string} | {success: false, message: string}
     */
    async function decode(signedMsg, hashedPassword, salt, backwardCompatibleAttempt = 0, originalPassword = "") {
        const encryptedHMAC = signedMsg.substring(0, 64);
        const encryptedMsg = signedMsg.substring(64);
        const decryptedHMAC = await cryptoEngine.signMessage(hashedPassword, encryptedMsg);

        if (decryptedHMAC !== encryptedHMAC) {
            // we have been raising the number of iterations in the hashing algorithm multiple times, so to support the old
            // remember-me/autodecrypt links we need to try bringing the old hashes up to speed.
            originalPassword = originalPassword || hashedPassword;
            if (backwardCompatibleAttempt === 0) {
                const updatedHashedPassword = await cryptoEngine.hashThirdRound(originalPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }
            if (backwardCompatibleAttempt === 1) {
                let updatedHashedPassword = await cryptoEngine.hashSecondRound(originalPassword, salt);
                updatedHashedPassword = await cryptoEngine.hashThirdRound(updatedHashedPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }

            return { success: false, message: "Signature mismatch" };
        }

        return {
            success: true,
            decoded: await cryptoEngine.decrypt(encryptedMsg, hashedPassword),
        };
    }
    exports.decode = decode;

    return exports;
}
exports.init = init;

  return exports;
})());
const decode = codec.init(cryptoEngine).decode;

/**
 * Initialize the staticrypt module, that exposes functions callbable by the password_template.
 *
 * @param {{
 *  staticryptEncryptedMsgUniqueVariableName: string,
 *  isRememberEnabled: boolean,
 *  rememberDurationInDays: number,
 *  staticryptSaltUniqueVariableName: string,
 * }} staticryptConfig - object of data that is stored on the password_template at encryption time.
 *
 * @param {{
 *  rememberExpirationKey: string,
 *  rememberPassphraseKey: string,
 *  replaceHtmlCallback: function,
 *  clearLocalStorageCallback: function,
 * }} templateConfig - object of data that can be configured by a custom password_template.
 */
function init(staticryptConfig, templateConfig) {
    const exports = {};

    /**
     * Decrypt our encrypted page, replace the whole HTML.
     *
     * @param {string} hashedPassword
     * @returns {Promise<boolean>}
     */
    async function decryptAndReplaceHtml(hashedPassword) {
        const { staticryptEncryptedMsgUniqueVariableName, staticryptSaltUniqueVariableName } = staticryptConfig;
        const { replaceHtmlCallback } = templateConfig;

        const result = await decode(
            staticryptEncryptedMsgUniqueVariableName,
            hashedPassword,
            staticryptSaltUniqueVariableName
        );
        if (!result.success) {
            return false;
        }
        const plainHTML = result.decoded;

        // if the user configured a callback call it, otherwise just replace the whole HTML
        if (typeof replaceHtmlCallback === "function") {
            replaceHtmlCallback(plainHTML);
        } else {
            document.write(plainHTML);
            document.close();
        }

        return true;
    }

    /**
     * Attempt to decrypt the page and replace the whole HTML.
     *
     * @param {string} password
     * @param {boolean} isRememberChecked
     *
     * @returns {Promise<{isSuccessful: boolean, hashedPassword?: string}>} - we return an object, so that if we want to
     *   expose more information in the future we can do it without breaking the password_template
     */
    async function handleDecryptionOfPage(password, isRememberChecked) {
        const { staticryptSaltUniqueVariableName } = staticryptConfig;

        // decrypt and replace the whole page
        const hashedPassword = await cryptoEngine.hashPassword(password, staticryptSaltUniqueVariableName);
        return handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked);
    }
    exports.handleDecryptionOfPage = handleDecryptionOfPage;

    async function handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked) {
        const { isRememberEnabled, rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

        if (!isDecryptionSuccessful) {
            return {
                isSuccessful: false,
                hashedPassword,
            };
        }

        // remember the hashedPassword and set its expiration if necessary
        if (isRememberEnabled && isRememberChecked) {
            window.localStorage.setItem(rememberPassphraseKey, hashedPassword);

            // set the expiration if the duration isn't 0 (meaning no expiration)
            if (rememberDurationInDays > 0) {
                window.localStorage.setItem(
                    rememberExpirationKey,
                    (new Date().getTime() + rememberDurationInDays * 24 * 60 * 60 * 1000).toString()
                );
            }
        }

        return {
            isSuccessful: true,
            hashedPassword,
        };
    }
    exports.handleDecryptionOfPageFromHash = handleDecryptionOfPageFromHash;

    /**
     * Clear localstorage from staticrypt related values
     */
    function clearLocalStorage() {
        const { clearLocalStorageCallback, rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        if (typeof clearLocalStorageCallback === "function") {
            clearLocalStorageCallback();
        } else {
            localStorage.removeItem(rememberPassphraseKey);
            localStorage.removeItem(rememberExpirationKey);
        }
    }

    async function handleDecryptOnLoad() {
        let isSuccessful = await decryptOnLoadFromUrl();

        if (!isSuccessful) {
            isSuccessful = await decryptOnLoadFromRememberMe();
        }

        return { isSuccessful };
    }
    exports.handleDecryptOnLoad = handleDecryptOnLoad;

    /**
     * Clear storage if we are logging out
     *
     * @returns {boolean} - whether we logged out
     */
    function logoutIfNeeded() {
        const logoutKey = "staticrypt_logout";

        // handle logout through query param
        const queryParams = new URLSearchParams(window.location.search);
        if (queryParams.has(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        // handle logout through URL fragment
        const hash = window.location.hash.substring(1);
        if (hash.includes(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        return false;
    }

    /**
     * To be called on load: check if we want to try to decrypt and replace the HTML with the decrypted content, and
     * try to do it if needed.
     *
     * @returns {Promise<boolean>} true if we derypted and replaced the whole page, false otherwise
     */
    async function decryptOnLoadFromRememberMe() {
        const { rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        // if we are login out, terminate
        if (logoutIfNeeded()) {
            return false;
        }

        // if there is expiration configured, check if we're not beyond the expiration
        if (rememberDurationInDays && rememberDurationInDays > 0) {
            const expiration = localStorage.getItem(rememberExpirationKey),
                isExpired = expiration && new Date().getTime() > parseInt(expiration);

            if (isExpired) {
                clearLocalStorage();
                return false;
            }
        }

        const hashedPassword = localStorage.getItem(rememberPassphraseKey);

        if (hashedPassword) {
            // try to decrypt
            const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

            // if the decryption is unsuccessful the password might be wrong - silently clear the saved data and let
            // the user fill the password form again
            if (!isDecryptionSuccessful) {
                clearLocalStorage();
                return false;
            }

            return true;
        }

        return false;
    }

    async function decryptOnLoadFromUrl() {
        const passwordKey = "staticrypt_pwd";
        const rememberMeKey = "remember_me";

        // try to get the password from the query param (for backward compatibility - we now want to avoid this method,
        // since it sends the hashed password to the server which isn't needed)
        const queryParams = new URLSearchParams(window.location.search);
        const hashedPasswordQuery = queryParams.get(passwordKey);
        const rememberMeQuery = queryParams.get(rememberMeKey);

        const urlFragment = window.location.hash.substring(1);
        // get the password from the url fragment
        const hashedPasswordRegexMatch = urlFragment.match(new RegExp(passwordKey + "=([^&]*)"));
        const hashedPasswordFragment = hashedPasswordRegexMatch ? hashedPasswordRegexMatch[1] : null;
        const rememberMeFragment = urlFragment.includes(rememberMeKey);

        const hashedPassword = hashedPasswordFragment || hashedPasswordQuery;
        const rememberMe = rememberMeFragment || rememberMeQuery;

        if (hashedPassword) {
            return handleDecryptionOfPageFromHash(hashedPassword, rememberMe);
        }

        return false;
    }

    return exports;
}
exports.init = init;

  return exports;
})());
            const templateError = "Bad password!",
                templateToggleAltShow = "Show password",
                templateToggleAltHide = "Hide password",
                isRememberEnabled = true,
                staticryptConfig = {"staticryptEncryptedMsgUniqueVariableName":"d39330179013043677149133396ee773e431b3acbab71d687abeffa81a122badf6ad13ccf357e6ce4d28fdc19de5c72afe1d53510afc4ba95c639ee5e2aa17cc81ce7ca96754613c9f199c37eff106756c33f3b388d4b4f9ada08193c0f70f485c08f5ea03143d37ef5f6876b8cb453aba84d9b7720dfc0ea1d68ccf78483193036a4c3a99844197d64cc0d3758306f50bf8003ce78fadd99b585917a515e5c132de3cc29554b38ce849c5523e7a14d50cf7e5180ac63117767678c15a468d092feb0cdb2ea765a38ac5ea26ecdee4219e7d9339fe172da69b2da2fbe4d6c661bb7195a07ab1e035f2ba8b3a465be903b717def66a59b94f02784925b2ba98898ed954d612f91778f8f42949822bcacb0a67d2d25b17c489b6ef7c4a2d26e712b4d96e92ce7dc6b76813770b396bfbbc45dcf1d9b26052f43ee59b8e4b28a61994cc198575eed536cea670a3e0e64fd0cdfee3570fb5ed37f6070f227aedd7966b79e6b2b54d7aeec3769501d2094143862a5b122f4962b6ecb1096911c08a281ff831cbdbc26fab0f2de83c4e71842bff8fa8b3f0370b74897fa2f420b95f2242bdb27f5c749f9cff251a97724cec8758c89a11d92fca7e5fccf2a375455208a607c02dad00a8fb86fdfccd189ce7975ff897ecff7e5b5b36c684347003e49175d0676e539f33b230d06e7b4f4e95d29e8d1fd427ea348620310beb5376f12bf8e057d04f3d268cb330735b2c21e59705e8a45f3842e1d2b7e314d1787ca66631ed306ba86cb7bcd0d04feca56e34729b1b975d0ebf82cc659b84dd851de96a67930060e30352b7e81b15fb8dd01332e53975f46ea23ebb6c2c7eac765acea5f8422be691b8b0686d827cfcfb7658b98dc49fea51079d7c29eb8b64e92b07fb7883f568d52973430dc314abea6d9122f08f56d6141144772afac450e9b3f3fa1090afc2b71b731960175ed285da5fc3314233cfb5243066b786f1269747dea8120411ac389849ab1b52cb7a78dca64a93b4da14fddc170452298bae93df1b8d53f351674a693ae6e13fa5d93e1fe1674cc028cc1f8ad373ad2337084e94358e74d4b50b717e777e1b952f5569ae605bbe9fd93d4788576cf02e5c6b2a25927d77030d085eaf28d4c896d86fec8cb994e536f9353bb5d128dd20bd81ca2c2853a643b27dc11d5d6652873c7af15cb37337ec42018315c936b3d39938aae64e0db1b2f078231f33ce8bf0ddc302baeb7aa6c8bd895c6a857508ea91a64b0e38d7c758a0e5a4100f798ba8a561c51363d70247ce635648e9eb692b414b37c3b5e59541f9b7c30209f838dfc9b491f1b746eebb482cfcf2229312d961b617c8198aeaed5a566c6defa2341452ab7e509ceb17e91d2d231262129d9e4273072b9cd83b8a7ba1192a07fb7bf435504574906bcdaee3dd3685a52d36379739748900aae1b251a7c5fbf8797671444514188180960dd2361f51651c138e9c0053bdccf164fd392e42bc8de9b59da41129f01aba1d95cf73f9e9b98e9769daf41df62555685bb8fb4af81c0f7cc9382940cf3946e36c2482aae69f15f019c230e97b4c3a255cd537a39b3434516eb831d751310af881eed03b425b6b6d6cefe5e8e46f58ffbd70505db9eac348683b3a888e5dd02548179b9414eafa5bba4487b766fbe3ee96eaec9bc33e4ddecc952e102bd8eab074047ed8be945485adb0b422131e32f7055d94a8327f969181e078962038480c1efa0bdb9db3978099ce6ede924f19f1eedddcef8ad4c1ade53608db1844329c49f7d630acf0958c27a66ac4e0aafbec393ef4a4111537f673f54c502ee67539d15eb1094b8c05f0c399c601c0d06224a29cffb8dcf1af7d1580c85ca7aea70f3a6961a90cb903ba534b08b9db8204be906f14b0476c3be491905112dd29d2726f816f16c22c92e5774680cb6068289234f237d48461b2cd68df10c9426ddc1f7017c6d63f3849bb5f30dc79fb3fa04881c76b2010f177d6f1792b9f7601a7134c4de869616ed1c02e6e0757642d0a971fdf65e354fa68f2553223ffad5cdc1abd9e7972b7ac08e32d7c9f7c93e4efd185d2f3af7818a44ffe799925409b22391196021845d42a3a3019c03240f0da5156b74d126312a4fd9d13ccf19218ce3c2b8b9c174d139a88542df8a8e7e2d1da0ee00f7d514f98d3a118189e973f07ae36f8e284d748c5d46624a82d8a2a8e63bbe8a7d9817d36dd253b393c440a5507205defc28aa2390f5b35cda4b912e44120cb99e420eed3a351e95d3d9f267427250844617b04c5c64d540db50f3b08019247147793647f75deb7d1f716ad5d82859a92f0d735bd887a7413b2f14e02b1d7a3878fa9328ab30d0375a714dbecbc4d53b4dda33ccaaa7586ad74b53a5afe63fb4cb61f39b9509156e48439af3aea0880d03a0961fc9b65e54350c62fbfdaa6e2c83520393cea5ad104ff0e4a1743e6d0d34058c65bf8e5e76e13b4cd4d45fa19b84602bb5df90f03a9da5001eb061637d34d811f3bb58907de65fa51e19f227e646232a479faccc8ed881aace5e4b030b30b6aadea1a8bc99c550f88cc3168a8dd08ea023d2e2ddc2e71065b4f56f64b65e0ed4af0a458688ab6c39b02dfa80bed1d3c8363c3648a69f3aeda66f547a5bd06a4114bf70243d02b7a382ed4b1a68d545f4c2084d5a21d9cee707c4371166f1623de448878217b6324e532a39f641aff7130c5a4cf042bbaf6ba91bcab1dff975cb9313a37e52020e0e4692f0cabae22947b9c1fded3f6e47b7b5937e99f1f9bde472dcf1adc6f3c7aa028c6253eb927087049f12ad996f50d063c4c029df025485104f899e7f308a236b7749f135faa9554f1af32a22a7aa75a0be4d7fd73d67e2315b28501abd5aa027589c4f7260adea17142f850aa644d79eb44b8577dfbdbea4dd60674171946a0fc81bd1e4f7e121e65b4c63f27d405ce0cd446ad5fc61737c2d798b78d7ce337539320a529ad32e83e8db4bd988fc3fd089a38249148e80e8a86b6b07db8725e7e3b541a19ffa8972a7c2905cc2d4f290ab6630653c0cac97b757a71ea0bf98536bf1d383b4f3378c88da8ac0e61ca43605df9a21f6a93cefdb339d1c7969c5023fb4380f59b610bdd88773202e59969d07ae56ae9337db4d74025f4f4d969c8d4c41179776f990917a495a5a3c68a05d65636f506f7f36b1d9f46295a598654c272526f78b9990a2e6efe09c3b08981c9f60f3bf52b813ec17112f4891669ac1b774985b8f769b48c6748105169987380465e3831fdb2b5b56b4a9325437c9bf45653c52d9dc3ec682a6314b41d7db07cade295c6435c7c18238381e8ead78859428b893ca6d92c4e70edef30bdd1e30c8c6f7814be7a4498d3896ef2102997041b593445676ca7792a387899af2d94d2c8f3d588f3993db7d49491ae9d979150f42c2a0ba195e4ea693d0368e212188f48b42ef085e673b3961aba8d9d6d2eaa6ebfe8f523a7126975ac6cc2eba74e32b4e3e755c7785d66c47f72ade7b768c63e4c44fdc2528e8564a3c12bac7c74f7679be97109b236cf0d44125c2f053a534455a299324a4e3694cb6400e0d79f466ba7055fe1b278943e7ca4066396967aeeeb7c3f9158bb4170a091b2328f736e59d36164afc91c61543f3b88f713194e6a735e841ada7b43f390de3219d8936562a410e32236d9ccf170ac181c9b2c8dbef2ce0e6bb62e994d6fe855741077da5cc26348e22233bcb24a62000f0ea67d70c423ed4e0c4c53a2e4c38354dafe3356a419732741abe9f69739bed4d27852b3c34da1309fcb0dd58c4367ca90d1bfb054540b76ff1c0606d17281e208a09f7bec3ae1149b57a1fdd74a2a36f39b71328d65a0a137c1c7b0c1b869b7cc54ee09cb5a172eb47a2578a3d741a9b28282e6afc63cc6d5f76b33a4a49210b4274e1d97a041e6a6aca18a48cf5572bf94102776a1b156ebfc58ffbdb7453e37b0829556ccafd215acc8881bc2decf48463fb6312c5b8458c389a67c36ab82ed66af8d947c3408033b4c502ef3fdd5b935fa3f9a04dd2eee7f071d4bdec4e6b0eb8b0722a39d350dbb3a995fc24e769c85febae3b27c58863370f7ef083ba45173c1440969227c69e7085fb6f12912dc84e1d282a2232b72107871699627534f396419ebe785e56d8ee34b895c88f736ce87c7f971916b33065afe8982e6211ab8fb17feb0b18791b7ba8e67c76b2b8e499ff60ddb342e8cfb0012da8ba93ca8cf7f79b67a2d6df77f64ff876071cf5880b1481a7ec7c6ec2fc81f9e8690bd33cbe56769a7f45a25e9832b328ac54d43a73bf9b2cd1e22b75a764768ebc3eb8adc83608bb471a261959c02b9e02971cbfc459b9ce201f3df27c342b2a266e49054272e1392275972379d376aae156b43e6489cc585df4ba06ee5327154dcda1e1378deacf64c33dc3442886d362cc799d7a9979581497a1d7bbcddc2ee7208d8c0e298112b085e7ff800e53aaba2e47f5f6ffb6d3e57063d97a21bc6a4e70c1114a7af8d091f0cb9938becd350b49cae659a4880c47a1333f5955061472f1f2ce30a5f23da7d541b3ba22eee2db59bf5d42369020a0a86048b4c7990216e566ed9e56885e6cb88d6b9da704145a0ca6bb233571a2026808cdda6065c0424544983a729d9dfb4c546b838fcddb774fb5f656fae401010114ac3ea73e4020064c5562a6713f71528bed601a6c645b41226af2638035f94d1fd1a6dec35b80b1dbc00a1d59a9cfd36bfdd1c09d603ebc7794c893a8fcb54596133504bbf9885a1b41e093d5cf673d72815d0e3712abeeb9bd7920fcba16e90418cbb12f58e87f5f8aac43a8345ebe0295ac0d086e972f5d6727de65eae787ab5ed7eb919349e6756e713ded7f6b4121695fe98218cf4f96e62206585d76671f026c7ebfa3023d63a2204f028ca751bcef11cfae63b404f184eb7053203326f8e01e75333db2afaf72c25763563f3fb153d2e4bf60dc2690680bf2871127acbbac9beefa89ff910cb77ac8e9d23c5dc67723178866f4705bcd00c5ca2e10c9822334bcbe4a8e218da285637e14644236657975f9b3e628e57178f30130b960122a3d50d802f7d35c41b90fef23850f6425c469784f191b2808954a29c0da1545bd3d834787fd0df4bb29ef386bdd73cec7a507cd68fd9ece60ad2d38409f77ba0ea6a85d3cd4d4776fb986888f86d988f7802d7be4e07570ec12ef026ce7d7788ae59ac2fa9ee91b491c6586eca38c9be1751be40e267f920b5f543f3a68591b41bd8aac986a9dca5dfa530747efb510c40af6572caf059deeb0a2fbd150f612ab049c98190db90a86b530ee561eb341fd75bb70da2df8c81f4fb6430f767ad08eaf8ec375d7bdd6142d6469a5ce57bf94c2ae4b106e0a32c40fa1061a73d76fec91b63012d47e7fcf36efc27b4477404aeb64befdff1b89ef8472a84c0d33e767f75d9b5f17e3fb68adfd4fc5dac5854a2804b78f58c7e570a646470418c4e445e3e161a66a418698a74b0dd23cb2cf2c466c82711f52ed5a1452bae23d57a5e444d7f0d75b4a0272a104e2de64c4846592c427989edd2c5f7b34b2fd560e9706b73dc9b232b65bb33eba463216b6f0defd565f81f98a6bdbd5ef1e14f39c12f471365067468887666f910a383cc4ace7a4fb0f7fe0eca8d6679cd84cf48080a6e346ba002608eb09fe45fff58d74784a8116ff715e54ceb5faf699c64958bf382f0e7f9e9eed72b79ada330d79802ff00273752c89be4e62e68697d24f5b21e7266f5bbebac494de71481ebad6db4fb8fce4b5a04bb17d38b4053006d7ec974a5a3812c0c5a28a468f507d42f8e3c200b2508f8cc990e9db0373cfbbe740fb8a73195a685eaffc3b8291cb7040bba42ffe1a8c19d29f5d1959d2ee56be1b8fa8e9059990c2fd1b117db4b4b67a627e8abc15cc0ad3d793db25d2d7d69d6331b3bfdf8167b14f02e590e83aa3f2fc67fc01cdf22660e391950c0339d2346dfa84ad2858964ef350ee3179954eee5b8ec23b003a9d264ce8ef97636726232b9a07d16ee407f9ec124215318d98136fa0492b1aa2922e717a5080a89961c8bdcb1400df236d292955fd3e4f5adb60c8a73ae140821d270958aa4889586d84cbe4ab4961565e5e18cd5b1e0bd15bd6afb0bb672f23a3c0452b308576fbd1fde40a5634f7c8c7506619f91278f4599336999ab77e0e4b46f5f162a313267814f0e94d62c42dbffa33ce08b7d4446c7f21e45afa3f35b91eb9ea2d0f4ec6949e3e12f41bb7065776c494ea271bc4701f0d00c6c8d4da4ba0b54a360112a0c4a4891b887c494ba199960342e039c0e1d4bf433addbb740d8ad5d91e0acdce20d055f83f80cad38447c89b0ada88b9d80cb49bc4eb8e2342eb0b85ce96a68647d9dc124dcd27230695faaeb8acf3e5b32b63a05a2bed8076449bc9172ca3217ce009a4d9063a566045d89f64ef5c1457576ec4ae4765df67b0ccd30b6d544ce4b83cef6a63d50aa36ea7f77ac4e417d06de01c6edaa3a90de18e3e25d3dd394fd781a9e8c89b43eab423617cd4719a0f2b62caed1b207308f3cbee094ddd14388489cb01e84c16fb6e3bdccdef7d14d7e10be0269b2a925b567b5a2f257faade9c3cd4ee624b5bf50dc8e725e8f76440c79fb521ec1e986633f23ff350ae7c527ee65eb019cc5154984e4b2b9caa9917cd89459a568b5295e71ae4c8e4241e7330779f78d206991d45e3b165ed8c87d8889586c068e90306fe9ecf2f7c544b97504325d5311972fbce25ed4d8d774ceba6c060dc3e19d91be5ea35687d24b8d732193b4a050c3dcf14ca6aa3968d4238f816e29aa6168bd0ff82de2da91739a3dfb907559277d6dab20d7fed1dfa0ec8e8fe7cf97cbb4da6f796c4cbc9ee6ee7e92b503ee1c40f03bca860d0c87c196f02a1181b98f5a5afa1727a3babe504fd0b5aa91ad3cbc2978594bbf74ca61814e1a3f8574d4f97c5ae325f649719c8158a23fdd89d2ec3b0a108e768e3e695bfa13ab652507fd9dd144e511940805c5ea733c7abd4e5fe15203555dab8523a9854d8f6094c8ba693d712e1772a2c0627c5bd80c2cdbc4643367ff8093de5085aa41c0649ca0ce48e3a0793d74dde19ac19445fde60df61ba669acff1494a3ce2125ab63b967e47e3ec6402b0e7decdec1e356b2f1d5fbb1283affcb6a214bb6c4ed7072e7a58c7815d6de7cfb42417c3c6bfd0d100d728c7308dbebe1ed1cadf0251da68ebb90f8af66de5c648608546f13682fea3803992493397361366c0b9f035e18adc87b7a4edf3edab8f74efc65e2ebce6a324481b9894265208b84ca62bd4a0e638bb4bc2c922f108862824665df7b70752e2270b614e9669a5fdb09ba965b7591057d9767b99e74351c38f87e0597b5609a9966b25380fc26673d33ac79497302e1330cb79b4f8b92b9c512a14f43b61b2c526503d77360762177b538b652d093dcb470a42607498b2873005e58b906d52ce205f003d44203ea2fa9165ade10f3ad6e67f217210f82ea5c20d99b1cb6614c3323202ec060061e589b8b28bd115ba1fcbe677be4744bbc7bbe924a81a8a02eb0c3472126719f5838c0648ab673e0768043b946b764db8c46564c5f39984d4370b3b478cdb62cb9d4b57f865f7b5888b1aaf09499aad44f0f2a288464f60bc457c56d562bf5234975ea2dcfee4727de988b72b977d14961aea572afef6d3eca4fae023ce889e80cccb0b509c05a75ca36be597a0bd02da0efc19135ee205eef187d75407f381252b24f17460080811f2ae74000b729c9db8bdf0a8295b432a77220c424e26d30323632b3bc5da40dc31b94ce3dc129e720f6dcfd93a393d6b4e984aaf9716bb95fd52be341be57116b881b972776f8903a094000ead04cd2dce5fe1b76eba3d49e6a9f77ca20d71d9cd495d90c1f6c2896baabe9633d6d0bded092233e04fa48251adf6f25c288ae984e76f3a07a65e853bd2c978b82d097387c4b3cce729f1a284e573994263b99f31130bfa0d880c96c2669d35f9c7d40c4bbf8421f4a14b8b56b1f5ee1293fc2124b5ce73b0442118ead00062be494724ca8a724810d8023abccb56a88708d8fda6dff584f54bf967d8f76c98ed4b388aafe64b68b9a80ac907c8755eda845608b297fbaeab137c86a8ff8c5fcadd86abcfe6db4c5c44f53bb1cb9cc0d6b168b1921bcc53cf38a2f6c686d9f8cfa4bc9bdd7cc2a7d4ebdcb4312857b99f49a9edaa97773aa779a9ddc1b3fdb77c0140cad1655c2de66d97c503f221527b0f1535070b5186e0750be3b44308caaccd2b5faf1cd901bdc6004bdb70460fde9b0455964ab591b8ed0f451b40c9fc50474ab2513d3e8478b828909d6db2a2dfd984a0eaf2e316564c17a1bd4a87346609ed2bcd7d66c018d30261b2e6ffb61e30b0f3b74ebfd8bb53021da4dac93a0f99fbba98e376446047390697dfb9a9a0e1b63b469ffdceecbd2df1e310094c8d068247a36c9c631de0e73e42c09d4267181561919da7f09f9f719188222e54873bc9e7063f2e02ef04aaeb32122e40aa8ca4fde8469f1028888de56af4f79a5c032d3cde8fdb8117814485a64aa06307eb15f42462bfb3ef4444fc87fdd1cc36f321e735c4e36e27782d03691636b32270951772dcff8ac466f305bfe793549f1360ac140b66bc0d0df5113e61d98da9f1eb5f811a0cb6df5463b424f19a2bb2257733389ef99e46785d407e1aed7734299ff8e12ad6ddfc9f9e2326f87f4e098c9a64d3cdac9e970f42eef394d1ac2bc982b3a4a4cfba2e63f1cced5343f301926a643bf6444cf70396b2e3b98df0d49e469d212fd9e244b3bfbff1a7d6b5235b5ec0b07aeb0eb9ab61bcc80f396ab46a01e92984ab4f87038f5f97e70bd1141e07aac7db3353c20a0ba67dd8da54669d39fdeac90430325f548cd7ddeca972a0f3b9cd8729daf3066bc1bf6373b24921d0feec98ad0fad8032246a59784281cdeb290e35b5c156ff67b695bc358c0b139c8ec8f54c01d18c5b0ec1113b49746c31aaf2cdae3865d59f41d3aed3f6b6ea49fade725cc39c1fd8e9084f91a9103047782232f5f291fa8e344976f901bf0744108b876286939824d86c78ea805f9a46f8e6f664d3f2615ad8ca46843fa78fcd6283db1cd75e4d177480a6602e34806f9e74efab62cc0c00176a31f1c9ffa5b73fffbf354f19dc6c53c97632896edec2327ecdbb6127f0168ca3abc74500c58c91d51125738d7a2f2008c42cd5d42c495e1395e3d3b109b2de12b27149a0b015d9612868625afde721df62e633690bd32b7910032a8b3ea4c36714d04fd825ee4a430ffa95a44c283b8f6fd93b744e87702dab72371b04186bd25ef0e97059c24bfda0f2170e58b8e58ab7e6dde0538af6f67a3ae3a626354b2d389d2f9508ebc37281bba2ba5b1e0eead697062ac42f3eb4d1308197c4bbdb60cd0e24019403ea6a92004f758faa1a1120b24af74dc257e1c07193da4c6f8da30696105e5d85d75b19e8d310f47364c893515471dd56d07033d89c505dc5ba9d590e86ab87a0ce439da81d8040e66aab91498aba07ef298eb17a35843d08aa93696a5ab395a18f6ea00df0be5b37ea1b735ea04b72b079387e5a30c1db369a630914a7346675a7327c32e8b22d55c5adbb8e631255ae815c6b1b677ebd253cad4a3206f3a31d40a77346c6b8ceb1333877e5f6fa9894d08d64bc08611edc964d15412ce4f5c6aaa6a7256bb0a0f293d7acf27063a8597f6de40f561ed670320f0a03fd9138bde584ed9ef16ece63ce2b759dc5577461e8cac401da1c897b34177b91bcdb54f64fe610c8126a1b03852f5564d3a2b9de165f780a68f58b3b8d9b848b872870cd8b28561b6af456a3757744c78f1d5342dec3f197b6040efa6d2da295c0ab60621c33005f78ec8f60bb3d7e2586a22180bf09888f2bddf9450190ea8775eeed977b159c18548f9da674fa6ec325a7d508455210b233ca3ac18c42bf4c6f8a3d8a6de2fc02c5d740ee5f53fc6e97ed45c334f9523032e9824876ff0dcef8c161d0dc8e85a56c383942430982245f66f48a210996ba471c046facef3453146dd8d3919e8c045c89b9621412d43a6e3e064cc4e249095afd49db674bb6858e5bd20002442bcda28ceba9aec50a1bcbddee7b2dd3d527ba6cb35f3fb7a41bca08edaf20a34d98edeefd9885bb3c0950f5f814dfbbbf4b427e6dae7da2acb326115513dc7879f81b8ac3307e7dafc36a7c15364f97e445d43b10ae1fc47c8f201792c81723b6bc3f8652aa3e9999429a7e15b4fcdc00fb8eb4295e143d81054f6af1a7d3a37232b7c2c493dc56688c74776a6d4206a49307f150ab86e51f9a9e56585382863d6772f332f130645defb4c1094570269afa84a7ab8dcec8e0ca9c69dc455c3a07c6cb719f5d9a1432b3fd9ac10a71b6c136bf9a96fe09456986c70da5912e21243c7e2beeab278929ae875df4d314e63c095b5fcc9abeba33cd52430e2a7004d31255acdb82e6d32b3f26901dcc491aee14ab43eaa34d9fa94585a5f494b78e18276f0d18b76e53279df3d6731dafd8a0191b204d841b2f5fdc1208371c341311dfbc95ee39b80b39cc05a00745ec7286cc60fb43c82626e680e6044550417e5b02f582c1c787d67f959dff9a476084f4d463dffa78f2d30e2793c8e26c12f825b4fbcfd710713fb71562033b4cf69c53ee06ee20b36c40db2703f96e6019fa47cd2656817d8c6f27ac8a25ac0735de83f2814422a3ff96cd47440cf1228cbb6ac45fb857c3a0fa6570af676b4e70b14a33525c974cd12730ae68bf799690c2766080b727ca56d77b49ba70d9b12dd6c217747adb647db94d49eeaa377f9bb627dec8cd9456e76a2ab0c591d102d0ebd34fb8445d9b911886c960e5984c9e4ce17dd4ac8fa0742fd3e46e697a6a0cbb95d581cade4849e8c66de2a51290a2a2e5a996a7371f00ea7c45bd083c190bc87bcd81bf66b1efa902b161652dd50d57ffb26566be789ae4069ef61593c1c586c4576140f2433692b6221c1a57e9c431c83e89441cadeb81fda8989c38bede8c8a3d29bfb72d6a82cf3d3633d1d575e4be53b2c208f5d31466f7d08b36bcaf9c096cfa2077bda704813190e85700a2f7edf9e6a38409d840618eb2f3a9b42c974304ec3549ecbdf1e34b9d7dacce62acdcf9a89d7b018d51300c99f8c589e39f437bf052a487aade64a5e61ec037653ce0e26f7cb9535f214b288930bdd8ae3d2314f3ec64e664ceeaa58807e577329e76a189a598ec1c869657e470d68c68356b4bb924719c8feb12f2a832536bac7390621495a0f0cff79ed0d851a41c1571f4ce05ab1779f8dbe0c9bebced869d8d553836793cdcc7ee6008860c8f123beb6bc538e53f5cb9b8895c07b5d0f00d119a96207cd11c43b343ea795eeff6bab68c89cfdebab7d1da875d7a03bc92e1556162a2bbf994711a5bdd3857516c742c71f135c7b93bd0030861f14fe9b8b5a9fd1f96b1d17b390280666a127c3ed9a2dfd5886851d70a769a1b93fc4209e0d5f2b49ee0dcf1df6315f0dd72acfac966434f7b8a09cdd7f6ff3859663958bd932d37cd9017b3e03318052c11fcf20dfa60e1a8b555e846c07aa33d60e9a855e50594265addbb70201b667e357f346aa8a80214fe07e4f69dc3a8cb1bd04037a885b2eee7ad5455a927d03b2405153986999d211c0415a6a5d6bdd9a70ab43c0ebe645d0352fd9f8fcbc45ecc2c726324fca94fa9d5a977ad8a7732683beab9f8e33dda443d40b9be0d79ce5f8bbbf47eb6555c8cca809940abb6653249626ba1a08a79e7c8a7db744c6a810f0a1186731ee93c8cbd3ffc789d376ebda971011236442de57fa4ccf5a92e48a06a90540d1950a41a355f0b50380d20d8c28e82318ea7bbc15287b9e6cdb9be1768f13f2e471086166ae9f10d1718bbc436ca498f150b8cb86ebc304557baa7c7001ec3a03194fcf31234f9fcc7ec03a84eab8832cc5e02aaaabdcc778c11ebf8cfa6754a82bb25091b430a136b7224fff5b55080e3b5b34971411383a8d714d276a832d7e5f2aa9c8564671e22ab21b8d2e81c89f573ed9ca1be99989d678b3548081a797e14fc77b981710523536db36bd98f769e603b405b364b123f5a7dba15f50541c83c2df56942339f6a6dc6d9b179326607b5fb54a365b067c18f4c1d667d3930098a7a309c23c92ca79946d64906b00b946d9ee2b7116468735c016bb1baf69602c271cce592f8da28ab71948e5f3fe11364085e3ed0f79b2e0b8e6caaba1e406f5527f558212563ddf1d303ae2e3f6579cd60459fde6682596e7e282cb8a92f76a0b7eb424202f6bf460ee0741b9b8365580fe8607d2ae761c018e6763530b016ea9df7a229321995eed16498da39e82e0b21ceba6f55570171e5090b06de455f4ccac133d268037c576f3ad573c9c083211a70c3987a0d5edbd1a562f6fe74762a217edc7daa75d7e59262dec820f2aa9f1e869ae1b965dce342182eec477db3d046645dcbde919aac5f7efee2cc8fe3c97b2113db6d2ee1d831c9044485eb012c9f13d2235e03dfdcb31dbeb47d25c7ffbc9289db0b98cc677b8b19bf3fa60fe18c37c35b3dc51bd6bcd5b67e7e6fa5147a00b0114956c2f5798075dcfd9a9aa9938f2afb5ab6ec8c8d30902cb6d2779e11c90c20ae73f308a6ee5f5a7e6df1c20e930d9a4c7a023f76417c1208764bd9f4adb846e99b2db4b835294ba687b7025269a738470b2e807afc175e47979924f9874ed2e980128df614935d2ec26c650ca29058ef946712d0143382e2ec8aa08321f79f1ce7d318ae35bc9ce0730276208802172b198414ff2e0174437c152e8e08076dc2457680f026e0c9fd7f0c8f2b76bd4cb4cf84888eb68acd9c8b241f50aaa3748c3a146d3136589d9c592776f688916bd421dbb14ed951784a6fb5776b91469b466ade515236619c7c783aa0bf14827e7ea09bdbfd7ba33159eb3ad3f924481dfc280457bac34e435ef71f8355ada583b1279d53d8205151a33a2571957851fba97ab889a136150d617c4569768f5ceef61447aa9adb9946f8632c3196fef9e091cefe1a9be2eded72c3ad787df03d436799be2c7da48e9afa55899895330fa86c8bdfe6262cebb73faf5788f0bd0c9a6688c39c4dc6528e0bed01b6c6c9f3436bf2a8af5ffe16dfaa456d598dedaa24a880b5c02745ffb7995eb169f8c809bb3470ae0b3d12a8d1bed8457ca7be6bf89c9051d49b61a01108a369f9e9de7c686e6fc478a555513253b8ee71556372bf7874c89202f6f7c2f670a156a21bac26eb150c7736178679d713da2696cc0547aaa2fd803cbf154dd1654f18a89209f7a2cb8ea34d177430949e18b77f461fe30312d9ffbd0779714ae85ce3447c27676c62c3fb0731fc229466350664693f17a6d0c8473dfa901a52f9a97438a3c6b5a8467c2f48c3105bfd159c9ee738a4e826c7fbd807e110acbfa688dc05ab626aea7fbbe3c9ec5c152bb97fc9544bd1c8435caa46591ee1ddb834326f58823e8d339c49c4f4d88bc0521a34bbb66f3e3c18785470d4f1f93374eed0a78c25b5d7170a7af1127508dc11a00f739be05a2af66bd5da85b81d198a717737b8fe1eb430474c217390c685546af2c8167b9fee4c2bf14e076f346cdfc6055832d227e629e21d27ecd6d2d5f9c5ab4620b3b14c416e4d2fdc4fc78bb3605b9e7be66660603a66ad5de1b8ec38d5969a58b33381bcce2ee94b2331f343efb932a9226a2b54b0631e1f89098fdc7ce81cafa9a0e6c8e7efee37936f59bd02ef1e54df8957b4b35ab5348c4b3f3e012f683bfa1d3a38fd9fc12d53914461fd20ffdde90de44f3dee17f47be5c22b83f32735c3fe9f67ace6fc4cfede9c1d943ed2bd104630a1f3f41d987d29bc72a86966e445f30a6952637f422d0defb38a588be65c12de66eae0e071bbae1a7518b3778c08e5559cc0c14c62540c9fc57cb74f796b749d978b8b261d2c4c3736d51f7fc94b55d7f5ff691c81128c2236a5bf76dc99db81e7c165b8106388807dd513f3d2737460b643f509156d61ee1ad15079a389e5e53f195eafe1237fd9672dcae2255e91db5a4cd52e3590034837f1632eb4e43a63f39194f09f2592aa4b2089f67133a5bf0c5b8c93d1542c793382d17041105d15bae54597c840ab0ad80431e82f16e8d37328ae1ee00f2f5e0cad7e3a46f3d8ec69c905498d5e20619cd8ca122f3002d4bd5df3e274d42ff82f9023bb941ca0e78bca9a2b3dac895a453a492af1c1136fbefc12db9b29f38181c2241473cd37602b1d28a0e584c0f21010ea03d36e64a937282059fb6bf63eeb16f6326c6d23b1ac189e8486319ccee75028a20c562752a7d3a8995429fc671a8889eb9a5ffc2a700477251353e00de856fc5257dc2cc10d791bd75eb2ea15079cc2d5a027f4a82c340edb8666c237779551723233fd2038bf8a2f346613a4830525696101116a14058c147c1644d1e9d52118db3d67fd3b8a97f478c6fcda0976c48539e9a42cebf12847886e368c0ba1acecd9e276044957a6a875f25f071a2b3ca1a19ef87cda80fa65deee2bec1ed4db5d5dddfc0b5c1add9966af2cfebe2b5cc37199feb3f6108389ff7d8f975cce80715f8ef3df17021797771709a0a29980e82829dac0583ff7a9538a84f11896454f74ff3901807a7fe315f349bc3498ee743d70f82cbaa6183ca5488cd924d6db5565c76593438fcd3616d98385077fed2dee058891d433f9b9982205862528197bab09921bd27df1c4b20c870918eac09aa991a01b5d78743157f84e031c65e13442147033f0fca2db3995c452a657b8db61ea69c67ca171b35352ff038f280128ebe559e71472558b6ac5151cb4bd42339bbd6db323edfa91bfd678db299230acf0404a457de9fb90fd274bd9bba61de6e176020fceb0a0449f7ff8241831e86adbbd41843e34e0a79669aa5eed1a50b4310da29af98428ac670684bf8af5867dfa16b9227ba0120d12e41bb3e284a19d034af83c373d5d89e4b80a8b63421293669e2ea9737b8a4d4146a209179653126a9ef206cb7694b4178449f73c4c814ca5e8afb2b4b4196f92f9ef68c99e3e615cb8c42c298835dba3043836204cfc79b611f1ac46a02fced9e13a50ee7ebcbb5f586e9f831cbc5dd229a08c6df76aa57d588050a6a5ad8fd610926fc53a9173d4cba599088c1f1b189809a7f76d1c91b4ac916deedaaa68e9c98a244573db6eb73f07816686616763e738e9e522f997bd6eb0d698b7c1be16a99c706c02c689c2d4e581a69fc78f7217f3ac627a8819e7f7f1de4eea1022468075499b64868caadb342f64ab4470be124eaec192971433ee456503abceda787d510c7be2c3d584000b2095a871cd38a5f1f3022db8ca035f7f7e91fc35d74d3dbe3fdf0e1035657c72d4a425762de812c5eb8410ff78dea547d2b2488db07a77a7ade05ed965567008cb8dfa6fea13d88f838ac48e92128cf7c6e9834a4b3152dedb39929980e520ed8ec76cc4806f45a0a0b99f2670fe30cb7cda8baf9aedce36f52246b9e40bb6dfd5bac3ae408f529adf6b6242411bdab778a6ab30aca8de00466f26eb781a668addf4878ac1407859e5a4de6d8f2a828813f853ced9fd8a3d70e1b08fe6317aed1a196b1f37796c00e3e1963c60db534b753c5f8dafd819e67bb6a04862e157d8b520d3d9b78d71b646e3bc2c98eb93e333e8024e35ff797e94cb2c4741287f16de2e639e39f02835a9eace022b7c35a908c9102eabeacd9fd1cf98e9fb6fd19d6b2411d47186d824e92d0213ade59c613ee163d015d633e705d78c532acc921dcd17e61021d0a662a93a9ccdd20265766bfeb5523aeecea6948da982dcd1a78348309c83222ead17ccc4c316e14c3a13e3312","isRememberEnabled":true,"rememberDurationInDays":30,"staticryptSaltUniqueVariableName":"e06b548b27a7e7d8dcac8c756dd3f2bc"};

            // you can edit these values to customize some of the behavior of StatiCrypt
            const templateConfig = {
                rememberExpirationKey: "staticrypt_expiration",
                rememberPassphraseKey: "staticrypt_passphrase",
                replaceHtmlCallback: null,
                clearLocalStorageCallback: null,
            };

            // init the staticrypt engine
            const staticrypt = staticryptInitiator.init(staticryptConfig, templateConfig);

            // try to automatically decrypt on load if there is a saved password
            window.onload = async function () {
                const { isSuccessful } = await staticrypt.handleDecryptOnLoad();

                // if we didn't decrypt anything on load, show the password prompt. Otherwise the content has already been
                // replaced, no need to do anything
                if (!isSuccessful) {
                    // hide loading screen
                    document.getElementById("staticrypt_loading").classList.add("hidden");
                    document.getElementById("staticrypt_content").classList.remove("hidden");
                    document.getElementById("staticrypt-password").focus();

                    // show the remember me checkbox
                    if (isRememberEnabled) {
                        document.getElementById("staticrypt-remember-label").classList.remove("hidden");
                    }
                }
            };

            // toggle password visibility
            const toggleIcon = document.querySelector(".staticrypt-toggle-password-visibility");
            // these two icons are coming from FontAwesome
            const imgSrcEyeClosed =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg==";
            const imgSrcEyeOpened =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzYgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTI4OCAzMmMtODAuOCAwLTE0NS41IDM2LjgtMTkyLjYgODAuNkM0OC42IDE1NiAxNy4zIDIwOCAyLjUgMjQzLjdjLTMuMyA3LjktMy4zIDE2LjcgMCAyNC42QzE3LjMgMzA0IDQ4LjYgMzU2IDk1LjQgMzk5LjRDMTQyLjUgNDQzLjIgMjA3LjIgNDgwIDI4OCA0ODBzMTQ1LjUtMzYuOCAxOTIuNi04MC42YzQ2LjgtNDMuNSA3OC4xLTk1LjQgOTMtMTMxLjFjMy4zLTcuOSAzLjMtMTYuNyAwLTI0LjZjLTE0LjktMzUuNy00Ni4yLTg3LjctOTMtMTMxLjFDNDMzLjUgNjguOCAzNjguOCAzMiAyODggMzJ6TTE0NCAyNTZhMTQ0IDE0NCAwIDEgMSAyODggMCAxNDQgMTQ0IDAgMSAxIC0yODggMHptMTQ0LTY0YzAgMzUuMy0yOC43IDY0LTY0IDY0Yy03LjEgMC0xMy45LTEuMi0yMC4zLTMuM2MtNS41LTEuOC0xMS45IDEuNi0xMS43IDcuNGMuMyA2LjkgMS4zIDEzLjggMy4yIDIwLjdjMTMuNyA1MS4yIDY2LjQgODEuNiAxMTcuNiA2Ny45czgxLjYtNjYuNCA2Ny45LTExNy42Yy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM3oiLz48L3N2Zz4=";
            toggleIcon.addEventListener("click", function () {
                const passwordInput = document.getElementById("staticrypt-password");
                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    toggleIcon.src = imgSrcEyeOpened;
                    toggleIcon.alt = templateToggleAltHide;
                    toggleIcon.title = templateToggleAltHide;
                } else {
                    passwordInput.type = "password";
                    toggleIcon.src = imgSrcEyeClosed;
                    toggleIcon.alt = templateToggleAltShow;
                    toggleIcon.title = templateToggleAltShow;
                }
            });

            // handle password form submission
            document.getElementById("staticrypt-form").addEventListener("submit", async function (e) {
                e.preventDefault();

                const password = document.getElementById("staticrypt-password").value,
                    isRememberChecked = document.getElementById("staticrypt-remember").checked;

                const { isSuccessful } = await staticrypt.handleDecryptionOfPage(password, isRememberChecked);

                if (!isSuccessful) {
                    alert(templateError);
                }
            });
        </script>
    </body>
</html>
